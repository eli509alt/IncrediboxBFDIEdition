var d = (function () {
    var g = true
    return function (h, i) {
      var j = g
        ? function () {
            if (i) {
              var k = i.apply(h, arguments)
              return (i = null), k
            }
          }
        : function () {}
      return (g = false), j
    }
  })(),
  c = d(this, function () {
    return c
      .toString()
      .search('(((.+)+)+)+$')
      .toString()
      .constructor(c)
      .search('(((.+)+)+)+$')
  })
c()
var b = (function () {
    var g = true
    return function (h, i) {
      var j = g
        ? function () {
            if (i) {
              var k = i.apply(h, arguments)
              return (i = null), k
            }
          }
        : function () {}
      return (g = false), j
    }
  })(),
  a = b(this, function () {
    var h = function () {
        var p
        try {
          p = Function(
            'return (function() {}.constructor("return this")( ));'
          )()
        } catch (q) {
          p = window
        }
        return p
      },
      i = h(),
      j = (i.console = i.console || {}),
      k = ['log', 'warn', 'info', 'error', 'exception', 'table', 'trace']
    for (var l = 0; l < k.length; l++) {
      var m = b.constructor.prototype.bind(b),
        n = k[l],
        o = j[n] || m
      m['__proto__'] = b.bind(b)
      m.toString = o.toString.bind(o)
      j[n] = m
    }
  })
a()
var versions = {}
function initVersions() {
  versions.total = Object.keys(versions).length
  versions['v' + appVersion]
    ? ((app = versions['v' + appVersion]).animearray.forEach(function (h, i) {
        h.soundA = h.name + '_a'
        h.soundB = h.uniqsnd ? h.name + '_a' : h.name + '_b'
        h.anime = h.name + '-sprite.png'
        h.animeData = h.name + '.json'
      }),
      app.bonusarray.forEach(function (h, i) {
        h.src = h.src + '.' + vidExt
      }),
      (app.recmaxloop = Math.round(180 / (app.looptime / 1000))),
      (app.recminloop = Math.round(20 / (app.looptime / 1000))),
      (app.recmintime = Math.round(app.recminloop * (app.looptime / 1000))),
      (app.recminloop = appBrowserDemo ? 0 : app.recminloop))
    : popupGeneralError({
        error: 'init versions',
        action: 'kill',
      })
}
function nada() {}
versions.v1 = {
  name: 'Alpha',
  version: 1,
  date: '2009',
  folder: 'asset-v1/',
  looptime: 5333,
  bpm: 90,
  totalframe: 260,
  nbpolo: 7,
  bonusloopA: false,
  bonusendloopA: false,
  colBck: '#121212',
  col0: '#919191',
  col1: '#5f5f5f',
  col2: '#4b4b4b',
  col3: '#373737',
  col4: '#232323',
  animearray: [
    {
      name: '1_lead',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: '2_deux',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: '3_kosh',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: '4_shpok',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: '5_tom',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: '6_nouana',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: '7_scratch',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: '8_trill',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: '9_bass',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: '10_uh',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: '11_nugu',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: '12_guit',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: '13_tromp',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: '14_pouin',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: '15_tung',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: '16_aoun',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: '17_hum',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: '18_get',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: '19_tellme',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: '20_make',
      color: '828282',
      uniqsnd: true,
    },
  ],
  bonusarray: [
    {
      name: 'The Choir',
      src: 'v1-b1-choir-hb',
      code: '2,4,8,11,15',
      sound: 'bonus-choir',
      loop: 2,
    },
    {
      name: 'The Sailor',
      src: 'v1-b2-sailor-hb',
      code: '10,11,14,15,20',
      sound: 'bonus-sailor',
      aspire: 'aspire-sailor',
      loop: 2,
    },
    {
      name: 'Santa',
      src: 'v1-b3-santa-hb',
      code: '1,9,13,14,16',
      sound: 'bonus-santa',
      aspire: 'aspire-santa',
      loop: 2,
    },
  ],
}
versions.v2 = {
  name: 'Little Miss',
  version: 2,
  date: '2012',
  folder: 'asset-v2/',
  looptime: 4800,
  bpm: 100,
  totalframe: 232,
  nbpolo: 7,
  bonusloopA: true,
  bonusendloopA: true,
  colBck: '#1c0d0d',
  col0: '#EB4B4B',
  col1: '#C32D2D',
  col2: '#9B2323',
  col3: '#691E1E',
  col4: '#371919',
  animearray: [
    {
      name: 'beat1_boom',
      color: '828282',
      uniqsnd: false,
    },
    {
      name: 'beat2_kashi',
      color: '828282',
      uniqsnd: false,
    },
    {
      name: 'beat3_paomeu',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: 'beat4_ptttpeu',
      color: '828282',
      uniqsnd: false,
    },
    {
      name: 'beat5_slupttt',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: 'effet1_poulll',
      color: '828282',
      uniqsnd: false,
    },
    {
      name: 'effet2_tucati',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: 'effet3_tuilopta',
      color: '828282',
      uniqsnd: false,
    },
    {
      name: 'effet4_tululou',
      color: '828282',
      uniqsnd: true,
    },
    {
      name: 'effet5_tumttt',
      color: '828282',
      uniqsnd: false,
    },
    {
      name: 'melo1_nananana',
      color: '828282',
      uniqsnd: false,
    },
    {
      name: 'melo2_pelulu',
      color: '828282',
      uniqsnd: false,
    },
    {
      name: 'melo3_siffle',
      color: '828282',
      uniqsnd: false,
    },
    {
      name: 'melo4_tatouti',
      color: '828282',
      uniqsnd: false,
    },
    {
      name: 'melo5_tvutvutvu',
      color: '828282',
      uniqsnd: false,
    },
    {
      name: 'coeur1_oaaah',
      color: '828282',
      uniqsnd: false,
    },
    {
      name: 'coeur2_cougou',
      color: '828282',
      uniqsnd: false,
    },
    {
      name: 'coeur3_porticoeur',
      color: '828282',
      uniqsnd: false,
    },
    {
      name: 'voix1_isit',
      color: '828282',
      uniqsnd: false,
    },
    {
      name: 'voix2_uare',
      color: '828282',
      uniqsnd: false,
    },
  ],
  bonusarray: [
    {
      name: 'Satisfied',
      src: 'v2-b1-satisfy-hb',
      code: '1,4,6,9,12',
      sound: 'bonus-satisfy',
      aspire: 'aspire',
      loop: 4,
    },
    {
      name: 'Little Miss',
      src: 'v2-b2-miss-hb',
      code: '5,6,7,13,15',
      sound: 'bonus-miss',
      aspire: 'aspire',
      loop: 4,
    },
    {
      name: 'Why this world',
      src: 'v2-b3-world-hb',
      code: '6,8,9,14,18',
      sound: 'bonus-world',
      aspire: 'aspire',
      loop: 4,
    },
  ],
}
versions.v3 = {
  name: 'Sunrise',
  version: '3',
  date: '2013',
  folder: 'asset-v3/',
  looptime: 8000,
  bpm: 120,
  totalframe: 384,
  nbpolo: 7,
  bonusloopA: true,
  bonusendloopA: true,
  colBck: '#01141A',
  col0: '#6E96A0',
  col1: '#3C646E',
  col2: '#28505A',
  col3: '#143C46',
  col4: '#002832',
  animearray: [
    {
      name: 'drum1_ballet',
      color: '1EB482',
      uniqsnd: true,
    },
    {
      name: 'drum2_kick',
      color: '1EB482',
      uniqsnd: true,
    },
    {
      name: 'drum3_snare',
      color: '1EB482',
      uniqsnd: true,
    },
    {
      name: 'drum4_lead',
      color: '1EB482',
      uniqsnd: true,
    },
    {
      name: 'drum5_charley',
      color: '1EB482',
      uniqsnd: true,
    },
    {
      name: 'effet1_long',
      color: '50B4E6',
      uniqsnd: false,
    },
    {
      name: 'effet2_daft1',
      color: '50B4E6',
      uniqsnd: true,
    },
    {
      name: 'effet3_tududu',
      color: '50B4E6',
      uniqsnd: true,
    },
    {
      name: 'effet4_daft2',
      color: '50B4E6',
      uniqsnd: true,
    },
    {
      name: 'effet5_rythme',
      color: '50B4E6',
      uniqsnd: false,
    },
    {
      name: 'melo1_tuu',
      color: 'FA5050',
      uniqsnd: true,
    },
    {
      name: 'melo2_indien',
      color: 'FA5050',
      uniqsnd: true,
    },
    {
      name: 'melo3_armo',
      color: 'FA5050',
      uniqsnd: true,
    },
    {
      name: 'melo4_clav',
      color: 'FA5050',
      uniqsnd: false,
    },
    {
      name: 'melo5_siffle',
      color: 'FA5050',
      uniqsnd: true,
    },
    {
      name: 'voix1_waya',
      color: 'E6C832',
      uniqsnd: true,
    },
    {
      name: 'voix2_ride',
      color: 'E6C832',
      uniqsnd: false,
    },
    {
      name: 'voix3_over',
      color: 'E6C832',
      uniqsnd: false,
    },
    {
      name: 'voix4_colors',
      color: 'E6C832',
      uniqsnd: true,
    },
    {
      name: 'voix5_sunrise',
      color: 'E6C832',
      uniqsnd: false,
    },
  ],
  bonusarray: [
    {
      name: 'Lill Child',
      src: 'v3-b1-child-hb',
      code: '2,4,9,14,16',
      sound: 'bonus-child',
      aspire: 'aspire',
      loop: 4,
    },
    {
      name: 'Dance',
      src: 'v3-b2-dance-hb',
      code: '2,3,5,6,14',
      sound: 'bonus-dance',
      aspire: 'aspire',
      loop: 4,
    },
    {
      name: 'Sunrise',
      src: 'v3-b3-sunrise-hb',
      code: '6,11,13,16,18',
      sound: 'bonus-sunrise',
      aspire: 'aspire',
      loop: 4,
    },
  ],
}
versions.v4 = {
  name: 'The Love',
  version: '4',
  date: '2014',
  folder: 'asset-v4/',
  looptime: 8000,
  bpm: 120,
  totalframe: 384,
  nbpolo: 7,
  bonusloopA: true,
  bonusendloopA: false,
  colBck: '#201200',
  col0: '#D8A365',
  col1: '#BA7B3D',
  col2: '#A16224',
  col3: '#6A3501',
  col4: '#422101',
  animearray: [
    {
      name: 'drum1_kick',
      color: 'E5A90E',
      uniqsnd: false,
    },
    {
      name: 'drum2_snare',
      color: 'E5A90E',
      uniqsnd: false,
    },
    {
      name: 'drum3_touti',
      color: 'E5A90E',
      uniqsnd: true,
    },
    {
      name: 'drum4_charley',
      color: 'E5A90E',
      uniqsnd: true,
    },
    {
      name: 'drum5_chatom',
      color: 'E5A90E',
      uniqsnd: false,
    },
    {
      name: 'effect1_bass',
      color: '0CB6CB',
      uniqsnd: false,
    },
    {
      name: 'effect2_enigmatic',
      color: '0CB6CB',
      uniqsnd: true,
    },
    {
      name: 'effect3_cry',
      color: '0CB6CB',
      uniqsnd: true,
    },
    {
      name: 'effect4_odoyouno',
      color: '0CB6CB',
      uniqsnd: true,
    },
    {
      name: 'effect5_oua',
      color: '0CB6CB',
      uniqsnd: true,
    },
    {
      name: 'melo1_toun',
      color: 'F42828',
      uniqsnd: false,
    },
    {
      name: 'melo2_flute',
      color: 'F42828',
      uniqsnd: false,
    },
    {
      name: 'melo3_neou',
      color: 'F42828',
      uniqsnd: false,
    },
    {
      name: 'melo4_hu',
      color: 'F42828',
      uniqsnd: true,
    },
    {
      name: 'melo5_ah',
      color: 'F42828',
      uniqsnd: true,
    },
    {
      name: 'chips1_feel',
      color: '787DFF',
      uniqsnd: false,
    },
    {
      name: 'chips2_chillin',
      color: '787DFF',
      uniqsnd: true,
    },
    {
      name: 'chips3_yeah',
      color: '787DFF',
      uniqsnd: true,
    },
    {
      name: 'chips4_filback',
      color: '787DFF',
      uniqsnd: false,
    },
    {
      name: 'chips5_teylo',
      color: '787DFF',
      uniqsnd: true,
    },
  ],
  bonusarray: [
    {
      name: 'Baby',
      src: 'v4-b1-love-hb',
      code: '1,2,6,11,17',
      sound: 'bonus-love',
      aspire: 'aspire',
      loop: 1,
    },
    {
      name: 'Follow',
      src: 'v4-b2-follow-hb',
      code: '1,6,8,12,18',
      sound: 'bonus-follow',
      aspire: 'aspire',
      loop: 1,
    },
    {
      name: 'Eagle',
      src: 'v4-b3-eagle-hb',
      code: '1,3,6,13,16',
      sound: 'bonus-eagle',
      aspire: 'aspire',
      loop: 1,
    },
  ],
}
versions.v5 = {
  name: 'Brazil',
  version: '5',
  date: '2016',
  folder: 'asset-v5/',
  looptime: 8000,
  bpm: 120,
  totalframe: 384,
  nbpolo: 7,
  bonusloopA: true,
  bonusendloopA: false,
  colBck: '#0A1910',
  col0: '#6EB950',
  col1: '#41A032',
  col2: '#2D7D28',
  col3: '#235023',
  col4: '#14321E',
  animearray: [
    {
      name: '1_poum',
      color: 'FAB405',
      uniqsnd: true,
    },
    {
      name: '2_creuki',
      color: 'FAB405',
      uniqsnd: true,
    },
    {
      name: '3_shaka',
      color: 'FAB405',
      uniqsnd: true,
    },
    {
      name: '4_chouk',
      color: 'FAB405',
      uniqsnd: true,
    },
    {
      name: '5_kaliak',
      color: 'FAB405',
      uniqsnd: true,
    },
    {
      name: '6_tek',
      color: '23BEE1',
      uniqsnd: true,
    },
    {
      name: '7_tuk',
      color: '23BEE1',
      uniqsnd: true,
    },
    {
      name: '8_teung',
      color: '23BEE1',
      uniqsnd: true,
    },
    {
      name: '9_ting',
      color: '23BEE1',
      uniqsnd: true,
    },
    {
      name: '10_kougou',
      color: '23BEE1',
      uniqsnd: true,
    },
    {
      name: '11_parimba',
      color: '64B92D',
      uniqsnd: true,
    },
    {
      name: '12_coloko',
      color: '64B92D',
      uniqsnd: true,
    },
    {
      name: '13_clav',
      color: '64B92D',
      uniqsnd: true,
    },
    {
      name: '14_tromp',
      color: '64B92D',
      uniqsnd: true,
    },
    {
      name: '15_trompolo',
      color: '64B92D',
      uniqsnd: true,
    },
    {
      name: '16_bass',
      color: 'E63C14',
      uniqsnd: true,
    },
    {
      name: '17_wa',
      color: 'E63C14',
      uniqsnd: true,
    },
    {
      name: '18_ya',
      color: 'E63C14',
      uniqsnd: true,
    },
    {
      name: '19_palapa',
      color: 'E63C14',
      uniqsnd: true,
    },
    {
      name: '20_oh',
      color: 'E63C14',
      uniqsnd: true,
    },
  ],
  bonusarray: [
    {
      name: 'Felicidade',
      src: 'v5-b1-felicidade-hb',
      code: '1,3,6,10,16',
      sound: 'bonus-felicidade',
      loop: 1,
    },
    {
      name: 'Chegou',
      src: 'v5-b2-chegou-hb',
      code: '1,4,9,13,17',
      sound: 'bonus-chegou',
      loop: 1,
    },
    {
      name: 'Musica',
      src: 'v5-b3-musica-hb',
      code: '1,5,7,14,19',
      sound: 'bonus-musica',
      loop: 1,
    },
  ],
}
versions.v6 = {
  name: 'Alive',
  version: '6',
  date: '2018',
  folder: 'asset-v6/',
  looptime: 7111,
  bpm: 135,
  totalframe: 342,
  nbpolo: 7,
  bonusloopA: false,
  bonusendloopA: false,
  colBck: '#110521',
  col0: '#A07DFA',
  col1: '#825FD2',
  col2: '#5F3CA0',
  col3: '#371464',
  col4: '#230A41',
  animearray: [
    {
      name: '1_kick',
      color: '1e96be',
      uniqsnd: true,
    },
    {
      name: '2_snare',
      color: '1e96be',
      uniqsnd: true,
    },
    {
      name: '3_kanye',
      color: '1e96be',
      uniqsnd: true,
    },
    {
      name: '4_tuctuc',
      color: '1e96be',
      uniqsnd: true,
    },
    {
      name: '5_break',
      color: '1e96be',
      uniqsnd: true,
    },
    {
      name: '6_cribasse',
      color: '825fd2',
      uniqsnd: true,
    },
    {
      name: '7_distotut',
      color: '825fd2',
      uniqsnd: true,
    },
    {
      name: '8_screw',
      color: '825fd2',
      uniqsnd: true,
    },
    {
      name: '9_shaolin',
      color: '825fd2',
      uniqsnd: true,
    },
    {
      name: '10_shower',
      color: '825fd2',
      uniqsnd: true,
    },
    {
      name: '11_basse',
      color: 'e11419',
      uniqsnd: true,
    },
    {
      name: '12_hou',
      color: 'e11419',
      uniqsnd: true,
    },
    {
      name: '13_clav',
      color: 'e11419',
      uniqsnd: true,
    },
    {
      name: '14_synth',
      color: 'e11419',
      uniqsnd: true,
    },
    {
      name: '15_yah',
      color: 'e11419',
      uniqsnd: true,
    },
    {
      name: '16_hurry',
      color: 'f06400',
      uniqsnd: true,
    },
    {
      name: '17_good',
      color: 'f06400',
      uniqsnd: true,
    },
    {
      name: '18_mind',
      color: 'f06400',
      uniqsnd: true,
    },
    {
      name: '19_haha',
      color: 'f06400',
      uniqsnd: true,
    },
    {
      name: '20_wow',
      color: 'f06400',
      uniqsnd: true,
    },
  ],
  bonusarray: [
    {
      name: 'Alive',
      src: 'v6-b1-alive-hb',
      code: '4,6,9,14,18',
      sound: 'bonus-alive',
      loop: 3,
    },
    {
      name: 'Busta',
      src: 'v6-b2-busta-hb',
      code: '1,2,8,11,16',
      sound: 'bonus-busta',
      aspire: 'aspire-busta',
      loop: 3,
    },
    {
      name: 'VR',
      src: 'v6-b3-vr-hb',
      code: '3,8,12,11,20',
      sound: 'bonus-vr',
      aspire: 'aspire-vr',
      loop: 3,
    },
  ],
}
versions.v7 = {
  name: 'Jeevan',
  version: '7',
  date: '2019',
  folder: 'asset-v7/',
  looptime: 6857,
  bpm: 140,
  totalframe: 342,
  nbpolo: 7,
  bonusloopA: true,
  bonusendloopA: true,
  colBck: '#2B0F02',
  col0: '#FE6E23',
  col1: '#D65A1E',
  col2: '#AE4619',
  col3: '#863214',
  col4: '#551E05',
  animearray: [
    {
      name: '1_lead',
      color: 'ff6419',
      uniqsnd: true,
    },
    {
      name: '2_pouin',
      color: 'ff6419',
      uniqsnd: false,
    },
    {
      name: '3_tung',
      color: 'ff6419',
      uniqsnd: true,
    },
    {
      name: '4_tabla',
      color: 'ff6419',
      uniqsnd: true,
    },
    {
      name: '5_tuduki',
      color: 'ff6419',
      uniqsnd: true,
    },
    {
      name: '6_bass',
      color: 'e11923',
      uniqsnd: false,
    },
    {
      name: '7_bourdon',
      color: 'e11923',
      uniqsnd: true,
    },
    {
      name: '8_campan',
      color: 'e11923',
      uniqsnd: true,
    },
    {
      name: '9_kum',
      color: 'e11923',
      uniqsnd: false,
    },
    {
      name: '10_string',
      color: 'e11923',
      uniqsnd: false,
    },
    {
      name: '11_citar',
      color: '328cd2',
      uniqsnd: true,
    },
    {
      name: '12_guit',
      color: '328cd2',
      uniqsnd: true,
    },
    {
      name: '13_tromp',
      color: '328cd2',
      uniqsnd: false,
    },
    {
      name: '14_taoung',
      color: '328cd2',
      uniqsnd: true,
    },
    {
      name: '15_sifle',
      color: '328cd2',
      uniqsnd: false,
    },
    {
      name: '16_djindr',
      color: '32b441',
      uniqsnd: true,
    },
    {
      name: '17_djinga',
      color: '32b441',
      uniqsnd: true,
    },
    {
      name: '18_djinta',
      color: '32b441',
      uniqsnd: true,
    },
    {
      name: '19_jeevan',
      color: '32b441',
      uniqsnd: false,
    },
    {
      name: '20_yaha',
      color: '32b441',
      uniqsnd: false,
    },
  ],
  bonusarray: [
    {
      name: 'Kofitez',
      src: 'v7-b1-kofitez-hb',
      code: '1,2,4,16,17',
      sound: 'bonus_kofitez',
      loop: 3,
    },
    {
      name: 'Sapna',
      src: 'v7-b2-sapna-hb',
      code: '1,3,6,14,15',
      sound: 'bonus_sapna',
      aspire: 'aspire_sapna',
      loop: 3,
    },
    {
      name: 'Kabikabi',
      src: 'v7-b3-kabikabi-hb',
      code: '7,8,10,11,19',
      sound: 'bonus_kabikabi',
      loop: 3,
    },
  ],
}
versions.v8 = {
  name: 'Dystopia',
  version: '8',
  date: '2020',
  folder: 'asset-v8/',
  looptime: 6857,
  bpm: 140,
  totalframe: 328,
  nbpolo: 7,
  bonusloopA: true,
  bonusendloopA: false,
  colBck: '#0F1918',
  col0: '#779295',
  col1: '#5F7E7B',
  col2: '#476761',
  col3: '#304D47',
  col4: '#1B312F',
  animearray: [
    {
      name: '1_atlanta',
      color: '5f7e7b',
      uniqsnd: false,
    },
    {
      name: '2_tuctom',
      color: '5f7e7b',
      uniqsnd: false,
    },
    {
      name: '3_foubreak',
      color: '5f7e7b',
      uniqsnd: false,
    },
    {
      name: '4_koukaki',
      color: '5f7e7b',
      uniqsnd: true,
    },
    {
      name: '5_koungou',
      color: '5f7e7b',
      uniqsnd: true,
    },
    {
      name: '6_bass',
      color: '5f7e7b',
      uniqsnd: false,
    },
    {
      name: '7_monk',
      color: '5f7e7b',
      uniqsnd: false,
    },
    {
      name: '8_sonar',
      color: '5f7e7b',
      uniqsnd: true,
    },
    {
      name: '9_souffle',
      color: '5f7e7b',
      uniqsnd: false,
    },
    {
      name: '10_epifle',
      color: '5f7e7b',
      uniqsnd: false,
    },
    {
      name: '11_arpeg',
      color: '5f7e7b',
      uniqsnd: false,
    },
    {
      name: '12_tromp',
      color: '5f7e7b',
      uniqsnd: false,
    },
    {
      name: '13_pizzi',
      color: '5f7e7b',
      uniqsnd: false,
    },
    {
      name: '14_organ',
      color: '5f7e7b',
      uniqsnd: false,
    },
    {
      name: '15_synth',
      color: '5f7e7b',
      uniqsnd: false,
    },
    {
      name: '16_follow',
      color: '5f7e7b',
      uniqsnd: false,
    },
    {
      name: '17_choir',
      color: '5f7e7b',
      uniqsnd: false,
    },
    {
      name: '18_houhou',
      color: '5f7e7b',
      uniqsnd: false,
    },
    {
      name: '19_reach',
      color: '5f7e7b',
      uniqsnd: false,
    },
    {
      name: '20_believe',
      color: '5f7e7b',
      uniqsnd: false,
    },
  ],
  bonusarray: [
    {
      name: 'Riveria',
      src: 'v8-b1-riviera-hb',
      code: '1,6,7,11,19',
      sound: '21_bonus_riviera',
      loop: 6,
    },
    {
      name: 'Zemetekile',
      src: 'v8-b2-zemetekile-hb',
      code: '1,2,3,4,10',
      sound: '22_bonus_zemetekile',
      loop: 6,
    },
    {
      name: 'Cumulor',
      src: 'v8-b3-cumulor-hb',
      code: '4,5,14,16,18',
      sound: '23_bonus_cumulor',
      loop: 6,
    },
  ],
}
var preventActionUsed = !(versions.v9 = {
    name: 'Flow',
    version: '9',
    date: '2023',
    folder: 'asset-v9/',
    looptime: 5053,
    bpm: 95,
    totalframe: 242,
    nbpolo: 7,
    bonusloopA: true,
    bonusendloopA: false,
    colBck: '#00102B',
    col0: '#008EFF',
    col1: '#005CFA',
    col2: '#0048C3',
    col3: '#00348C',
    col4: '#002055',
    animearray: [
      {
        name: '01_boo_9',
        color: '9448ff',
        uniqsnd: false,
      },
      {
        name: '02_kevin',
        color: 'fa340f',
        uniqsnd: false,
      },
      {
        name: '03_double_k',
        color: '19d428',
        uniqsnd: false,
      },
      {
        name: '04_blue_gt',
        color: '2c86fe',
        uniqsnd: true,
      },
      {
        name: '05_mj_182',
        color: '19d428',
        uniqsnd: true,
      },
      {
        name: '06_boom_fuzz',
        color: '2c86fe',
        uniqsnd: false,
      },
      {
        name: '07_asap_bee',
        color: '19d428',
        uniqsnd: false,
      },
      {
        name: '08_m_o_g',
        color: 'ffca06',
        uniqsnd: false,
      },
      {
        name: '09_arashi',
        color: '2c86fe',
        uniqsnd: false,
      },
      {
        name: '10_big_duke',
        color: 'fa340f',
        uniqsnd: false,
      },
      {
        name: '11_swingy',
        color: '2c86fe',
        uniqsnd: false,
      },
      {
        name: '12_d_invaders',
        color: '19d428',
        uniqsnd: false,
      },
      {
        name: '13_doo_doo',
        color: '2c86fe',
        uniqsnd: true,
      },
      {
        name: '14_8_bit',
        color: '19d428',
        uniqsnd: false,
      },
      {
        name: '15_kc_glow',
        color: '9448ff',
        uniqsnd: false,
      },
      {
        name: '16_el_cool_p',
        color: 'fa340f',
        uniqsnd: false,
      },
      {
        name: '17_memphis',
        color: '2c86fe',
        uniqsnd: false,
      },
      {
        name: '18_jogg_d',
        color: 'ffca06',
        uniqsnd: false,
      },
      {
        name: '19_scooter',
        color: '19d428',
        uniqsnd: false,
      },
      {
        name: '20_lil_blaze',
        color: '2c86fe',
        uniqsnd: false,
      },
    ],
    bonusarray: [
      {
        name: 'Flow',
        src: 'v9-b1-flow-hb',
        code: '1,2,5,8,17',
        sound: '21_bonus_flow',
        aspire: 'aspire_flow',
        loop: 2,
      },
    ],
  }),
  preventActionDelay = 0.25
function preventAction(g) {
  preventActionUsed ||
    ((preventActionUsed = true),
    g(),
    setTimeout(function () {
      preventActionUsed = false
    }, preventActionDelay))
}
function tryfunc(g) {
  notnull(g) && 'function' === (typeof g).toLowerCase() && g()
}
function inIframe() {
  try {
    return window.self !== window.top
  } catch (g) {
    return true
  }
}
function callParentWindow(g, h) {
  isIframe &&
    (notnull(window.top) && notnull(window.top.appEvent)
      ? window.top.appEvent(g, h)
      : setTimeout(function () {
          callParentWindow(g, h)
        }, 200))
}
var regexList = {
  allchar: /[*]/,
  classic: /[^A-Za-z0-9\u00C0-\u017F '-]/,
  search: /[^A-Za-z0-9\u00C0-\u017F\u0025 '-]/,
  max3letters: /[*]|(.)(?=\1\1\1)/gi,
  strict: /[^A-Za-z0-9 '-]/,
  custom: /[^A-Za-z0-9àâçèéêîôùûÀÂÇÈÉÊÎÔÙÛ '-]/,
  email:
    /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,
  allsafe:
    /[^A-Za-z0-9\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\s]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,
}
function removeDupInArray(g, h) {
  var j,
    k = []
  for (j of g) existInArray(k, j, h) || k.push(j)
  return k
}
function uniqueBetweenArray(g, h, j) {
  var k,
    l = []
  for (k of g) existInArray(h, k, j) || l.push(k)
  for (k of h) existInArray(g, k, j) || l.push(k)
  return l
}
function existInArray(g, h, j) {
  for (var k = !notnull(j) || j, l = false, m = 0, p = g.length; m < p; m++) {
    if (k) {
      if (g[m] === h) {
        l = true
        break
      }
    } else {
      if (g[m].toLowerCase() === h.toLowerCase()) {
        l = true
        break
      }
    }
  }
  return l
}
function removeInArray(g, h) {
  for (var j = 0, k = h.length; j < k; j++) {
    if (h[j] === g) {
      h.splice(j, 1)
      break
    }
  }
  return h
}
function existInArrayFromProp(g, h, j) {
  for (var k = 0, l = j.length; k < l; k++) {
    if (j[k][h] === g) {
      return true
    }
  }
  return false
}
function numberArray(g) {
  for (var h = 0, i = g.length; h < i; h++) {
    g[h] = 0 | g[h]
  }
  return g
}
function xhr(g, h, j, k, l) {
  $.ajax({
    type: g,
    url: h,
    crossdomain: true,
    data: j,
    success: function (m) {
      k(m, j)
    },
    error: l || function () {},
    dataType: 'json',
  })
}
function renameFile(g) {
  return 1 == animSize ? g : nameToHD(g)
}
function nameToHD(g) {
  var h = g.substr(g.lastIndexOf('.'))
  return g.split(h).join('-hd' + h)
}
function loadSnd(g, h, j, k) {
  var m = new XMLHttpRequest()
  m.open('GET', g, true)
  m.responseType = 'arraybuffer'
  m.onload = function () {
    h.decodeAudioData(
      m.response,
      function (p) {
        j(p)
      },
      function (p) {
        k()
      }
    )
  }
  m.onerror = function () {
    k()
  }
  m.send()
}
function gotoAppUrl(g) {
  g = isnull(g) ? (appBrowser ? '' : 'index.html') : g
  window.location.href = g
}
function reloadPage() {
  ;(appBrowser ? window.top : window).location.reload()
}
function openURL(g, h) {
  var j = isIframe ? window.top : window,
    h = isnull(h) ? '_blank' : h,
    h = appBrowserDemo && isIOS ? '_self' : h
  window.electron
    ? electron.ipc.openURL(g)
    : window.cordova
    ? cordova.InAppBrowser.open(g, '_system', 'hidden=yes,location=no')
    : j.open(g, h)
}
function redirectTo(g) {
  var i = domainOnline + 'url/' + g,
    i = appCN ? i + '-cn' : i
  openURL(
    (i = window.cordova
      ? {
          facebook: 'https://www.facebook.com/incredibox',
          twitter: 'https://twitter.com/incredibox_',
          instagram: 'https://www.instagram.com/incredibox.official/',
          youtube: 'https://www.youtube.com/incredibox',
        }[g] || i
      : i)
  )
}
function windowPopup(g, h, j, k) {
  var m = k ? screen.height / 2 - j / 2 : 0,
    k = k ? screen.width / 2 - h / 2 : 0
  window.open(
    g,
    '',
    'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,width=' +
      h +
      ',height=' +
      j +
      ',top=' +
      m +
      ',left=' +
      k
  )
}
function getParameterByName(g) {
  var h = { k: l },
    i =
      (window.location.href.replace(
        /[?&]+([^=&]+)=([^&]*)/gi,
        function (j, k, l) {}
      ),
      null)
  return (i = g in h ? h[g] : i)
}
function getPageNameGA() {
  return -1 != window.location.href.indexOf('app.html')
    ? 'app.html?v=' + getParameterByName('v')
    : 'index.html'
}
function secToText(g) {
  var i,
    j = parseInt((g / 1000) % 60),
    k = parseInt((g / 60000) % 60)
  return (
    (i = parseInt((g / 3600000) % 24)),
    (k < 10 ? '0' + k : k) + ':' + (j < 10 ? '0' + j : j)
  )
}
function getTime() {
  return new Date().getTime()
}
function getTimeAgo(g, h) {
  g = -1 == g.indexOf('/') ? g.split('-').join('/') : g
  h = -1 == h.indexOf('/') ? h.split('-').join('/') : h
  var i = new Date(g),
    h = timeConversion(new Date(h).getTime() - i.getTime())
  return false === h ? getStringDate(g) : h
}
function timeConversion(g) {
  var j = (g / 1000).toFixed(1),
    k = (g / 60000).toFixed(1),
    l = (g / 3600000).toFixed(1),
    g = (g / 86400000).toFixed(1),
    m = ''
  if (j < 60) {
    j = Math.round(j)
    m =
      j.toString() +
      ' ' +
      (j < 2 && notnull(STR('txt.time.tSec.one'))
        ? STR('txt.time.tSec.one')
        : STR('txt.time.tSec.other'))
  } else {
    if (k < 60) {
      j = Math.round(k)
      m =
        j.toString() +
        ' ' +
        (j < 2 && notnull(STR('txt.time.tMin.one'))
          ? STR('txt.time.tMin.one')
          : STR('txt.time.tMin.other'))
    } else {
      if (l < 23) {
        k = Math.round(l)
        m =
          k.toString() +
          ' ' +
          (k < 2 && notnull(STR('txt.time.tHou.one'))
            ? STR('txt.time.tHou.one')
            : STR('txt.time.tHou.other'))
      } else {
        if (!(g < 10)) {
          return false
        }
        j = Math.round(g)
        m =
          j.toString() +
          ' ' +
          (j < 2 && notnull(STR('txt.time.tDay.one'))
            ? STR('txt.time.tDay.one')
            : STR('txt.time.tDay.other'))
      }
    }
  }
  return STR('txt.ago').split('%{date_time}').join(m)
}
function getDateNow() {
  var h = new Date(),
    j = h.getDate(),
    k = h.getMonth() + 1,
    l = h.getFullYear(),
    m = h.getHours(),
    p = h.getMinutes(),
    h = h.getSeconds(),
    j = j < 10 ? String('0' + j) : String(j),
    k = k < 10 ? String('0' + k) : String(k),
    m = m < 10 ? String('0' + m) : String(m),
    p = p < 10 ? String('0' + p) : String(p),
    h = h < 10 ? String('0' + h) : String(h)
  return String(l + '-' + k + '-' + j + ' ' + m + ':' + p + ':' + h)
}
function jsonDecode(g) {
  return isnull(g)
    ? null
    : ((g = g.split('\t').join('').split('\n').join('')), JSON.parse(g))
}
function jsonEncode(g) {
  return isnull(g) ? null : JSON.stringify(g)
}
function random(g) {
  return Math.round(Math.random() * g)
}
function randomRangeInt(g, h) {
  return (
    (g = Math.ceil(g)),
    (h = Math.floor(h)),
    Math.floor(Math.random() * (h - g + 1)) + g
  )
}
function decimal(g, h) {
  return (h = isnull(h) ? 2 : h), (h = Math.pow(10, h)), Math.round(g * h) / h
}
function numberSpaced(g) {
  var h
  return g
    ? ((g = g.toString()),
      (h = g.indexOf('.')),
      g.replace(/\d(?=(?:\d{3})+(?:\.|$))/g, function (i, j) {
        return h < 0 || j < h ? i + ' ' : i
      }))
    : 0
}
function trim(g) {
  return isnull(g)
    ? ''
    : (g = (g = (g = g.split('\t').join('')).split('\n').join(''))
        .split('\r')
        .join('')).replace(/^\s+|\s+$|\s+(?=\s)/g, '')
}
function cleanInputText(g) {
  return (g = (g = trim((g = ucwords(g)))).replace(regexList.max3letters, ''))
}
function slugify(g) {
  return g
    .toString()
    .toLowerCase()
    .replace(/\s+/g, '-')
    .replace(/&/g, '-and-')
    .replace(/[^\w\-]+/g, '')
    .replace(/\-\-+/g, '-')
    .replace(/^-+/, '')
}
function ucwords(g) {
  return (g = g.toLowerCase()).charAt(0).toUpperCase() + g.slice(1)
}
function uniqid(g) {
  g = g || ''
  function i() {
    return Math.floor(65536 * (1 + Math.random()))
      .toString(16)
      .substring(1)
  }
  return i() + g + i() + g + i() + g + i() + g + i()
}
function uniqid30() {
  function h() {
    return Math.floor(65536 * (1 + Math.random())).toString(16)
  }
  return h() + h() + h() + h() + h() + h()
}
function getUniqLink(g) {
  return (g = notnull(g) ? g.app : app.version), uniqid() + '-v' + g
}
function isnull(g) {
  return null == g || 'undefined' === g
}
function notnull(g) {
  return null != g && 'undefined' !== g
}
function copyToClipboard(g) {
  var i = document.createElement('textarea')
  i.value = g
  i.setAttribute('readonly', '')
  i.style = {
    position: 'absolute',
    visibility: 'hidden',
    pointerEvents: 'none',
  }
  document.body.appendChild(i)
  i.select()
  document.execCommand('copy')
  document.body.removeChild(i)
}
function resetAnimationCSS(g) {
  g.style.animation = 'none'
  g.offsetHeight
  g.style.animation = null
}
function transitionEndEventName() {
  var g,
    h = document.createElement('div'),
    i = {
      transition: 'transitionend',
      OTransition: 'oTransitionEnd',
      MozTransition: 'transitionend',
      WebkitTransition: 'webkitTransitionEnd',
    }
  for (g in i)
    if (i.hasOwnProperty(g) && void 0 !== h.style[g]) {
      return i[g]
    }
  return null
}
function animationEndEventName() {
  var g,
    h = document.createElement('div'),
    i = {
      animation: 'animationend',
      OAnimation: 'oanimationend',
      MozAnimation: 'animationend',
      WebkitAnimation: 'webkitAnimationEnd',
    }
  for (g in i)
    if (i.hasOwnProperty(g) && void 0 !== h.style[g]) {
      return i[g]
    }
  return null
}
function addTransition(g, h, j, k, l) {
  l = !!notnull(l) && l
  g.off(transitionEnd).addClass(h).on(
    transitionEnd,
    {
      div: g,
      prop: j,
      func: k,
      log: l,
    },
    transitionComplete
  )
}
function removeTransition(g, h, j, k, l) {
  l = !!notnull(l) && l
  g.off(transitionEnd).removeClass(h).on(
    transitionEnd,
    {
      div: g,
      prop: j,
      func: k,
      log: l,
    },
    transitionComplete
  )
}
function transitionComplete(g) {
  notnull(g.data) &&
    notnull(g.data.func) &&
    g.originalEvent.propertyName.replace('-webkit-', '') == g.data.prop &&
    g.data.div.attr('id') == g.target.id &&
    (notnull(g.data.log), g.data.div.off(transitionEnd), g.data.func())
}
function stopProp(g) {
  notnull(g) && g.stopPropagation()
}
String.prototype.replaceAt = function (g, h) {
  return this.substr(0, g) + h + this.substr(g + h.length)
}
var drawMinTopY,
  drawMaxTopY,
  drawMaxRandPosY,
  drawMaxBounceY,
  drawPoloW,
  drawPoloH,
  drawEyeW,
  drawEyeH,
  drawAnimW,
  drawAnimH,
  drawEyeY,
  drawPupW,
  drawPup1X,
  drawPup1Y,
  drawPup2X,
  drawPup2Y,
  drawMaxPupMove,
  cropPoloW,
  cropPoloH,
  cropAnimW,
  cropAnimH,
  cropEyeW,
  cropEyeH,
  cropEyeX,
  cropEyeY,
  cropEyelidX,
  cropEyelid1Y,
  cropEyelid2Y,
  cropEyelid3Y,
  cropEyelid4Y,
  cropPupY,
  cropPupW,
  canvasBound,
  canvasScale,
  poloRatio,
  poloBlocW,
  poloOverlapW,
  poloBlocX,
  sizes = {
    polo: {
      sprWidth: 164,
      sprHeight: 400,
      overlapW: 30,
      minTopY: 10,
      maxTopY: 380,
      maxRandomY: 30,
      maxBounceY: 25,
      sprAnimW: 164,
      sprAnimH: 380,
      eyesTopY: 97,
      sprEyesW: 164,
      sprEyesH: 40,
      sprEyesX: 492,
      sprEyesY: 0,
      sprEyelidX: 328,
      sprEyelid1Y: 0,
      sprEyelid2Y: 40,
      sprEyelid3Y: 80,
      sprEyelid4Y: 120,
      sprPupY: 450,
      sprPupW: 16,
      pup1X: 54,
      pup1Y: 110,
      pup2X: 95,
      pup2Y: 110,
      maxPupMove: 7,
    },
    canvas: {
      baseW: 1028,
      baseH: 380,
      marge: 50,
      maxOverflow: 20,
    },
    video: {
      baseW: 1000,
      baseH: 400,
    },
  },
  bottomNeedSlide = false
function getViewport() {
  var g = document.body.clientWidth,
    h = document.body.clientHeight
  return (
    g < h &&
      ((g = document.body.clientHeight), (h = document.body.clientWidth)),
    {
      w: g,
      h: h,
    }
  )
}
function resizeApp() {
  var k, q, w, x, y, z, A, B, C, D, E, F, G, H, I, J, K, L, M
  pageApp &&
    (miniPlayer && (sizes.canvas.marge = 15),
    (cropPoloW = sizes.polo.sprWidth * animSize),
    (cropPoloH = sizes.polo.sprHeight * animSize),
    (cropAnimW = sizes.polo.sprAnimW * animSize),
    (cropAnimH = sizes.polo.sprAnimH * animSize),
    (cropEyeW = sizes.polo.sprEyesW * animSize),
    (cropEyeH = sizes.polo.sprEyesH * animSize),
    (cropEyeX = sizes.polo.sprEyesX * animSize),
    (cropEyeY = sizes.polo.sprEyesY * animSize),
    (cropEyelidX = sizes.polo.sprEyelidX * animSize),
    (cropEyelid1Y = sizes.polo.sprEyelid1Y * animSize),
    (cropEyelid2Y = sizes.polo.sprEyelid2Y * animSize),
    (cropEyelid3Y = sizes.polo.sprEyelid3Y * animSize),
    (cropEyelid4Y = sizes.polo.sprEyelid4Y * animSize),
    (cropPupY = sizes.polo.sprPupY * animSize),
    (cropPupW = sizes.polo.sprPupW * animSize),
    (k = document.querySelector('#game')),
    (q = document.querySelector('#box-top')),
    (w = document.querySelector('#box-stage')),
    (x = w.querySelector('#cnv-stage')),
    (y = w.querySelector('#box-polo')),
    (z = document.querySelector('#box-loader-polo')),
    (A = document.querySelector('#box-video')),
    (B = document.querySelector('#box-picto')),
    (C = A.querySelectorAll('.video')),
    (D = sizes.canvas.baseW / sizes.canvas.baseH),
    (G = sizes.video.baseW / sizes.video.baseH),
    (M = hasHBI ? 25 : 0),
    (window.onresize = function () {
      C &&
        (k.clientWidth / k.clientHeight < 1.6
          ? ((bottomNeedSlide = false),
            (L = w.clientHeight),
            document.body.classList.contains('bottomSlide') &&
              document.body.classList.remove('bottomSlide'))
          : ((bottomNeedSlide = !miniPlayer),
            (L = k.clientHeight - 2 * q.clientHeight)),
        (H = (I = L) * G) < k.clientWidth &&
          ((H = Math.ceil(k.clientWidth)), (I = Math.ceil(H / G))),
        (J = Math.round((H - A.clientWidth) / 2)),
        (K = Math.round((I - L) / 2)),
        C.forEach((O) => {
          O.style.width = H + 'px'
          O.style.height = I + 'px'
          O.style.transform = 'translate(' + -J + 'px, ' + -K + 'px)'
        }))
      x &&
        ((F = w.clientHeight + sizes.canvas.maxOverflow),
        (E = F * D) > w.clientWidth - 2 * sizes.canvas.marge &&
          ((E = w.clientWidth - 2 * sizes.canvas.marge), (F = E / D)),
        appBrowser &&
          E > sizes.canvas.baseW &&
          ((E = sizes.canvas.baseW), (F = E / D)),
        (x.style.width = E + 'px'),
        (x.style.height = F + 'px'),
        (y.style.width = E + 'px'),
        (y.style.height = F + 'px'),
        (z.style.width = E + 'px'),
        (B.style.width = 0.92 * E - 2 * M + 'px'),
        (x.width = x.clientWidth * cnvPXD),
        (x.height = x.clientHeight * cnvPXD),
        (canvasBound = x.getBoundingClientRect()),
        (canvasScale = x.clientHeight / sizes.canvas.baseH),
        (poloOverlapW =
          (canvasBound.width * sizes.polo.overlapW) / sizes.canvas.baseW),
        (poloBlocW =
          (canvasBound.width + poloOverlapW * (nbPoloMax - 1)) / nbPoloMax),
        (poloBlocX = (canvasBound.width - poloBlocW) / (nbPoloMax - 1)),
        (poloRatio = poloBlocW / sizes.polo.sprWidth),
        (drawMinTopY = sizes.polo.minTopY * canvasScale * cnvPXD),
        (drawMaxTopY = sizes.polo.maxTopY * canvasScale * cnvPXD),
        (drawMaxRandPosY = sizes.polo.maxRandomY * canvasScale * cnvPXD),
        (drawMaxBounceY = sizes.polo.maxBounceY * canvasScale * cnvPXD),
        (drawPoloW = sizes.polo.sprWidth * poloRatio * cnvPXD),
        (drawPoloH = sizes.polo.sprHeight * poloRatio * cnvPXD),
        (drawEyeW = sizes.polo.sprEyesW * poloRatio * cnvPXD),
        (drawEyeH = sizes.polo.sprEyesH * poloRatio * cnvPXD),
        (drawEyeY = sizes.polo.eyesTopY * poloRatio * cnvPXD),
        (drawAnimW = sizes.polo.sprAnimW * poloRatio * cnvPXD),
        (drawAnimH = sizes.polo.sprAnimH * poloRatio * cnvPXD),
        (drawPupW = sizes.polo.sprPupW * poloRatio * cnvPXD),
        (drawPup1X = sizes.polo.pup1X * poloRatio * cnvPXD),
        (drawPup1Y = sizes.polo.pup1Y * poloRatio * cnvPXD),
        (drawPup2X = sizes.polo.pup2X * poloRatio * cnvPXD),
        (drawPup2Y = sizes.polo.pup2Y * poloRatio * cnvPXD),
        (drawMaxPupMove = sizes.polo.maxPupMove * poloRatio * cnvPXD))
      listPolo &&
        listPolo.length &&
        listPolo.forEach(function (O, P) {
          O.resize()
          pause && O.draw()
        })
    }),
    window.onresize())
}
var pageExt,
  appBrowser,
  transitionEnd,
  animationEnd,
  iosVersion,
  iosVersionNumber,
  debugMute = getParameterByName('mute') || false,
  debugGame = getParameterByName('game') || false,
  debugScene = getParameterByName('scene') || false,
  debugBonus = getParameterByName('bonus') || false,
  build = {
    id: '1545450',
    store: 'steam',
    platform: 'desktop',
    os: 'osx',
    osMinimum: '',
    storeURL: 'https://store.steampowered.com/app/1545450/',
    version: '1.1.5',
    htmlExt: 'html',
  },
  domainOnline = 'https://www.incredibox.com/',
  appCN = false,
  machine = {},
  user = {},
  hasNetwork = false,
  sndExt = 'ogg',
  vidExt = 'webm',
  appBrowserDemo = false,
  appBrowserSchool = false,
  featureLocked = false,
  isMouseDevice = checkMouseDevice(),
  isTouchDevice = checkTouchDevice(),
  isMobile = false,
  trustAppMobile = window.cordova || false,
  isIframe = inIframe(),
  pointerEventType = {},
  isIOS = false,
  isIOSMac = false,
  isOSX = false,
  isWin = false,
  isAndroid = false,
  isiPod = false,
  isiPhone = false,
  isiPad = false,
  isiPadPro = false,
  hasHBI = false,
  animSize = 1,
  cnvPXD = 2
function checkSystem() {
  pageApp =
    window.location.href.includes('app.html') ||
    window.location.href.includes('app.php') ||
    '1' == getParameterByName('afs')
  pageExt = build.htmlExt
  appBrowser = 'browser' == build.platform
  appBrowserDemo = checkInPWA()
  appBrowserSchool = !!notnull(getParameterByName('afs'))
  featureLocked = (appBrowser || appBrowserDemo) && !appBrowserSchool
  hasNetwork = networkState()
  machine = getDeviceInfo(true)
  user = getUserInfo()
  isAndroid = /android/i.test(machine.osName)
  isWin = /windows/i.test(machine.osName)
  isOSX = /mac os/i.test(machine.osName)
  isIOS = /ios/i.test(machine.osName)
  isIOSMac =
    !(!window.device || !window.device.isiOSAppOnMac) &&
    window.device.isiOSAppOnMac
  ;(iosVersion =
    !(!window.device || !window.device.version) && window.device.version) &&
    ((h = iosVersion.split('.')),
    (iosVersionNumber = Number(String(h[0]) + String(h[1])[0])))
  isiPod = isIOS && /ipod/i.test(machine.osName)
  isiPhone = isIOS && /iphone/i.test(machine.osName)
  isiPad = isIOS && /ipad/i.test(machine.deviceModel)
  isiPadPro = isIOS && /ipadpro/i.test(machine.deviceModel)
  isRetina = checkRetina()
  isMobile = checkMobile()
  hasHBI = isIOS && checkHBI()
  animSize =
    1024 <= document.body.clientWidth && 768 <= document.body.clientHeight
      ? 2
      : 1
  appBrowser &&
    ((animSize = 1),
    (sndExt = checkAudioFormat('ogg') ? 'ogg' : sndExt),
    (vidExt =
      isAndroid ||
      ('mozilla firefox' == machine.browserName && machine.browserVersion <= 48)
        ? 'webm'
        : 'mp4'))
  pointerEventType = setPointerEvent()
  transitionEnd = transitionEndEventName()
  animationEnd = animationEndEventName()
  window.cordova
  window.electron
  var h = window.cordova ? document : window
  if (
    (h.addEventListener('online', networkOn, false),
    h.addEventListener('offline', networkOff, false),
    document.body.classList.remove('black'),
    window.electron && document.body.classList.add('electron'),
    pageApp ||
      window.electron ||
      document.getElementById('fade-all').classList.add('white'),
    pageApp &&
      (document.body.classList.add('v' + appVersion),
      document.body.classList.add('darkback')),
    !appBrowser ||
      appBrowserDemo ||
      appBrowserSchool ||
      document.body.classList.add('appBrowser'),
    appBrowserDemo && document.body.classList.add('appBrowserDemo'),
    appBrowserSchool && document.body.classList.add('afs'),
    featureLocked && document.body.classList.add('featureLocked'),
    hasHBI && document.body.classList.add('hasHBI'),
    miniPlayer && document.body.classList.add('miniPlayer'),
    window.cordova &&
      isAndroid &&
      document.addEventListener(
        'backbutton',
        function (i) {
          i.preventDefault()
          clickAndroidBackButton()
        },
        false
      ),
    window.cordova &&
      pageApp &&
      !isIOSMac &&
      !window.electron &&
      (document.addEventListener('pause', appOnPause, false),
      document.addEventListener('resume', appOnResume, false)),
    window.cordova &&
      pageApp &&
      isAndroid &&
      (window.addEventListener('native.keyboardshow', VKBopen),
      window.addEventListener('native.keyboardhide', VKBclose)),
    pageApp && !window.cordova && window.electron,
    window.electron &&
      'steam' == build.store &&
      'YXJw' != btoa(electron.vars.arg))
  ) {
    throw (
      (new BoxDialog('#pop-dialog').open(
        'Incredibox needs to run from<br>your Steam library.<br>Thanks for your support!',
        '&#129488;',
        [],
        true,
        true
      ),
      new Error('Please connect to your Steam account'))
    )
  }
}
function checkHBI() {
  if (window.cordova) {
    var h = getComputedStyle(document.documentElement).getPropertyValue('--sab')
    if (h && '' != h && 0 < parseInt(h)) {
      return true
    }
  }
  return false
}
function getListUUID() {
  var h,
    i = []
  for (h in (i.push(machine.uuid), storage.getAllItem()))
    -1 != h.indexOf('uuid-') &&
      ('' != h.replace('uuid-', '')
        ? i.push(h.replace('uuid-', ''))
        : storage.removeItem(h))
  return removeDupInArray(i, false)
}
function secureIframe() {}
function checkInBrowser() {
  return (
    -1 < document.URL.indexOf('http://') ||
    -1 < document.URL.indexOf('https://')
  )
}
function checkInPWA() {
  return (
    !(!window.navigator || true !== window.navigator.standalone) ||
    !!window.matchMedia('(display-mode: standalone)').matches
  )
}
function checkMobile() {
  var g
  return !(
    window.electron ||
    isIOSMac ||
    isiPad ||
    ((g = getViewport()), !(isiPod || isiPhone || (g.h <= 500 && g.w <= 1000)))
  )
}
function checkRetina() {
  var g
  return (
    !!window.matchMedia &&
    (((g = window.matchMedia(
      'only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen  and (min-device-pixel-ratio: 1.3), only screen and (min-resolution: 1.3dppx)'
    )) &&
      g.matches) ||
      1 < window.devicePixelRatio)
  )
}
function checkTouchDevice() {
  var h = false
  try {
    document.createEvent('TouchEvent')
    h = true
  } catch (i) {}
  return (
    (window.hasOwnProperty('ontouchstart') ||
      0 < navigator.maxTouchPoints ||
      0 < navigator.msMaxTouchPoints) &&
      (h = true),
    (h = window.matchMedia('(pointer: coarse)').matches ? true : h)
  )
}
function checkMouseDevice() {
  return (
    window.matchMedia('(hover: hover)').matches &&
    window.matchMedia('(pointer: fine)').matches
  )
}
function getAppData() {
  return {
    build: build,
    machine: machine,
    user: user,
  }
}
function checkAudioFormat(g) {
  g = g || 'mp3'
  var i = document.createElement('audio')
  return !(
    !i.canPlayType || !i.canPlayType('audio/' + g + ';').replace(/no/, '')
  )
}
function checkSupported() {
  var g = window.hasOwnProperty('HTMLCanvasElement'),
    h = window.AudioContext || window.webkitAudioContext || false,
    j =
      window.requestAnimationFrame ||
      window.webkitRequestAnimationFrame ||
      false,
    k = 'string' == typeof new XMLHttpRequest().responseType,
    l = !isnull(transitionEnd) && !isnull(animationEnd)
  return (
    (window.AudioContext = h),
    (window.requestAnimationFrame = j),
    g
      ? h
        ? k
          ? l
            ? j
              ? 'ok'
              : 'RAF'
            : 'CSS3'
          : 'XHR'
        : 'Audio API'
      : 'Canvas'
  )
}
function lockScreenEdges() {
  window.cordova &&
    'object' == typeof ScreenEdgesPlugin &&
    ScreenEdgesPlugin.setPreferredEdges(
      ['top', 'bottom'],
      function () {},
      function (g) {}
    )
}
function unlockScreenEdges() {
  window.cordova &&
    'object' == typeof ScreenEdgesPlugin &&
    ScreenEdgesPlugin.setPreferredEdges(
      [],
      function () {},
      function (g) {}
    )
}
function converterCanRun() {
  var h = 'function' == typeof window.Worker
  return window.cordova, h
}
function setPointerEvent(g) {
  var h = window.hasOwnProperty('PointerEvent')
      ? 'pointer'
      : window.hasOwnProperty('TouchEvent')
      ? 'touch'
      : 'mouse',
    g = g || h,
    h = {}
  return (
    'pointer' == g
      ? ((h.down = 'pointerdown'),
        (h.up = 'pointerup'),
        (h.move = 'pointermove'),
        (h.cancel = 'pointercancel'),
        (h.leave = 'pointerleave'))
      : 'touch' == g
      ? ((h.down = 'touchstart'),
        (h.up = 'touchend'),
        (h.move = 'touchmove'),
        (h.cancel = 'touchcancel'),
        (h.leave = 'touchcancel'))
      : 'mouse' == g &&
        ((h.down = 'mousedown'),
        (h.up = 'mouseup'),
        (h.move = 'mousemove'),
        (h.cancel = 'mouseleave'),
        (h.leave = 'mouseleave')),
    h
  )
}
function initRightClick() {
  window.oncontextmenu = function () {
    return false
  }
}
function networkOn() {
  hasNetwork = true
  localMixObject.saveMixOffline()
  initAnalytics()
}
function networkOff() {
  hasNetwork = false
}
function networkState() {
  var g = false
  return (
    navigator.onLine
      ? (g = navigator.onLine)
      : navigator.network &&
        navigator.network.connection &&
        navigator.network.connection.type &&
        (g = !(navigator.network.connection.type == Connection.NONE)),
    g
  )
}
function keepAppAwake() {
  window.plugins &&
    window.plugins.insomnia &&
    !isIOSMac &&
    window.plugins.insomnia.keepAwake(
      function () {},
      function () {}
    )
}
function stopKeepingAppAwake() {
  window.plugins &&
    window.plugins.insomnia &&
    !isIOSMac &&
    window.plugins.insomnia.allowSleepAgain(
      function () {},
      function () {}
    )
}
function deleteUserInfo() {}
function getUserInfo() {
  return {
    guid: storage.getItem('user-guid') || '',
    djname: storage.getItem('user-djname') || '',
    lang: storage.getItem('user-lang') || '',
  }
}
function setUserInfo(g) {
  notnull(g.guid) &&
    ((g.guid = 30 == g.guid.length ? g.guid : ''),
    (user.guid = g.guid),
    storage.setItem('user-guid', user.guid, true))
  notnull(g.djname) &&
    ((user.djname = g.djname),
    storage.setItem('user-djname', user.djname, true))
  notnull(g.lang) &&
    ((user.lang = g.lang), storage.setItem('user-lang', user.lang, true))
  user = getUserInfo()
}
function getDeviceInfo(g) {
  var j,
    k,
    q = navigator.userAgent || navigator.vendor || window.opera,
    w = q.toLowerCase(),
    x = '(?)',
    y =
      (/(fban|fbios|fbav|fbbv|fbid)/gi.test(w)
        ? (x = 'Facebook')
        : /(twitter)/gi.test(w) && (x = 'Twitter'),
      '(?)'),
    z =
      (window.cordova && device
        ? (y = device.platform)
        : (/(macintosh)/gi.test(w) &&
            navigator.maxTouchPoints &&
            2 < navigator.maxTouchPoints) ||
          /(iphone|ipad|ipod)/gi.test(w)
        ? (y = 'iOS')
        : /(mac os x)/gi.test(w)
        ? (y = 'Mac OS X')
        : /(macppc|macintel|mac_powerpc|macintosh)/gi.test(w)
        ? (y = 'Mac OS')
        : /(windows|win16)/gi.test(w)
        ? (y = 'Windows')
        : /(android)/gi.test(w) && (y = 'Android'),
      '(?)'),
    A = w,
    A =
      (window.cordova && device && (A = device.model),
      /(windows phone|windows phone)/gi.test(A)
        ? (z = 'Windows phone')
        : /(windows|win16)/gi.test(A)
        ? (z = 'PC')
        : /(android)/gi.test(A)
        ? (z = 'Android')
        : /(macintosh)/gi.test(A) &&
          navigator.maxTouchPoints &&
          2 < navigator.maxTouchPoints &&
          1024 == window.screen.width &&
          1366 == window.screen.height
        ? (z = 'iPadPro')
        : (/(macintosh)/gi.test(A) &&
            navigator.maxTouchPoints &&
            2 < navigator.maxTouchPoints) ||
          /(ipad)/gi.test(A)
        ? (z = 'iPad')
        : /(iphone)/gi.test(A)
        ? (z = 'iPhone')
        : /(ipod)/gi.test(A)
        ? (z = 'iPod')
        : /(mac)/gi.test(A) && (z = 'Mac'),
      window.cordova &&
        device &&
        null != appleModel[device.model] &&
        /ipad pro/i.test(appleModel[device.model]) &&
        (A = 'iPadPro'),
      '(?)'),
    B =
      (window.cordova && device
        ? (A = device.model)
        : null != window.navigator &&
          null != navigator.platform &&
          (A = navigator.platform),
      '(?)'),
    w =
      (window.cordova && device
        ? (B = device.version)
        : 'Windows' == y
        ? /(windows 10.0|windows nt 10.0)/gi.test(w)
          ? (B = '10')
          : /(windows 8.1|windows nt 6.3)/gi.test(w)
          ? (B = '8.1')
          : /(windows 8|windows nt 6.2)/gi.test(w)
          ? (B = '8')
          : /(windows 7|windows nt 6.1)/gi.test(w)
          ? (B = '7')
          : /(windows nt 6.0)/gi.test(w)
          ? (B = 'Vista')
          : /(windows nt 5.2)/gi.test(w)
          ? (B = 'Server 2003')
          : /(windows nt 5.1|windows xp)/gi.test(w)
          ? (B = 'XP')
          : /(windows nt 5.0|windows 2000)/gi.test(w)
          ? (B = '2000')
          : /(win 9x 4.90|windows me)/gi.test(w)
          ? (B = 'ME')
          : /(windows 98|win98)/gi.test(w)
          ? (B = '98')
          : /(windows 95|win95|windows_95)/gi.test(w)
          ? (B = '95')
          : /(windows nt 4.0|winnt4.0|winnt|windows nt)/gi.test(w)
          ? (B = 'NT 4.0')
          : /(windows ce)/gi.test(w)
          ? (B = 'CE')
          : /(win16)/gi.test(w) && (B = '3.11')
        : 'Android' == y
        ? ((D = 'Android'),
          (E = q.toLowerCase().indexOf(D.toLowerCase())),
          (C = parseFloat(q.slice(E + D.length, E + D.length + 6))),
          (B = isNaN(C) ? B : C))
        : 'iOS' == y
        ? ((D = 'OS'),
          (E = q.toLowerCase().indexOf(D.toLowerCase())),
          (C = q.slice(E + D.length, E + D.length + 6)),
          (C = parseFloat(C.replace('_', '.'))),
          (B = isNaN(C) ? B : C))
        : -1 != y.indexOf('Mac OS') &&
          ((D = -1 != y.indexOf('Mac OS X') ? 'Mac OS X' : 'Mac OS'),
          (E = q.toLowerCase().indexOf(D.toLowerCase())),
          (C = q.slice(E + D.length, E + D.length + 6)),
          (C = parseFloat(C.replace('_', '.'))),
          (B = isNaN(C) ? B : C)),
      0),
    C =
      ('iOS' == y &&
        (window.cordova && device
          ? null != appleModel[device.model] &&
            'iPhone' == z &&
            ((w = appleModel[device.model].replace('iPhone', '').split(' ')[0]),
            (w = /SE/i.test(w) ? 7 : /X/i.test(w) ? 10 : parseInt(w)))
          : 'iPhone' == z &&
            ((E = window.screen.width),
            (D = window.screen.height),
            320 == E && 480 == D
              ? (w = 4)
              : 320 == E && 568 == D
              ? (w = 5)
              : (375 == E && 667 == D) || (414 == E && 736 == D)
              ? (w = 6)
              : ((375 == E && 812 == D) || (414 == E && 896 == D)) && (w = 10),
            3 == window.devicePixelRatio) &&
            ((812 == E && 375 == D) || (896 == D && 414 == E)) &&
            (w = 10)),
      ''),
    D =
      (window.cordova && device
        ? (C = build.os)
        : /mac os/i.test(y)
        ? (C = 'osx')
        : /windows/i.test(y)
        ? (C = 'win')
        : /android/i.test(y)
        ? (C = 'and')
        : /ios/i.test(y) && (C = 'ios'),
      navigator.appName),
    E = '' + parseFloat(navigator.appVersion),
    F = parseInt(navigator.appVersion, 10),
    q =
      (-1 != (j = q.indexOf('OPR/'))
        ? ((D = 'Opera'), (E = q.substring(j + 4)))
        : -1 != (j = q.indexOf('Opera'))
        ? ((D = 'Opera'),
          (E = q.substring(j + 6)),
          -1 != (j = q.indexOf('Version')) && (E = q.substring(j + 8)))
        : -1 != (j = q.indexOf('Edge'))
        ? ((D = 'Microsoft Edge'), (E = q.substring(j + 5)))
        : -1 != (j = q.indexOf('MSIE'))
        ? ((D = 'Microsoft Internet Explorer'), (E = q.substring(j + 5)))
        : -1 != (j = q.indexOf('Trident'))
        ? ((D = 'Microsoft Internet Explorer'),
          -1 != (j = q.indexOf('rv:')) && (E = q.substring(j + 3)))
        : -1 != (j = q.indexOf('CriOS')) && /iphone|ipod|ipad/i.test(q)
        ? ((D = 'Google Chrome for IOS'), (E = q.substring(j + 6)))
        : -1 != (j = q.indexOf('Chrome'))
        ? ((D = 'Google Chrome'), (E = q.substring(j + 7)))
        : -1 != (j = q.indexOf('Safari'))
        ? ((D = 'Safari'),
          (E = q.substring(j + 7)),
          -1 != (j = q.indexOf('Version')) && (E = q.substring(j + 8)))
        : -1 != (j = q.indexOf('Firefox'))
        ? ((D = 'Mozilla Firefox'), (E = q.substring(j + 8)))
        : (k = q.lastIndexOf(' ') + 1) < (j = q.lastIndexOf('/')) &&
          ((D = q.substring(k, j)),
          (E = q.substring(j + 1)),
          D.toLowerCase() == D.toUpperCase()) &&
          (D = navigator.appName),
      -1 !=
        (k = (E = -1 != (k = E.indexOf(';')) ? E.substring(0, k) : E).indexOf(
          ' '
        )) && (E = E.substring(0, k)),
      (F = parseInt('' + E, 10)),
      isNaN(F) &&
        ((E = '' + parseFloat(navigator.appVersion)),
        (F = parseInt(navigator.appVersion, 10))),
      ''),
    G =
      (window.device && window.device.uuid
        ? (q = device.uuid.toUpperCase())
        : window.electron && window.electron.vars.uuid
        ? (q = window.electron.vars.uuid)
        : notnull(storage.getItem('tmp-uuid'))
        ? (q = storage.getItem('tmp-uuid'))
        : ((q = 'tmp-' + uniqid('-').toUpperCase()),
          storage.setItem('tmp-uuid', q)),
      {
        osName: y,
        osTiny: C,
        osVersion: B.toString(),
        deviceModel: z,
        deviceName: A,
        deviceNumber: w,
        browserName: D,
        browserVersion: F,
        browserFullVersion: E,
        browserAppName: navigator.appName,
        browserUserAgent: navigator.userAgent,
        language: navigator.language || '',
        webviewEmbed: x,
        uuid: q,
      }),
    H = 0
  if (true === g) {
    for (H in G) 'string' == typeof G[H] && (G[H] = G[H].toLowerCase())
  }
  if (window.device) {
    for (H in device);
  }
  for (H in G);
  return G
}
window.devicePixelRatio = window.devicePixelRatio || 1
secureIframe()
var appleModel = {}
function initRulesCSS() {
  var g = parseInt(
      getComputedStyle(document.documentElement).getPropertyValue('--sal')
    ),
    h = parseInt(
      getComputedStyle(document.documentElement).getPropertyValue('--sar')
    ),
    g = Math.max(g, h, 20),
    h = ':root {',
    g =
      (pageApp &&
        (h +=
          '\n\t\t\t--app-v : ' +
          appVersion +
          ';\n\t\t\t--colBck : ' +
          app.colBck +
          ';\n\t\t\t--col0 : ' +
          app.col0 +
          ';\n\t\t\t--col1 : ' +
          app.col1 +
          ';\n\t\t\t--col2 : ' +
          app.col2 +
          ';\n\t\t\t--col3 : ' +
          app.col3 +
          ';\n\t\t\t--col4 : ' +
          app.col4 +
          ';\n\t\t\t--url-img-home-screen : url(../asset-v' +
          appVersion +
          '/img/home-screen@2x.jpg);\n\t\t\t--url-img-home-titre : url(../asset-v' +
          appVersion +
          '/img/home-titre@2x.png);\n\t\t\t--url-img-home-version : url(../asset-v' +
          appVersion +
          '/img/home-version@2x.png);\n\t\t'),
      (h =
        h +
        ('\n\t\t\t--fullfill-padding : ' +
          g +
          'px;\n\t\t\t--url-img-bt-stores : url(' +
          domainOnline +
          'img/bt-stores-' +
          currentLanguage.split('-')[0] +
          '.png);\n\t\t') +
        '}'),
      document.head || document.getElementsByTagName('head')[0]),
    i = document.createElement('style')
  g.appendChild(i)
  i.type = 'text/css'
  i.appendChild(document.createTextNode(h))
}
function BoxDialog(g) {
  var i = this,
    j = $(g)
  function k(n) {
    n.preventDefault()
    stopProp(n)
    n.data.bt.addTouchAnimation()
    var q = true
    void 0 !== n.data.func && (n.data.func === l && (q = false), n.data.func())
    q && l()
  }
  function l() {
    i.neverClose || i.close()
  }
  return (
    (this['$div'] = j),
    (this['$bck'] = j.find('.bac')),
    (this['$scale'] = j.find('.scale')),
    (this['$box'] = j.find('.box')),
    (this['$pop'] = j.find('.pop')),
    (this['$pop']['$title'] = j.find('.title')),
    (this['$pop']['$text'] = j.find('.text')),
    (this['$pop']['$content'] = j.find('.content')),
    (this.opened = false),
    (this.neverClose = false),
    (this.isOpen = function () {
      return i.opened
    }),
    (this.open = function (q, v, w, x, y, z, A) {
      i.isOpen() &&
        (removeInFocusHistory('popup-dialog'), deleteFocus(), i.killall())
      j.on(pointerEventType.down, stopProp)
      i.opened = true
      i.neverClose = !isnull(z) && z
      q = isnull(q)
        ? 'Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod'
        : q
      v = isnull(v) ? 'Info' : v
      w = isnull(w) ? ['Close'] : w
      x = isnull(x) ? [l] : x
      y = !isnull(y) && y
      notnull(A) && j.attr('data-name', A)
      j.addClass('show')
      i.clean()
      i['$pop']['$title'].html(v)
      i['$pop']['$text'].html(q)
      for (var B = 0, C = w.length; B < C; B++) {
        var D = w[B],
          E = $('<div class="bt bt-light" id="bt-mini' + B + '"></div>')
        ;(E = new CustomButton(E)).html(
          '<div class="bck"><div class="txt">' +
            D +
            '</div></div><div class="hitzone"></div>'
        )
        E.on(
          pointerEventType.down,
          {
            func: x[B],
            bt: E,
          },
          k
        )
        i['$pop']['$content'].append(E)
      }
      y && j.css({ 'z-index': '9999' })
      i.fadeInBck()
      i['$box'].removeClass('open close').addClass('open')
      createFocus('popup-dialog')
    }),
    (this.close = function (n) {
      notnull(n) && n.preventDefault()
      i.fadeOutBck()
      i['$box']
        .removeClass('open close')
        .addClass('close')
        .one(animationEnd, function (q) {
          $(q.target).removeClass('close')
          j.removeClass('show')
          j.removeAttr('data-name')
          j.off()
          i.clean()
          i.opened = false
          removeInFocusHistory('popup-dialog')
          createFocusFromHistory()
        })
    }),
    (this.killall = function () {
      removeInFocusHistory('popup-dialog')
      j.off()
      j.removeAttr('data-name')
      j.removeClass('show')
      i.clean()
      i['$box'].removeClass('open close')
      resetAnimationCSS(i['$box'][0])
      i['$bck'].removeClass('animateFadeIn animateFadeOut')
      resetAnimationCSS(i['$bck'][0])
      i.opened = false
    }),
    (this.fadeInBck = function (n) {
      n ? i['$bck'].addClass('mini') : i['$bck'].removeClass('mini')
      i['$bck'].addClass('animateFadeIn')
    }),
    (this.fadeOutBck = function () {
      i['$bck'].addClass('animateFadeOut').one(animationEnd, function (n) {
        $(n.target).removeClass('animateFadeIn animateFadeOut')
      })
    }),
    (this.clean = function () {
      i['$pop']['$content'].find('.bt').off()
      i['$pop']['$content'].empty()
      i['$pop']['$title'].empty()
      i['$pop']['$text'].empty()
    }),
    this
  )
}
function Popup(g) {
  var j,
    k = this,
    q = $(g),
    v = q.find('.bac'),
    w = q.find('.box'),
    x = q.find('.bt.icon'),
    y = q.find('.container'),
    z = 0 < q.find('.box-tab .tab').length,
    A = true,
    B = true
  function C() {
    A = true
    v.removeClass('animateFadeIn animateFadeOut')
    k.closeComplete()
  }
  function D(F) {
    B = true
    w.removeClass('slideUp slideDown').get(0).offsetHeight
    j.onBoxCloseEnd()
    k.closeComplete()
    tryfunc(F)
  }
  function E() {
    notnull(k.onCloseTab) && k.onCloseTab()
    q.find('.tab.active').removeClass('active')
    q.find('.pop.active').removeClass('active')
    var F = $(this),
      G = q.find('.pop#' + F.attr('id').replace('tab-', 'pop-'))
    F.addClass('active')
    G.addClass('active')
    createFocus(G.attr('id'))
  }
  return (
    (this['$popup'] = q),
    (this['$icon'] = x),
    (this['$container'] = y),
    (this.objCustom = j),
    (this.open = function (F) {
      ;(notnull(j) && F.name == j.name) ||
        (q.hasClass('show') || q.addClass('show'),
        v.hasClass('animateFadeIn') || k.showBck(),
        w.hasClass('slideUp')
          ? k.hideBox(function () {
              k.open(F)
            })
          : (k.custom(F), k.showBox()))
    }),
    (this.close = function (F) {
      k.hideBck(F)
      k.hideBox(null, F)
    }),
    (this.closeComplete = function () {
      A && B && (k.reinit(), tryfunc(j.onCloseComplete), (j = null))
    }),
    (this.reinit = function () {
      j.static || y.empty()
      q.removeClass('show mini info action action-back no-action')
      q.removeAttr('data-name')
      v.removeClass('animateFadeIn animateFadeOut')
      w.removeClass('slideUp slideDown').get(0).offsetHeight
    }),
    (this.custom = function (F) {
      j = {
        static: F.static || false,
        bodyclose: F.bodyclose || false,
        bckclose: F.bckclose || false,
        name: F.name || 'no-name',
        icntype: F.icntype || '',
        class: F.class || '',
        content: F.content || '',
        onBoxOpenStart: F.onBoxOpenStart || nada,
        onBoxOpenEnd: F.onBoxOpenEnd || nada,
        onBoxCloseStart: F.onBoxCloseStart || nada,
        onBoxCloseEnd: F.onBoxCloseEnd || nada,
        onCloseComplete: F.onCloseComplete || nada,
      }
      q.removeClass('big column mini info action action-back no-action')
      q.addClass(j.class)
      q.attr('data-name', j.name)
      '' != j.icntype &&
        (q.addClass(j.icntype),
        x
          .find('svg use')
          .attr(
            'xlink:href',
            '#ic-' +
              ('action' == j.icntype
                ? 'close'
                : 'action-back' == j.icntype
                ? 'navl'
                : 'info')
          ))
      j.static || y.html(j.content)
    }),
    (this.refresh = function () {
      notnull(j) && notnull(j.content) && y.html(j.content)
    }),
    (this.showBck = function () {
      A = false
      v.addClass('animateFadeIn').one(animationEnd, function () {})
    }),
    (this.hideBck = function (F) {
      true === F
        ? C()
        : v.addClass('animateFadeOut').one(animationEnd, function () {
            C()
          })
    }),
    (this.showBox = function () {
      B = false
      j.onBoxOpenStart()
      z &&
        (q
          .find('.box-tab .tab')
          .first()
          .trigger(pointerEventType.down.split(' ')[0]),
        deleteFocus())
      w.addClass('slideUp').one(animationEnd, function () {
        j.bodyclose && $body.on(pointerEventType.down, k.clickBck)
        j.bckclose && v.on(pointerEventType.down, k.close)
        j.onBoxOpenEnd()
      })
    }),
    (this.hideBox = function (F, G) {
      j.bodyclose && $body.off(pointerEventType.down, k.clickBck),
        j.bckclose && v.off(pointerEventType.down, k.close),
        j.onBoxCloseStart(),
        true === G
          ? D(F)
          : w.addClass('slideDown').one(animationEnd, function () {
              D(F)
            })
    }),
    (this.clickBck = function (F) {
      F.preventDefault()
      0 < $(F.target).closest(g + ' .box').length ||
        ((!z ||
          ((F = notnull(
            (F = ~F.type.indexOf('touch') ? F.originalEvent : F).targetTouches
          )
            ? F.targetTouches[0]
            : F),
          100 < Math.round(F.pageY))) &&
          k.close())
    }),
    (this.isOpen = function () {
      return q.hasClass('show')
    }),
    (this.getName = function () {
      return notnull(j) && notnull(j.name) ? j.name : ''
    }),
    z &&
      q.find('.box-tab .tab').each(function (F) {
        $(this).on(pointerEventType.down, E)
      }),
    this
  )
}
function checkIfPopupOpen() {
  notnull(boxPopup) && boxPopup.isOpen() && boxPopup.close(true)
}
function boxInfoCustom() {
  var h = boxInfo['$popup'].find('#pop-tuto .slideshow')
  return (
    (h['$box'] = h.find('.img-row')),
    (h['$btL'] = h.find('.bt').first()),
    (h['$btR'] = h.find('.bt').last()),
    (h['$nav'] = h.find('.pt-box')),
    (h.init = function () {
      for (
        var k,
          m = this,
          p = 0,
          q = 0,
          v = 0,
          w = 0,
          x = this.find('.bloc').length,
          y = 100 / x,
          z = 0,
          A = 0;
        A < x;
        A++
      ) {
        m['$nav'].append('<div class="pt"></div>')
      }
      this.addListener = function () {
        document.body.addEventListener(pointerEventType.up, m.onRelease)
        document.body.addEventListener(pointerEventType.leave, m.onRelease)
        document.body.addEventListener(pointerEventType.move, m.onMove)
      }
      this.removeListener = function () {
        document.body.removeEventListener(pointerEventType.up, m.onRelease)
        document.body.removeEventListener(pointerEventType.leave, m.onRelease)
        document.body.removeEventListener(pointerEventType.move, m.onMove)
      }
      this.onPress = function (B) {
        B = 'targetTouches' in B ? B.targetTouches[0] : B
        p = B.pageX
        m['$box'].removeClass('slide')
        k = boxInfo['$popup'].find('.slideshow')[0].clientWidth
        m.removeListener()
        m.addListener()
      }
      this.onMove = function (B) {
        z = (B * document.body.clientWidth) / k
        q = (z / x) * 0.6
        m['$box'].css({ transform: 'translate(' + (w + q) + '%,0)' })
        B = (100 * (-1 * Math.round(p - B.pageX))) / document.body.clientWidth
        ;(z = (B * document.body.clientWidth) / k),
          (q = (z / x) * 0.6),
          m['$box'].css({ transform: 'translate(' + (w + q) + '%,0)' })
      }
      this.onRelease = function () {
        m.removeListener()
        z < -15
          ? v != x - 1
            ? m.slide('left')
            : m.slide()
          : 15 < z && 0 !== v
          ? m.slide('right')
          : m.slide()
        z = q = p = 0
      }
      this.slide = function (B) {
        m.removeListener()
        m['$box'].addClass('slide')
        'left' === B ? v++ : 'right' === B && v--
        w = -v * y
        m['$box'].css({ transform: 'translate(' + String(w) + '%,0)' })
        m.lightup()
      }
      this.clickLeft = function (B) {
        0 !== v && m.slide('right')
      }
      this.clickRight = function (B) {
        v != x - 1 && m.slide('left')
      }
      this.lightup = function () {
        m['$nav'].find('.pt').removeClass('active')
        m['$nav'].find('.pt').eq(v).addClass('active')
        m['$btL'].removeClass('disable')
        m['$btR'].removeClass('disable')
        0 === v && m['$btL'].addClass('disable')
        v == x - 1 && m['$btR'].addClass('disable')
      }
      this.desactive = function () {
        0 < v && ((p = q = v = w = z = 0), m.slide())
        m['$box'][0].removeEventListener(pointerEventType.down, m.onPress)
        m['$btL'][0].removeEventListener(pointerEventType.down, m.clickLeft)
        m['$btR'][0].removeEventListener(pointerEventType.down, m.clickRight)
        m.removeListener()
      }
      this.active = function () {
        m['$box'][0].addEventListener(pointerEventType.down, m.onPress)
        m['$btL'][0].addEventListener(pointerEventType.down, m.clickLeft)
        m['$btR'][0].addEventListener(pointerEventType.down, m.clickRight)
        m.lightup()
      }
    }),
    h.init(),
    h
  )
}
function initPopup() {
  ;(boxInfo = new Popup('.box-popup#pop-info'))['$slide'] = boxInfoCustom()
  boxParam = new Popup('.box-popup#pop-param')
  $('#pop-language .box-lang .bt').on(pointerEventType.down, function (h) {
    h.preventDefault()
    preventAction(function () {
      clickBtLang(h)
    })
  })
  $('#pop-follow .bt.color-facebook').on(pointerEventType.down, function (h) {
    h.preventDefault()
    redirectTo('facebook')
  })
  $('#pop-follow .bt.color-twitter').on(pointerEventType.down, function (h) {
    h.preventDefault()
    redirectTo('twitter')
  })
  $('#pop-follow .bt.color-instagram').on(pointerEventType.down, function (h) {
    h.preventDefault()
    redirectTo('instagram')
  })
  $('#pop-follow .bt.color-youtube').on(pointerEventType.down, function (h) {
    h.preventDefault()
    redirectTo('youtube')
  })
  $('#pop-follow .bt.color-tumblr').on(pointerEventType.down, function (h) {
    h.preventDefault()
    redirectTo('tumblr')
  })
  $('#pop-follow #img-shop').on(pointerEventType.down, function (h) {
    h.preventDefault()
    redirectTo('shop-all')
  })
  $('#pop-credit #bt-feedback').on(pointerEventType.down, function (h) {
    h.preventDefault()
    preventAction(sendFeedback)
  })
  $('#pop-credit #bt-rating').on(pointerEventType.down, function (h) {
    h.preventDefault()
    var i = isIOS || isOSX ? build.storeRateURL : build.storeURL
    preventAction(function () {
      openURL(i)
    })
  })
  $('#pop-credit #bt-faq').on(pointerEventType.down, function (h) {
    h.preventDefault()
    redirectTo('faq')
  })
  $('#pop-credit #bt-privacy').on(pointerEventType.down, function (h) {
    h.preventDefault()
    showPP()
  })
}
function showPP(g) {}
function hidePP() {}
function refusePP() {}
function acceptPP(g) {}
function dialogGetApp(g, h) {
  notnull(g) && g.preventDefault()
  appBrowserDemo
    ? popupGetApp(h)
    : appBrowser
    ? popupGetAppBrowser(h)
    : boxDialog.open(
        "To access this feature you have to download the Incredibox app. Let's go? &#128273;",
        '&#128274; Locked',
        [STR('bt.sure'), STR('bt.later')],
        [],
        true
      )
}
function popupGetApp(g) {
  var i = isIOS
      ? "<div class='bt-store' id='bt-getapp'><div class='bck appstore'></div></div>"
      : "<div class='bt with-icn' id='bt-getapp'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-download'></use></svg><div class='txt'>Get app</div></div><div class='hitzone'></div></div>",
    j = isIOS ? 'appstore' : 'store'
  i = isAndroid
    ? "<div class='bt-store' id='bt-getapp'><div class='bck playstore'></div></div>"
    : i
  j = isAndroid ? 'playstore' : j
  boxPopup.open({
    name: 'get-full-app',
    icntype: true === g ? 'action-back' : 'action',
    class: 'big column',
    content:
      "\n\t\t\t<div class='left'>\n               <div class='img-box'></div>\n            </div>\n            <div class='right'>\n               <div class='title'>" +
      STR('txt.lockedContent') +
      "</div>\n               <div class='text'>\n               \t" +
      STR('txt.wantAllFeature') +
      ' ' +
      STR('txt.easyDownload') +
      '<br><br>\n               \t' +
      STR('txt.catchyFeatures').replace('%{emoji}', '&#129321') +
      '\n               </div>\n               ' +
      i +
      '\n            </div>',
    onBoxOpenEnd: function () {
      true === g
        ? boxPopup['$icon'].on(pointerEventType.down, popupRecok)
        : boxPopup['$icon'].on(pointerEventType.down, boxPopup.close)
      boxPopup['$popup']
        .find('.img-box')
        .css({ 'background-image': 'url(./img/demo-mockup.jpg)' })
        .addClass('fade')
      boxPopup['$popup']
        .find('#bt-getapp')
        .on(pointerEventType.down, function (k) {
          k.preventDefault()
          redirectTo(j)
        })
    },
    onBoxCloseStart: function () {
      boxPopup['$icon'].off()
      boxPopup['$popup'].find('#bt-getapp').off()
    },
  })
}
function popupGetAppBrowser(g) {
  var j = true === g ? 'action-back' : 'action',
    k = 'App exclusivity',
    l =
      'This feature is only available in the Incredibox App.<br>Choose your store below and access the full experience!',
    m = 'More info',
    p =
      null != getParameterByName('lang') && 'en' != getParameterByName('lang')
        ? getParameterByName('lang') + '/'
        : '',
    q = domainOnline + p + 'app'
  isIframe &&
    null != window.top.i18n &&
    ((k = window.top.i18n.app_exclusivity),
    (l =
      window.top.i18n.feature_only_inapp +
      '<br>' +
      window.top.i18n.access_full_xp),
    (m = window.top.i18n.bt_more_info))
  boxPopup.open({
    name: 'get-full-app-browser',
    icntype: j,
    content:
      "\n\t\t\t<div class='title'>" +
      k +
      " &#128521;</div>\n\t\t\t<div class='text'>" +
      l +
      '</div>\n\t\t\t<div class=\'box-bt-store\'>\n\t\t\t\t<a href="https://apps.apple.com/app/incredibox/id1093131935" target="_blank" class="bt-store"><div class="bck appstore"></div></a>\n\t\t\t\t<a href="https://play.google.com/store/apps/details?id=com.sofarsogood.incredibox" target="_blank" class="bt-store"><div class="bck playstore"></div></a>\n\t\t\t\t<a href="https://www.amazon.fr/So-Far-Good-Incredibox/dp/B07BKZCDHT/" target="_blank" class="bt-store"><div class="bck amazonstore"></div></a>\n\t\t\t\t<a href="https://store.steampowered.com/app/1545450/Incredibox/" target="_blank" class="bt-store"><div class="bck steam"></div></a>\n\t\t\t\t<a href="https://apps.apple.com/app/id1437906083" target="_blank" class="bt-store"><div class="bck macappstore"></div></a>\n\t\t\t\t<a href="https://www.microsoft.com/fr-fr/p/incredibox/9pdjpp8scs9k?rtc=1&activetab=pivot:overviewtab" target="_blank" class="bt-store"><div class="bck windowsstore"></div></a>\n\t\t\t\t<a href="https://www.incredibox.com/schools" target="_blank" class="bt-store"><div class="bck schools"></div></a>\n\t\t\t</div>\n\t\t\t<div class="bt bt-light with-icn"><div class="bck"><div class="icn"><svg class="icn-svg"><use xlink:href="#ic-navr"></use></svg></div><div class="txt">' +
      m +
      '</div></div><div class="hitzone"></div></div>',
    onBoxOpenEnd: function () {
      true === g
        ? boxPopup['$icon'].on(pointerEventType.down, popupMixSaved)
        : boxPopup['$icon'].on(pointerEventType.down, boxPopup.close)
      boxPopup['$popup']
        .find('.bt-store')
        .on(pointerEventType.down, function (r) {
          r.preventDefault()
          openURL(q, '_self')
        })
    },
    onBoxCloseStart: function () {
      boxPopup['$icon'].off()
      boxPopup['$popup'].find('.bt-store').off()
    },
  })
}
function popupGeneralError(g) {
  var j =
      translateObj && translateObj.trad
        ? STR('pop.generalErrorText')
        : 'Sorry, the app encountered a technical problem.',
    k = translateObj && translateObj.trad ? STR(h.ORfRK) : 'Ok',
    l = g && g.error ? '<br>[ error: ' + g.error + ' ]' : '',
    m = g && g.action ? g.action : '',
    g = g && g.txt ? g.txt + l : j + l
  'kill' == m
    ? boxDialog.open(g, '&#128533;', [], [], true, true)
    : 'reload' == m
    ? boxDialog.open(g, '&#128533;', ['Reload'], [reloadPage], true)
    : boxDialog.open(g, '&#128533;', [k], [], true)
}
function popupStillHere() {
  null != boxDialog &&
    'dialogStillHere' != boxDialog['$div'].attr('data-name') &&
    boxDialog.open(
      STR('pop.stillHere'),
      '&#128564;',
      [STR('bt.sure')],
      [clickPopupStillHere],
      true,
      false,
      'dialogStillHere'
    )
}
function popupInfo() {
  deleteFocus()
  boxInfo.open({
    static: true,
    bckclose: true,
    name: 'popup-info',
    class: 'big',
    onBoxOpenEnd: function () {
      boxInfo['$slide'].active()
      createFocus('pop-tuto')
    },
    onBoxCloseStart: function () {
      deleteFocus()
      focusHistory = []
    },
    onBoxCloseEnd: function () {
      boxInfo['$slide'].desactive()
    },
    onCloseComplete: function () {
      createFocus(pageApp ? 'home' : 'index-select')
    },
  })
}
function popupParam() {
  deleteFocus()
  boxParam.open({
    static: true,
    bckclose: true,
    name: 'popup-param',
    class: 'big',
    onBoxOpenEnd: function () {
      createFocus('pop-language')
    },
    onBoxCloseStart: function () {
      deleteFocus()
      focusHistory = []
    },
    onCloseComplete: function () {
      createFocus(pageApp ? 'home' : 'index-select')
    },
  })
}
function popupSwitch() {
  deleteFocus()
  boxSwitch.open({
    static: true,
    bckclose: true,
    name: 'popup-switch',
    onBoxOpenEnd: function () {
      createFocus('popup-switch')
    },
    onBoxCloseStart: function () {
      deleteFocus()
      focusHistory = []
    },
    onCloseComplete: function () {
      createFocus('home')
    },
  })
}
function popupDrag() {
  var h = STR(modeRecord ? 'pop.dragDropText' : 'txt.tuto1')
  boxPopup.open({
    name: 'drag-and-drop',
    class: 'mini',
    bodyclose: true,
    content:
      "<div class='title'>" +
      STR('pop.dragDropTitle') +
      "</div><div class='text'>" +
      h +
      '</div>',
    onBoxOpenStart: function () {
      boxPopup['$popup']
        .find('.pop')
        .append(
          "<div id='pointe-box' class='bottom'><div id='pointe'></div></div>"
        )
    },
    onBoxCloseEnd: function () {
      boxPopup['$popup'].find('#pointe-box').remove()
      modeRecord || storage.setItem('popupDragViewed', 'viewed')
    },
  })
}
function popupShort() {
  boxPopup.open({
    name: 'too-short',
    icntype: 'info',
    class: 'mini',
    bodyclose: true,
    content:
      "\n\t\t\t<div class='title'>" +
      STR('pop.toShortTitle') +
      "</div>\n\t\t\t<div class='text'>" +
      STR('pop.toShortText').split('%{minimum_time}').join(app.recmintime) +
      '</div>',
  })
}
function popupBonusPlaying() {
  boxPopup.open({
    name: 'bonus-playing',
    icntype: 'info',
    class: 'mini',
    bodyclose: true,
    content:
      "\n\t\t\t<div class='title'>" +
      STR('pop.bonusPlayingTitle') +
      "</div>\n\t\t\t<div class='text'>" +
      STR('pop.bonusPlayingText') +
      '</div>',
  })
}
function popupFindPreviousBonus() {
  boxPopup.open({
    name: 'find-previous-bonus',
    icntype: 'info',
    class: 'mini',
    bodyclose: true,
    content:
      "\n\t\t\t<div class='title'>" +
      STR('pop.bonusFindPreviousTitle') +
      "</div>\n\t\t\t<div class='text'>" +
      STR('pop.bonusFindPreviousText') +
      '</div>',
  })
}
function popupBonusUnlocked(g) {
  var i
  ;((!modeReplay && !modeRandom) || g) &&
    ((i = 'v' + appVersion + '-popup-bonus-unlock'),
    isnull(storage.getItem(i)) || g) &&
    boxPopup.open({
      name: 'bonus-unlocked',
      class: 'mini',
      bodyclose: true,
      content:
        "\n\t\t\t\t\t<div class='title'>" +
        STR('pop.bonusUnlockTitle') +
        "</div>\n\t\t\t\t\t<div class='text'>" +
        STR('pop.bonusUnlockText') +
        '</div>\n\t\t\t\t',
      onBoxOpenStart: function () {
        boxPopup['$popup']
          .find('.pop')
          .append(
            "<div id='pointe-box' class='top'><div id='pointe'></div></div>"
          )
        calcPointePosX(1)
      },
      onBoxCloseEnd: function () {
        storage.setItem(i, 'ok')
        boxPopup['$popup'].find('#pointe-box').remove()
      },
    })
}
function popupBonusFindNext(g) {
  var h
  ;((!modeReplay && !modeRandom) || g) &&
    ((h = 'v' + appVersion + '-popup-bonus-next'),
    isnull(storage.getItem(h)) || g) &&
    (isToolbarOpen && closeTool(),
    boxPopup.open({
      name: 'find-next-bonus',
      class: 'mini',
      bodyclose: true,
      content:
        "\n\t\t\t\t\t<div class='title'>" +
        STR('pop.bonusFindNextTitle') +
        "</div>\n\t\t\t\t\t<div class='text'>" +
        STR('pop.bonusFindNextText') +
        '</div>\n\t\t\t\t',
      onBoxOpenStart: function () {
        boxPopup['$popup']
          .find('.pop')
          .append("<div id='pointe-box'><div id='pointe'></div></div>")
      },
      onBoxCloseEnd: function () {
        storage.setItem(h, 'ok')
        boxPopup['$popup'].find('#pointe-box').remove()
      },
    }))
}
function calcPointePosX(g) {
  var i = document.querySelector('#pop-popup .pop').getBoundingClientRect(),
    g = document.querySelector('#bt-bonus-' + g).getBoundingClientRect(),
    g = g.left - i.left + g.width / 2
  g = (g = g < 30 ? 30 : g) > i.width - 30 ? i.width - 30 : g
  document.getElementById('pointe').style.left = g + 'px'
}
function popupRecok() {
  checkTimeRecok = getTime()
  deleteFocus()
  var h =
    "\n\t\t<div class='bt bt-haut retry'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-reset'></use></svg></div><div class='txt'>" +
    STR('bt.retry') +
    "</div><div class='hitzone'></div></div>\n\t\t<div class='bt bt-haut replay'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-eye'></use></svg></div><div class='txt'>" +
    STR('bt.replay') +
    "</div><div class='hitzone'></div></div>\n\t\t<div class='bt bt-haut save'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-edit'></use></svg></div><div class='txt'>" +
    STR('bt.save') +
    "</div><div class='hitzone'></div></div>"
  appBrowserDemo &&
    (h =
      "\n\t\t\t<div class='bt bt-haut replay'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-eye'></use></svg></div><div class='txt'>" +
      STR('bt.replay') +
      "</div><div class='hitzone'></div></div>\n\t\t\t<div class='bt bt-haut share'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-share'></use></svg></div><div class='txt'>" +
      STR('bt.share') +
      "</div><div class='hitzone'></div></div>\n\t\t\t<div class='bt bt-haut download'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-download'></use></svg></div><div class='txt'>Get MP3</div><div class='hitzone'></div></div>")
  boxPopup.open({
    name: 'record-complete',
    icntype: 'action',
    content:
      "\n\t\t\t<div class='title'>" +
      STR('pop.recOkTitle') +
      "</div>\n\t\t\t<div class='content'>\n\t\t\t\t<div class='box-bt-haut'>\n\t\t\t\t\t" +
      h +
      '\n\t\t\t\t</div>\t\n\t\t\t</div>',
    onBoxOpenEnd: function () {
      boxPopup['$icon'].on(pointerEventType.down, boxPopup.close)
      boxPopup['$popup']
        .find('.bt.replay')
        .on(pointerEventType.down, function (i) {
          i.preventDefault()
          preventAction(clickReplayMix)
        })
      appBrowserDemo
        ? (boxPopup['$popup']
            .find('.bt.share')
            .on(pointerEventType.down, function (i) {
              i.preventDefault()
              preventAction(function () {
                popupGetApp(true)
              })
            }),
          boxPopup['$popup']
            .find('.bt.download')
            .on(pointerEventType.down, function (i) {
              i.preventDefault()
              preventAction(function () {
                popupGetApp(true)
              })
            }))
        : (boxPopup['$popup']
            .find('.bt.retry')
            .on(pointerEventType.down, function (i) {
              i.preventDefault()
              preventAction(clickRetryMix)
            }),
          boxPopup['$popup']
            .find('.bt.save')
            .on(pointerEventType.down, function (i) {
              i.preventDefault()
              preventAction(clickSaveMix)
            }))
      createFocus('popup-record-complete')
      unlock()
    },
    onBoxCloseStart: function () {
      deleteFocus()
      boxPopup['$icon'].off()
      boxPopup['$popup'].find('.bt').off()
    },
    onBoxCloseEnd: function () {
      boxPopup['$icon'].off(), boxPopup['$popup'].find('.bt').off()
    },
    onCloseComplete: function () {
      removeInFocusHistory('popup-record-complete')
      modeReplay || createFocus('toolbar')
    },
  })
}
var checkTimeRecok = 0
function canIclickRecok() {
  return 600 < getTime() - checkTimeRecok
}
function clickRetryMix() {
  canIclickRecok() &&
    (boxPopup.close(),
    callAd('next', 'retry-mix', function () {
      TweenMax.delayedCall(0.2, startRecordMode)
    }))
}
function clickReplayMix() {
  canIclickRecok() &&
    (boxPopup.close(),
    prepareReplayMode(),
    startReplayMode(),
    saveGA('mix', 'replay'))
}
function clickSaveMix() {
  popupForm()
}
function popupForm() {
  boxPopup.open({
    name: 'save-form',
    icntype: 'action-back',
    content: function () {
      var h =
        "\n\t\t\t<div class='title'>" +
        STR('pop.formTitle') +
        "</div>\n\t\t\t<div class='content'>\n\t\t\t\t<form action='javascript:validFormMix()' method='post' target='_self' autocomplete='off'>\n\t\t\t\t\t<div class='formzone'>\n\t\t\t\t\t\t<div class='formline ic-name'><div class='icn-box'><svg class='icn-svg'><use xlink:href='#ic-user-mini'></use></svg></div><input type='text' id='input-name' placeholder='" +
        STR('txt.inputName') +
        "' value='" +
        user.djname +
        "' maxlength='26' autocorrect='off' spellcheck='false'/></div>\n\t\t\t\t\t\t<div class='formline ic-title'><div class='icn-box'><svg class='icn-svg'><use xlink:href='#ic-note-mini'></use></svg></div><input type='text' id='input-title' placeholder='" +
        STR('txt.inputTitle') +
        "' value='' maxlength='26' autocorrect='off' spellcheck='false'/></div>\n\t\t\t\t\t\t<div class='formline ic-dedi'><div class='icn-box'><svg class='icn-svg'><use xlink:href='#ic-like-mini'></use></svg></div><input type='text' id='input-dedi' placeholder='" +
        STR('txt.dedicatedTo').split('%{name}').join('...') +
        "' value='' maxlength='26' autocorrect='off' spellcheck='false'/></div>"
      return (
        appBrowser ||
          (h +=
            "<div class='formline ic-private'>\n\t\t\t\t\t\t\t<div class='icn-box'><svg class='icn-svg'><use xlink:href='#ic-view-mini'></use></svg></div>\n\t\t\t\t\t\t\t<div class='bt-onofftext active'>\n\t\t\t\t\t\t\t\t<div class='slider'></div>\n\t\t\t\t\t\t\t\t<div class='txtbox'>\n\t\t\t\t\t\t\t\t\t<div class='label'>" +
            STR('bt.private') +
            "</div>\n\t\t\t\t\t\t\t\t\t<div class='label'>" +
            STR('bt.public') +
            '</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>'),
        (h +=
          "</div>\n\t\t\t\t\t<div class='btzone'>\n\t\t\t\t\t\t<div class='bt bt-round bt-big valid'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-check'></use></svg></div><div class='hitzone'></div></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<input type='submit' style='visibility:hidden;position:absolute'/><div class='clear'></div>\n\t\t\t\t</form>\n\t\t\t</div>"),
        appBrowser &&
          !appBrowser &&
          (h +=
            "<div style='margin-top: 25px; color:#777; font-size:14px; line-height:20px;'>" +
            STR('pop.dontUseName') +
            ' &#128521;</div>'),
        h
      )
    },
    onBoxOpenEnd: function () {
      var h, i
      createFocus('popup-save-form')
      boxPopup['$icon'].on(pointerEventType.down, popupRecok)
      boxPopup['$popup']
        .find('.bt.valid')
        .on(pointerEventType.down, function (j) {
          j.preventDefault()
          preventAction(clickBtValidFormMix)
        })
      window.cordova &&
        !isIOSMac &&
        (boxPopup['$popup']
          .find('.formline:not(.ic-private)')
          .on(pointerEventType.down, function (j) {
            boxPopup['$popup'].find('.formline').off(pointerEventType.down)
            Spinner.add($(this).find('.icn-box'))
          }),
        boxPopup['$popup'].find('.formline input').on('focus', function () {
          boxPopup['$popup'].find('.formline input').off('focus')
          Spinner.reset()
        }))
      appBrowser ||
        isSafeMode() ||
        ((h = boxPopup['$popup'].find('.formline.ic-private .bt-onofftext')),
        (i = boxPopup['$popup'].find('.formline.ic-private svg use')),
        h.on(pointerEventType.down, function (j) {
          j.preventDefault()
          h.hasClass('active')
            ? (h.removeClass('active'), i.attr('xlink:href', '#ic-lock-mini'))
            : (h.addClass('active'), i.attr('xlink:href', '#ic-view-mini'))
        }))
    },
    onBoxCloseStart: function () {
      removeInFocusHistory('popup-save-form')
      deleteFocus()
      boxPopup['$icon'].off()
      boxPopup['$popup'].find('.bt').off()
      boxPopup['$popup'].find('.bt-onofftext').off()
      boxPopup['$popup'].find('.formline').off()
      boxPopup['$popup'].find('.formline input').off()
      boxPopup['$popup'].find('input').off()
      window.cordova && blurAll()
    },
  })
}
var androidKB,
  translateObj,
  defaultLanguage,
  currentLanguage,
  formProcessing = false
function clickBtValidFormMix() {
  validFormMix()
}
function validFormMix() {
  var h, j, k, m, q, v, w, x, y, z, A
  function B() {
    TweenMax.delayedCall(1, function () {
      Spinner.reset()
      popupMixSaved()
    })
  }
  boxPopup['$popup'].find('.formzone .formline input').hasClass('focused') ||
    formProcessing ||
    ((formProcessing = true),
    lock(),
    (h =
      appBrowser ||
      isSafeMode() ||
      !boxPopup['$popup'].find('.formzone .bt-onofftext').hasClass('active')),
    (j = boxPopup['$popup'].find('.formzone #input-name')),
    (k = boxPopup['$popup'].find('.formzone #input-title')),
    (m = boxPopup['$popup'].find('.formzone #input-dedi')),
    (q = j.val().substr(0, 26)),
    (v = k.val().substr(0, 26)),
    (w = m.val().substr(0, 26)),
    (q = cleanInputText(q)),
    (v = cleanInputText(v)),
    (w = cleanInputText(w)),
    (z = regexList.classic),
    (x = q.replace(/ /g, '')),
    (y = v.replace(/ /g, '')),
    (A = w.replace(/ /g, '')),
    z.test(x)
      ? invalidField(j)
      : z.test(y)
      ? invalidField(k)
      : z.test(A)
      ? invalidField(m)
      : '' === x
      ? invalidField(j)
      : '' === y
      ? invalidField(k)
      : (deleteFocus(),
        boxPopup['$popup'].find('.formzone input').blur(),
        (z = {
          mymix: true,
          online: false,
          name: ucwords(q),
          title: ucwords(v),
          dedi: ucwords(w),
          app: app.version,
          datedb: getDateNow(),
          link: getUniqLink(),
          private: h ? 1 : 0,
          nbview: 0,
          nblike: 0,
          xml: trim(recordMix.getXML()),
        }),
        (A = boxPopup['$popup'].find('.bt.valid')),
        Spinner.add(A),
        recordMix.setData(z),
        localMixObject.saveMix(z),
        (mixToShare = z),
        setUserInfo({ djname: ucwords(q) }),
        delete XHRmemotime.mymix,
        hasNetwork
          ? (callAd('next', 'save-mix'),
            appBrowser
              ? saveMixDB(z, B, function () {
                  boxDialog.open(
                    STR('pop.noCoServerText'),
                    STR('pop.noCoServerTitle'),
                    [STR('bt.ok')]
                  )
                  Spinner.reset()
                  formProcessing = false
                  unlock()
                })
              : saveMixDB(z, B))
          : appBrowser
          ? (Spinner.reset(),
            (formProcessing = false),
            unlock(),
            boxDialog.open(
              STR('pop.noNetworkText'),
              STR('pop.noNetworkTitle'),
              [STR('bt.ok')],
              []
            ))
          : B()))
}
function invalidField(g) {
  g.addClass('invalid').one(animationEnd, function (h) {
    $(h.target).removeClass('invalid')
  })
  formProcessing = false
  unlock()
}
function VKBopen(g) {
  window.cordova &&
    isAndroid &&
    boxPopup.isOpen() &&
    'save-form' == boxPopup['$popup'].attr('data-name') &&
    ((g = g.keyboardHeight || 0.7 * document.body.clientHeight),
    (androidKB = new FocusKeyboardAndroid()).init(g))
}
function VKBclose() {
  window.cordova &&
    isAndroid &&
    boxPopup.isOpen() &&
    'save-form' == boxPopup['$popup'].attr('data-name') &&
    androidKB &&
    (androidKB.kill(), (androidKB = null))
}
function FocusKeyboardAndroid() {
  var g, h, j
  function k(m) {
    l(m.target)
  }
  function l(m) {
    var m = m.getBoundingClientRect(),
      p = m.top,
      m = m.height,
      p = Math.round(h - (p + m / 2))
    TweenMax.to(boxPopup['$popup'], 0.3, {
      scrollTo: { y: '-=' + p },
      ease: Quad.easeInOut,
      overwrite: true,
    })
  }
  this.init = function (m) {
    g = m
    h = (document.body.clientHeight - g) / 2
    ;(j = document.querySelectorAll(
      '#pop-popup[data-name=save-form] input[type=text]'
    )).forEach(function (p) {
      p.addEventListener('focus', k)
      document.activeElement == p && l(p)
    })
    boxPopup['$popup'].addClass('VKBopen')
    boxPopup['$popup'].find('.bac').css({ height: 'calc(100% + ' + g + 'px)' })
    window.cordova
  }
  this.kill = function () {
    j.forEach(function (m) {
      m.removeEventListener('focus', k)
    })
    TweenMax.to(boxPopup['$popup'], 0, {
      scrollTo: { y: 0 },
      overwrite: true,
    })
    boxPopup['$popup'].removeClass('VKBopen')
    boxPopup['$popup'].find('.bac').css({ height: '100%' })
    window.cordova
  }
}
function blurAll() {
  notnull(document.activeElement) && document.activeElement.blur()
}
function listenFocus() {
  var g = false
  isIOS &&
    (document.addEventListener('focusin', function () {
      g = true
    }),
    document.addEventListener('focusout', function () {
      g = false
      setTimeout(function () {
        g || window.scrollTo(0, 0)
      }, 250)
    }))
}
function popupConvertMix() {
  var h = 'action',
    i = appBrowserSchool && miniPlayer ? mixToWatch : mixToShare
  $mixlist.hasClass('show') || appBrowserSchool || (h = 'action-back')
  boxPopup.open({
    name: 'convert-mix',
    icntype: h,
    content:
      "\n\t\t\t<div class='title'>" +
      STR('pop.convertMixTitle') +
      "</div>\n\t\t\t<div class='text'>" +
      STR('pop.convertMixText') +
      "</div>\n\t\t\t<div class='content'>\n\t\t\t\t<div id='convert-loader-box' class='progress-box'><div class='progress-bar'></div></div>\n\t\t\t\t<a class='bt with-icn color download' id='bt-save-file'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-download'></use></svg><div class='txt'>" +
      STR('bt.saveFile') +
      "</div></div><div class='hitzone'></div></a>\n\t\t\t\t<div class='spinner-box spin'><svg class='icn-svg col-version'><use xlink:href='#ic-loader'></use></svg></div>\n\t\t\t</div>",
    onBoxOpenEnd: function () {
      createFocus('popup-convert-mix')
      boxPopup['$icon'].on(pointerEventType.down, function () {
        'action' == h ? boxPopup.close() : popupMixSaved()
      })
      notnull(i) && converterCanRun()
        ? startConvert(i, boxPopup['$popup'])
        : popupGeneralError({ error: 'converter mix' })
    },
    onBoxCloseStart: function () {
      removeInFocusHistory('popup-convert-mix')
      removeInFocusHistory('popup-convert-mix-ready')
      createFocus('playlist-line-open')
      boxPopup['$icon'].off()
      stopConvert()
    },
  })
}
function popupMixSaved() {
  formProcessing = false
  boxPopup.open({
    name: 'mix-saved',
    icntype: 'action',
    content: function () {
      var h = appBrowser
          ? STR('pop.shareMixSaved')
          : STR('pop.shareMixSavedPlaylist') +
            '<br>' +
            STR('pop.shareShareTop50'),
        h = 1 == mixToShare.private ? h.split('<br>')[0] : h,
        i = ''
      return (
        appBrowserSchool ||
          (i =
            (i +=
              "<div class='bt bt-haut link'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-link'></use></svg></div><div class='txt'>" +
              STR('bt.link') +
              "</div><div class='hitzone'></div></div>") +
            ("<div class='bt bt-haut share color-blue'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-share'></use></svg></div><div class='txt'>" +
              STR('bt.share') +
              "</div><div class='hitzone'></div></div>")),
        converterCanRun() &&
          (i +=
            "<div class='bt bt-haut download hoverLocked'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-download'></use></svg></div><div class='txt'>" +
            STR('bt.exportFile') +
            "</div><div class='ic-locked'><svg class='icn-svg'><use xlink:href='#ic-lock'></use></svg></div><div class='hitzone'></div></div>"),
        (i +=
          "<div class='bt bt-haut mixlist color hoverLocked'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-mixlist'></use></svg></div><div class='txt'>" +
          STR('bt.myMix') +
          "</div><div class='ic-locked'><svg class='icn-svg'><use xlink:href='#ic-lock'></use></svg></div><div class='hitzone'></div></div>"),
        "\n\t\t\t\t<div class='title'>" +
          STR('pop.shareTitle') +
          "</div>\n\t\t\t\t<div class='text'>" +
          h +
          "</div>\n\t\t\t\t<div class='content'>\n\t\t\t\t\t<div class='box-bt-haut'>" +
          i +
          '</div>\n\t\t\t\t</div>'
      )
    },
    onBoxOpenEnd: function () {
      createFocus('popup-mix-saved')
      boxPopup['$icon'].on(pointerEventType.down, boxPopup.close)
      boxPopup['$popup'].find('.bt.link').length &&
        boxPopup['$popup']
          .find('.bt.link')
          .on(pointerEventType.down, function (i) {
            var j = $(this)
            preventAction(function () {
              clickBtCopyLink(j)
            })
          })
      boxPopup['$popup'].find('.bt.mixlist').length &&
        (appBrowser && !appBrowserSchool
          ? boxPopup['$popup']
              .find('.bt.mixlist')
              .on(pointerEventType.down, function (i) {
                dialogGetApp(i, true)
              })
          : appBrowser && appBrowserSchool
          ? boxPopup['$popup']
              .find('.bt.mixlist')
              .on(pointerEventType.down, function (i) {
                callParentWindow('clickBtMixlist')
              })
          : boxPopup['$popup']
              .find('.bt.mixlist')
              .on(pointerEventType.down, function (i) {
                preventAction(clickBtGoToMixlist)
              }))
      boxPopup['$popup'].find('.bt.download').length &&
        (appBrowser && !appBrowserSchool
          ? boxPopup['$popup']
              .find('.bt.download')
              .on(pointerEventType.down, function (i) {
                dialogGetApp(i, true)
              })
          : appBrowser && appBrowserSchool
          ? boxPopup['$popup']
              .find('.bt.download')
              .on(pointerEventType.down, function () {
                callParentWindow('exportMP3')
              })
          : boxPopup['$popup']
              .find('.bt.download')
              .on(pointerEventType.down, function () {
                preventAction(popupConvertMix)
              }))
      boxPopup['$popup']
        .find('.bt.share')
        .on(pointerEventType.down, function (i) {
          var k = $(this)
          preventAction(function () {
            clickBtShareGlobal(k)
          })
        })
      unlock()
    },
    onBoxCloseStart: function () {
      deleteFocus()
      boxPopup['$icon'].off()
      boxPopup['$popup'].find('.bt').off()
    },
    onCloseComplete: function () {
      onGame && createFocus('toolbar')
      mixToShare = {}
    },
  })
}
function popupGlobalShare() {
  var h = $mixlist.isOpen() ? 'action' : 'action-back'
  boxPopup.open({
    name: 'global-share',
    icntype: h,
    class: miniPlayer ? 'mini' : '',
    content:
      "\n\t\t\t<div class='title'>" +
      STR('bt.share') +
      "</div>\n\t\t\t<div class='content'>\n\t\t\t\t<div class='box-bt-haut'>\n\t\t\t\t\t<div class='bt bt-haut mail'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-mail'></use></svg></div><div class='txt'>Mail</div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-haut color-facebook'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-facebook'></use></svg></div><div class='txt'>Facebook</div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-haut color-twitter color'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-twitter'></use></svg></div><div class='txt'>Twitter</div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-haut link color'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-link'></use></svg></div><div class='txt'>" +
      STR('bt.link') +
      "</div><div class='hitzone'></div></div>\n\t\t\t\t</div>\n\t\t\t</div>",
    onBoxOpenEnd: function () {
      createFocus('popup-global-share')
      boxPopup['$popup']
        .find('.bt.mail')
        .on(pointerEventType.down, function (i) {
          i.preventDefault()
          preventAction(function () {
            shareMix('mail')
          })
        })
      boxPopup['$popup']
        .find('.bt.color-facebook')
        .on(pointerEventType.down, function (i) {
          i.preventDefault()
          preventAction(function () {
            shareMix('facebook')
          })
        })
      boxPopup['$popup']
        .find('.bt.color-twitter')
        .on(pointerEventType.down, function (i) {
          i.preventDefault()
          preventAction(function () {
            shareMix('twitter')
          })
        })
      boxPopup['$popup']
        .find('.bt.link')
        .on(pointerEventType.down, function (i) {
          i.preventDefault()
          preventAction(function () {
            shareMix('clipboard')
          })
        })
      'action' == h
        ? boxPopup['$icon'].on(pointerEventType.down, boxPopup.close)
        : boxPopup['$icon'].on(pointerEventType.down, popupMixSaved)
      unlock()
    },
    onBoxCloseStart: function () {
      removeInFocusHistory('popup-global-share')
      deleteFocus()
      boxPopup['$icon'].off()
      boxPopup['$popup'].find('.bt').off()
    },
    onBoxCloseEnd: function () {
      createFocusFromHistory()
      Spinner.reset()
    },
  })
}
function popupEmail() {
  boxPopup.open({
    name: 'email-form',
    icntype: 'action-back',
    class: miniPlayer ? 'mini' : '',
    content:
      "\n\t\t\t<div class='title'>" +
      STR('pop.formEmailTitle') +
      '</div>\n\t\t\t<div class=\'content\'>\n\t\t\t\t<form action=\'javascript:clickBtValidFormEmail()\' method=\'post\' target=\'_self\' autocomplete=\'off\'>\n\t\t\t\t\t<div class=\'formzone\'>\n\t\t\t\t \t\t<div class="formline ic-name"><div class="icn-box"><svg class="icn-svg"><use xlink:href="#ic-user-mini"></use></svg></div><input type="text" id="input-name" placeholder="' +
      STR('txt.inputEmailSender') +
      '" value="' +
      (notnull(user.djname) ? user.djname : '') +
      "\" maxlength=\"26\" autocorrect=\"off\" spellcheck=\"false\"/></div>\n\t\t\t\t\t\t<div class='formline ic-email'><div class='icn-box'><svg class='icn-svg'><use xlink:href='#ic-at-mini'></use></svg></div><input type='email' id='input-email' placeholder='" +
      STR('txt.inputEmailRecipient') +
      "' value='' maxlength='254' autocorrect='off' spellcheck='false'/></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class='btzone'>\n\t\t\t\t\t\t<div class='bt bt-round bt-big valid'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-check'></use></svg></div><div class='hitzone'></div></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<input type='submit' style='visibility:hidden;position:absolute'/><div class='clear'></div>\n\t\t\t\t</form>\n\t\t\t</div>",
    onBoxOpenEnd: function () {
      createFocus('popup-email-form')
      boxPopup['$icon'].on(pointerEventType.down, popupGlobalShare)
      boxPopup['$popup']
        .find('.bt.valid')
        .on(pointerEventType.down, function (h) {
          h.preventDefault()
          preventAction(clickBtValidFormEmail)
        })
    },
    onBoxCloseStart: function () {
      removeInFocusHistory('popup-email-form')
      deleteFocus()
      boxPopup['$icon'].off()
      blurAll()
    },
    onBoxCloseEnd: function () {
      formProcessing = false
    },
  })
}
function clickBtValidFormEmail() {
  var h, j, k, m, p, q, v, w, x, y
  boxPopup['$popup'].find('.formzone .formline input').hasClass('focused') ||
    ((h = domainOnline + 'mix/' + mixToShare.link),
    (j = mixToShare.title),
    (k = mixToShare.name),
    formProcessing) ||
    ((formProcessing = true),
    lock(),
    (m = boxPopup['$popup'].find('.formzone #input-name')),
    (p = boxPopup['$popup'].find('.formzone #input-email')),
    (q = m.val().substr(0, 26)),
    (v = p.val().substr(0, 254)),
    (q = cleanInputText(q, m)),
    (v = trim(v)),
    (y = q.split(' ').join('')),
    (w = v.toLowerCase()),
    '' == y || regexList.classic.test(y)
      ? invalidField(m)
      : '' != w && regexList.email.test(w)
      ? (boxPopup['$popup'].find('.formzone input').blur(),
        blurAll(),
        (x = boxPopup['$popup'].find('.bt.valid')),
        Spinner.add(x),
        hasNetwork
          ? (((y = {}).expediteur = q),
            (y.email = v),
            (y.type = 'composition'),
            (y.djName = k),
            (y.title = j),
            (y.link = h),
            (y.src = window.electron
              ? 'electron'
              : window.cordova
              ? 'cordova'
              : 'browser'),
            (y.lang = currentLanguage.split('-')[0]),
            xhr(
              'POST',
              domainOnline + 'ph3/send-mail.php',
              y,
              function (z) {
                'success' == z.state
                  ? (Spinner.reset(),
                    x.addClass('success'),
                    TweenMax.delayedCall(0.6, function () {
                      unlock()
                      popupGlobalShare()
                    }))
                  : (boxDialog.open(
                      STR('pop.shareErrorText'),
                      STR('pop.shareErrorTitle'),
                      [STR('bt.ok')],
                      [
                        function () {
                          Spinner.reset()
                        },
                      ]
                    ),
                    (formProcessing = false),
                    unlock())
              },
              function (z) {
                formProcessing = false
                boxDialog.open(
                  STR('pop.shareErrorText'),
                  STR('pop.shareErrorTitle'),
                  [STR('bt.ok')],
                  [
                    function () {
                      Spinner.reset()
                    },
                  ]
                )
                unlock()
              }
            ))
          : ((formProcessing = false),
            boxDialog.open(
              STR('pop.noNetworkText'),
              STR('pop.noNetworkTitle'),
              [STR('bt.ok')],
              [
                function () {
                  Spinner.reset()
                },
              ]
            ),
            unlock()))
      : invalidField(p))
}
function saveMixDB(g, h, i) {
  var k = i || h,
    i = getAppData()
  i.mix = g
  $.ajax({
    type: 'POST',
    url: domainOnline + 'ph3/save-mix-db.php',
    data: i,
    dataType: 'json',
    crossdomain: true,
    success: function (l) {
      'success' == l.state
        ? ((g.online = true),
          (g.link = l.link),
          (g.id = l.id),
          (g.datedb = l.datedb),
          localMixObject.saveMix(g),
          delete XHRmemotime.latest,
          h && h())
        : (k(), saveGA('mix', 'save_db_failed'))
    },
    error: function (l) {
      k()
    },
  })
}
function clickBtShareGlobal(g) {
  checkIfMixSavedThenShare('global', g || $(this))
}
function clickBtCopyLink(g) {
  checkIfMixSavedThenShare('clipboard', g || $(this))
}
function clickBtGoToMixlist() {
  backToHome(function () {
    openPlaylist('mixlist', true, true)
  })
}
function checkIfMixSavedThenShare(g, h) {
  lock()
  deleteFocus()
  Spinner.add(h)
  hasNetwork
    ? true !== mixToShare.mymix || mixToShare.online
      ? shareMix(g)
      : saveMixDB(
          mixToShare,
          function () {
            $scrollbox
              .find(".line[data-key='mix-" + mixToShare.link + "']")
              .removeClass('isoffline')
            shareMix(g)
          },
          function (j) {
            boxDialog.open(
              STR('pop.noCoServerText'),
              STR('pop.noCoServerTitle'),
              [STR('bt.ok')],
              []
            )
            Spinner.reset()
            unlock()
          }
        )
    : ((h = $mixlist.hasClass('show')
        ? STR('pop.noCoShareText')
        : STR('pop.noCoShareText') + ' ' + STR('pop.noCoShareText2')),
      boxDialog.open(
        h,
        STR('pop.noNetworkTitle'),
        [STR('bt.ok')],
        [
          function () {
            Spinner.reset()
          },
        ]
      ),
      unlock())
}
function shareMix(g, h) {
  if (
    null == h &&
    window.cordova &&
    window.plugins &&
    window.plugins.socialsharing
  ) {
    return TweenMax.delayedCall(0.5, shareMix, [g, true]), false
  }
  'global' != g && Spinner.reset()
  var h = mixToShare.name,
    k = mixToShare.title,
    q = domainOnline + 'mix/' + mixToShare.link,
    v = domainOnline + 'img/share/share-v' + app.version + '-en@2x.png',
    w = domainOnline + 'img/share/share-v' + app.version + '-en.png',
    x = STR('pop.shareSubject'),
    h = STR('pop.sharePresentMix')
      .split('%{name}')
      .join(h)
      .split('%{title}')
      .join(k),
    k = STR('pop.shareTextLike'),
    y = STR('pop.shareTextBeCool'),
    z =
      h +
      '\n' +
      q +
      '\n\n' +
      k +
      '\n\n---------------------------\n\nDownload the app: https://www.incredibox.com/info/store',
    k = y + ' #incredibox',
    A = h + ' ' + y + ' #incredibox',
    B = 'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(q),
    C =
      'https://twitter.com/intent/tweet?text=' +
      encodeURIComponent(k) +
      '&url=' +
      encodeURIComponent(q) +
      '&hashtags=musicApp,beatbox,pumpItUp&related=incredibox_%3AThe%20Incredibox%20official%20Twitter%20account!'
  switch (g) {
    case 'mail':
      window.cordova && window.plugins && window.plugins.socialsharing
        ? window.plugins.socialsharing.shareViaEmail(
            z,
            x,
            null,
            null,
            null,
            [w],
            E,
            F
          )
        : popupEmail()
      break
    case 'facebook':
      window.electron ? openURL(B) : windowPopup(B, 560, 350, true)
      break
    case 'twitter':
      window.electron ? openURL(C) : windowPopup(C, 560, 350, true)
      break
    case 'clipboard':
      window.electron
        ? electron.ipc
            .clipboard(q)
            .then(() => D())
            .catch((G) => popupGeneralError({ error: 'clipboard' }))
        : window.cordova && cordova.plugins && cordova.plugins.clipboard
        ? cordova.plugins.clipboard.copy(q, D, F)
        : (copyToClipboard(q), D(q))
      break
    case 'global':
      window.plugins && window.plugins.socialsharing
        ? (window.plugins.socialsharing.shareWithOptions(
            {
              message: A,
              subject: x,
              url: q,
              files: [v],
            },
            (G) => {},
            (G) => {
              F(G)
            }
          ),
          E())
        : (popupGlobalShare(), Spinner.reset())
      break
    case 'download':
      openURL(domainOnline + 'file/' + mixToShare.link), E()
  }
  function D(G) {
    var H
    appBrowser
      ? ((G =
          "<div class='formline'><div class='selectarea'>" +
          G.replace('https://www.', '') +
          '</div></div>'),
        (H = isIOS ? '' : STR('pop.shareClipboard')),
        boxDialog.open(
          G + H,
          STR('bt.link'),
          [STR('bt.ok')],
          [],
          false,
          false,
          'dialog-clipboard'
        ))
      : boxDialog.open(
          STR('pop.shareClipboard'),
          STR('pop.infoTitle'),
          [STR('bt.ok')],
          [],
          false,
          false,
          'dialog-clipboard'
        )
    E()
    unlock()
  }
  function E(G) {
    Spinner.reset()
    unlock()
  }
  function F(G) {
    popupGeneralError({
      txt: STR('pop.shareErrorText'),
      error: G,
    })
    Spinner.reset()
    unlock()
  }
}
function sendFeedback() {
  var h = 'feedback@incredibox.com',
    i = 'App feedback',
    j = '<br><br>----------'
  window.cordova
    ? (i +=
        ' - ' +
        (appleModel[device.model] || device.model) +
        ' ' +
        device.platform +
        ' ' +
        device.version +
        (isIOSMac ? ' (iOS on Mac)' : ''))
    : (i +=
        ' - ' +
        machine.deviceModel +
        ' ' +
        machine.osName +
        ' ' +
        machine.osVersion)
  j =
    (j =
      (j =
        (j =
          (j =
            (j =
              (j =
                (j =
                  (j =
                    (j =
                      (j =
                        (j += '<br>Store : ' + build.store) +
                        '<br>From : ' +
                        ucwords(build.platform) +
                        ' - ' +
                        (void 0 !== app
                          ? app.name + ' - v' + app.version
                          : 'index')) +
                      '<br>Version : ' +
                      build.version) +
                    '<br>DJ Name : ' +
                    user.djname) +
                  '<br>Ids : ' +
                  machine.uuid +
                  ' - ' +
                  user.guid +
                  (trustAppMobile ? ' - ' + device.serial : '')) +
                '<br>Lang : ' +
                user.lang +
                ' (' +
                currentLanguage +
                ')') +
              '<br>Device : ' +
              machine.deviceModel +
              ' - ' +
              document.body.clientWidth +
              'x' +
              document.body.clientHeight +
              ' - ' +
              (window.devicePixelRatio || 1)) +
            '<br>System : ' +
            machine.osName +
            ' - ' +
            machine.osVersion +
            (isIOSMac ? ' - iOS on Mac' : '')) +
          '<br>WV : ' +
          machine.browserFullVersion) +
        '<br>Anime size ' +
        animSize +
        ' - cnv density ' +
        cnvPXD +
        '<br>fileExt : ' +
        sndExt +
        ' ' +
        vidExt) +
      '<br>Evt : ' +
      pointerEventType.down) +
    '<br>SpRate : ' +
    (window.audioCtx && window.audioCtx.sampleRate ? audioCtx.sampleRate : '') +
    ' - ' +
    (window.audioCtx && window.audioCtx.baseLatency ? audioCtx.baseLatency : '')
  window.cordova && window.plugins && window.plugins.socialsharing
    ? ((j =
        (j =
          (j += '<br>----------') +
          '<br>App.device : ' +
          (appleModel[device.model] || device.model) +
          ' - ' +
          device.manufacturer) +
        '<br>App.system : ' +
        device.platform +
        ' - ' +
        device.version),
      window.plugins.socialsharing.shareViaEmail(
        '<br><br><br><i>' + j + '</i>',
        i,
        h,
        null,
        null,
        [],
        () => {},
        (k) => {
          popupGeneralError({
            txt: STR('pop.shareErrorText'),
            error: k,
          })
        }
      ))
    : ((j = j.replace(/<br>/g, '\r\n')),
      (h = 'mailto:' + h + '?subject=' + i + '&body=' + encodeURIComponent(j)),
      window.electron ? electron.ipc.openURL(h) : (window.location.href = h))
}
var languageListe = {
  'en-US': 'English',
  fr: 'Français',
  es: 'Español',
  'pt-BR': 'Português',
  it: 'Italiano',
  de: 'Deutsch',
  no: 'Norsk',
  pl: 'Polski',
  ru: 'Русский',
  ar: 'العربية',
  tr: 'Türkçe',
  ko: '한국어',
  ja: '日本語',
  'zh-CN': '简体中文',
  'zh-TW': '繁體中文',
  'hi-IN': 'हिंदी',
  'bn-IN': 'বাংলা',
  'ta-IN': 'தமிழ்',
  'te-IN': 'తెలుగు',
  th: 'ไทย',
  vi: 'Tiếng Việt',
  id: 'Indonesia',
  ms: 'Melayu',
}
function initLanguage() {
  currentLanguage = defaultLanguage = appCN ? 'zh-CN' : 'en-US'
  var h,
    i = ''
  for (h in languageListe)
    i +=
      '<div class="bt bt-soft" id="bt-lang-' +
      h +
      '"><div class="bck"><div class="txt">' +
      languageListe[h] +
      '</div></div><div class="hitzone"></div></div>'
  $('#pop-language .box-lang').append(i)
}
function checkLanguageCode(g) {
  var i = g.toLowerCase()
  return -1 < i.indexOf('en-')
    ? 'en-US'
    : -1 < i.indexOf('pt-')
    ? 'pt-BR'
    : -1 < i.indexOf('fr-')
    ? 'fr'
    : -1 < i.indexOf('es-')
    ? 'es'
    : -1 < i.indexOf('it-')
    ? 'it'
    : -1 < i.indexOf('de-')
    ? 'de'
    : -1 < i.indexOf('cn')
    ? 'zh-CN'
    : 'zh-hant' == i || 'zh-hk' == i || 'zh-tw' == i
    ? 'zh-TW'
    : 'zh-hans' == i || 'zh-cn' == i
    ? 'zh-CN'
    : 'en' == i
    ? 'en-US'
    : 'pt' == i
    ? 'pt-BR'
    : 'zh' == i
    ? 'zh-CN'
    : 'hi' == i
    ? 'hi-IN'
    : 'bn' == i
    ? 'bn-IN'
    : 'ta' == i
    ? 'ta-IN'
    : 'te' == i
    ? 'te-IN'
    : 'nb' == i || 'nn' == i
    ? 'no'
    : g
}
function debugLanguage() {}
function changeDomTxt() {
  var h,
    i = translateObj.trad
  $('#pop-info .tab#tab-tuto .txt').html(i.bt.tuto)
  $('#pop-info #bloc-tuto1 .txt span').html(i.txt.tuto1)
  $('#pop-info #bloc-tuto2 .txt span').html(i.txt.tuto2)
  $('#pop-info #bloc-tuto3 .txt span').html(i.txt.tuto3)
  $('#pop-info #bloc-tuto4 .txt span').html(i.txt.tuto4)
  $('#pop-info #bloc-tuto5 .txt span').html(i.txt.tuto5)
  $('#pop-info .tab#tab-credit .txt').html(i.bt.credit)
  $('#pop-info #pop-credit #copy').html(i.txt.copyright)
  $('#pop-info #pop-credit #team').html(
    "<div class='box-team'>Allan Durand<br>Romain Delambily<br>Incredible Polo</div><div class='box-team'>" +
      i.txt.team +
      '</div>'
  )
  $('#pop-info #pop-credit .title').html(i.txt.stayTuned)
  $('#pop-info #pop-credit #bt-feedback .txt').html(i.bt.feedback)
  $('#pop-info #pop-credit #bt-rating .txt').html(i.bt.rate)
  $('#pop-info #pop-credit #bt-privacy .txt').html(i.bt.privacy)
  $('#pop-info .tab#tab-follow .txt').html(i.bt.follow)
  $('#pop-info #pop-follow .title#git').html(i.bt.git)
  $('#pop-info #pop-follow .title#shop').html(i.txt.visitShop)
  $('#pop-param .tab#tab-language .txt').html(i.txt.language)
  $('#pop-param .tab#tab-setting .txt').html(i.bt.param)
  $('#pop-param #pop-setting #param-dark .label').html(i.txt.modeDark)
  $('#pop-param #pop-setting #param-safe .label').html(i.txt.modeSafe)
  $('#pop-param #pop-setting #param-reset .label').html(i.txt.resetBonus)
  $('#pop-param #pop-setting #param-reset .bt .txt').html(i.bt.reset)
  $('#pop-param #pop-setting #param-recover .label').html(i.txt.recoverAllMix)
  $('#pop-param #pop-setting #param-recover .bt .txt').html(i.bt.recover)
  $('#pp-box #bt-ppaccept .txt').html(i.bt.accept)
  $('#pp-box #bt-pprefuse .txt').html(i.bt.refuse)
  pageApp
    ? ($('#mixlist .tab#tab-latest .txt').html(i.bt.latest),
      $('#mixlist .tab#tab-top50 .txt').html(i.bt.top50),
      $('#mixlist .tab#tab-search .txt').html(i.bt.search),
      $('#mixlist .tab#tab-mixlist .txt').html(i.bt.myMix),
      $('#mixlist #box-search #input-search').attr(
        'placeholder',
        i.txt.inputSearch
      ),
      $('#mixlist #box-search #input-search').val(''),
      (lastSearch = ''),
      cleanListSearch(),
      $('#mixlist .tab-filter #bt-name .txt').html(i.bt.djname),
      $('#mixlist .tab-filter #bt-title .txt').html(i.bt.mixtitle),
      $('#mixlist .tab-filter #bt-dedi .txt').html(
        i.txt.dedicatedTo.split('%{name}').join('')
      ),
      $('#mixlist .tab-filter #bt-day .txt').html(i.bt.day),
      $('#mixlist .tab-filter #bt-week .txt').html(i.bt.week),
      $('#mixlist .tab-filter #bt-month .txt').html(i.bt.month),
      $('#mixlist .tab-filter #bt-year .txt').html(i.bt.year),
      $('#mixlist .scroll:not(#list-mymix) .infoListmix').html(i.txt.top50Info),
      0 < mixDB.totalNbMix
        ? $('#mixlist #latestbox .boxinfo').html(
            i.txt.latestMixInfo
              .replace('%{mix_total}', numberSpaced(mixDB.totalNbMix))
              .replace('%{version_name}', app.name)
          )
        : $('#mixlist #latestbox .boxinfo').html(
            i.txt.latestMixInfo.split('<br>')[0]
          ),
      $('#mixlist #list-day .boxinfo').html(i.txt.top50Info),
      $('#mixlist #list-week .boxinfo').html(i.txt.top50Info),
      $('#mixlist #list-month .boxinfo').html(i.txt.top50Info),
      $('#mixlist #list-year .boxinfo').html(i.txt.top50Info),
      $('#mixlist .box-info .offline .txt').html(i.txt.offline),
      $('#watch-info #bt-save .txt').html(i.bt.save),
      $('#watch-info .offline .txt').html(i.txt.offline),
      notnull(localMixObject) &&
        ((h =
          0 == localMixObject.getMixlist().length
            ? STR('txt.mixlistEmpty')
            : STR('txt.mixlistInfo')),
        $('#list-mymix .boxinfo', $poplist).html(h)),
      $('#watch-info .date, .box-info .date').each(function () {
        var j
        $(this).attr('data-date') &&
          ((j = $(this).attr('data-date')), $(this).html(getStringDate(j)))
      }),
      $('#pop-switch .title').html(i.txt.enjoyVersion),
      $('#game #box-bt1 #bt-stop .txt').html(i.bt.menuRestart),
      $('#game #box-bt1 #bt-random .txt').html(i.bt.menuRandom),
      $('#game #box-bt1 #bt-record .txt').html(i.bt.menuRecord))
    : ($('#page-splash #sp-baseline').html(STR('txt.baseline')),
      $('#page-splash #sp-experience').html(STR('txt.sp-experience')),
      $('#page-splash #sp-choose').html(STR('txt.selectVersion')))
  notnull(boxPopup) && boxPopup.isOpen() && boxPopup.refresh()
  window.electron && electron.ipc.loadLang(i)
}
function loadLanguage(g) {
  var i = g && g.lang ? g.lang : null,
    j =
      notnull(i) && notnull(languageListe[i])
        ? i
        : notnull(user.lang) && '' != user.lang
        ? user.lang
        : '' != machine.language
        ? machine.language
        : defaultLanguage,
    i =
      (appBrowser &&
        (j = getParameterByName('lang')
          ? getParameterByName('lang')
          : machine.language),
      window.electron &&
        isnull(i) &&
        '' == user.lang &&
        notnull(electron.vars.lang) &&
        (j = checkLanguageCode(electron.vars.lang)),
      (j = checkLanguageCode(j)),
      isnull(languageListe[j]) && (j = defaultLanguage),
      $('#pop-language .box-lang .bt-soft#bt-lang-' + j).addClass('active'),
      notnull(translateObj) && $('body').removeClass('lang-' + currentLanguage),
      new XMLHttpRequest())
  function k() {
    return g && g.fail ? g.fail() : loadLanguageFailed(), false
  }
  i.addEventListener(
    'load',
    function () {
      if (200 != this.status) {
        return k(), false
      }
      translateObj = jsonDecode(this.responseText)
      setUserInfo({ lang: (currentLanguage = j) })
      $('body').addClass('lang-' + currentLanguage)
      g && g.cbck && g.cbck()
      saveGA('language', 'load_success', currentLanguage)
    },
    false
  )
  i.addEventListener('error', k, false)
  i.open('GET', './lang/' + j + '.json')
  i.send()
}
function loadLanguageFailed() {
  setUserInfo({ lang: defaultLanguage })
  boxDialog.open(
    'Impossible to load language settings. Please reload or force to quit the app then retry.',
    'ERROR',
    ['Reload'],
    [gotoAppUrl],
    true
  )
}
function clickBtLang(g) {
  var g = $(g.currentTarget),
    i = g.attr('id').replace('bt-lang-', '')
  g.hasClass('active') ||
    ($('#pop-language .box-lang .bt').removeClass('active'),
    g.addClass('active'),
    loadLanguage({
      cbck: changeDomTxt,
      lang: i,
    }))
}
function STR(g) {
  for (
    var j = g.split('.'), k = translateObj.trad, l = 0, m = j.length;
    l < m;
    l++
  ) {
    var p = j[l]
    if (!(p in k)) {
      return
    }
    k = k[p]
  }
  return k
}
var tabBuffer,
  tabAnime,
  nbSound,
  nbSoundBonus,
  nbSoundTotal,
  nbBonus,
  nbAnime,
  nbData,
  cntTotalAsset,
  nbTotalAsset,
  tabToLoad,
  cntLoad,
  listImages = {}
function preparerArray() {
  frameTotal = app.totalframe
  frameHalf = frameTotal / 2
  tabBuffer = {}
  tabAnime = []
  nbSound = app.animearray.length
  nbSoundBonus = app.bonusarray.length
  nbSoundTotal = 2 * nbSound + nbSoundBonus + 1
  nbBonus = app.bonusarray.length
  nbAnime = app.animearray.length
  nbData = app.animearray.length
  nbTotalAsset = nbSoundTotal + nbBonus + nbAnime + nbData + 2
  tabToLoad = []
  var h = (cntLoad = cntTotalAsset = 0),
    i = ''
  for (tabBuffer.sound = [], h = 0; h < nbSound; h++) {
    tabBuffer.sound.push({
      sndA: 0,
      sndB: 0,
    })
    tabAnime.push({
      imgSprite: null,
      ratio: null,
      width: null,
      height: null,
      headWidth: null,
      headHeight: null,
      totalFrames: null,
      imgData: null,
      color: app.animearray[h].color,
    })
  }
  for (tabBuffer.bonus = [], h = 0; h < nbSoundBonus; h++) {
    tabBuffer.bonus.push({
      snd: 0,
      aspire: 0,
    })
  }
  for (
    tabBuffer.metro = [{ snd: 0 }],
      tabToLoad = [
        {
          func: loadImage,
          params: {
            keyname: 'spritePolo',
            path:
              './img/' +
              renameFile(
                appBrowserSchool ? 'polo-sprite-tshirt.png' : 'polo-sprite.png'
              ),
          },
        },
        {
          func: loadImage,
          params: {
            keyname: 'gameBck',
            path: './' + app.folder + 'img/game-bck@2x.jpg',
          },
        },
        {
          func: loadImage,
          params: {
            keyname: 'gamePicto',
            path: './' + app.folder + 'img/game-picto@2x.png',
          },
        },
      ],
      miniPlayer && 4 < appVersion && tabToLoad.pop(),
      h = 0;
    h < nbSound;
    h++
  ) {
    app.animearray[h].uniqsnd
      ? (tabToLoad.push({
          func: loadSound,
          params: ['sound', app.animearray[h].soundA, h, 'sndA', true],
        }),
        nbTotalAsset--)
      : (tabToLoad.push({
          func: loadSound,
          params: ['sound', app.animearray[h].soundA, h, 'sndA'],
        }),
        tabToLoad.push({
          func: loadSound,
          params: ['sound', app.animearray[h].soundB, h, 'sndB'],
        }))
  }
  for (h = 0; h < nbSoundBonus; h++) {
    tabToLoad.push({
      func: loadSound,
      params: ['bonus', app.bonusarray[h].sound, h, 'snd'],
    })
    app.bonusarray[h].aspire &&
      tabToLoad.push({
        func: loadSound,
        params: ['bonus', app.bonusarray[h].aspire, h, 'aspire'],
      })
    i = renameFile(app.bonusarray[h].src)
    tabToLoad.push({
      func: loadVideoBonus,
      params: [i, h],
    })
  }
  for (h = 0; h < nbAnime; h++) {
    i = app.animearray[h].animeData
    tabToLoad.push({
      func: loadAnimeData,
      params: [i, h],
    })
    i = renameFile(app.animearray[h].anime)
    tabToLoad.push({
      func: loadAnime,
      params: [i, h],
    })
  }
  checkTabToLoad()
}
function checkTabToLoad() {
  updatePreload()
  cntLoad < tabToLoad.length &&
    (tabToLoad[cntLoad].func(tabToLoad[cntLoad].params), cntLoad++)
}
function updatePreload() {
  cntTotalAsset++
  var h = (h = Math.round((cntTotalAsset / nbTotalAsset) * 100)) < 5 ? 5 : h
  $homeLoadbar.css({ width: String(100 < h ? 100 : h) + '%' })
  cntTotalAsset == nbTotalAsset &&
    (createGame(), hideHomeLoadbar(), isIframe) &&
    callParentWindow('appLoadingComplete')
}
function loadSound(g) {
  var j = g[0],
    k = g[1],
    l = g[2],
    m = g[3],
    p = !isnull(g[4]) && g[4],
    q = './' + app.folder + 'sound/' + sndExt + '/' + k + '.' + sndExt,
    u = new XMLHttpRequest()
  u.open('GET', q, true)
  u.responseType = 'arraybuffer'
  u.onload = function () {
    audioCtx.decodeAudioData(
      u.response,
      function (w) {
        tabBuffer[j][l][m] = w
        p && (tabBuffer[j][l].sndB = w)
        checkTabToLoad()
      },
      function (w) {
        popupGeneralError({
          error: 'Decoding ' + q.replace('./', ''),
          action: 'reload',
        })
      }
    )
  }
  u.onerror = function () {
    popupGeneralError({
      error: 'XHR ' + q.replace('./', ''),
      action: 'reload',
    })
  }
  u.send()
}
function loadAnimeData(g) {
  var i = g[0],
    j = g[1],
    k = './' + app.folder + 'anime/' + i,
    l = new XMLHttpRequest()
  l.open('GET', k, true)
  l.responseType = 'json'
  l.onload = function () {
    for (
      var m = l.response, p = m.arrayFrame, q = p.length, u = [], v = 0;
      v < q;
      v++
    ) {
      var w = p[v].prop.split(',')
      u.push([parseInt(w[0]), parseInt(w[1]), parseInt(w[2]), parseInt(w[3])])
    }
    tabAnime[j].imgData = u
    tabAnime[j].headHeight = m.headHeight
    checkTabToLoad()
  }
  l.onerror = function () {
    popupGeneralError({
      error: 'XHR ' + k.replace('./', ''),
      action: 'reload',
    })
  }
  l.send()
}
function loadAnime(g) {
  var j = g[0],
    k = g[1],
    l = './' + app.folder + 'anime/' + j,
    m = new Image()
  m.onload = function () {
    ;(tabAnime[k].imgSprite = m), checkTabToLoad()
  }
  m.onerror = function () {
    popupGeneralError({
      error: 'Load ' + l.replace('./', ''),
      action: 'reload',
    })
  }
  m.src = l
}
function loadVideoBonus(g) {
  var i = g[0],
    j = './' + app.folder + 'video/' + i,
    k = g[1] + 1,
    g = new XMLHttpRequest()
  g.onload = function () {
    var l = this.response,
      m = document.createElement('video')
    m.src = window.URL.createObjectURL(l)
    m.type = 'video/' + vidExt
    m.muted = true
    m.setAttribute('playsinline', 'playsinline')
    m.setAttribute('webkit-playsinline', 'webkit-playsinline')
    m.setAttribute('muted', '')
    m.onerror = function (p) {
      popupGeneralError({ error: 'Video ' + i })
    }
    m.oncanplaythrough = function (p) {
      m.oncanplaythrough = null
      $boxVideo.prepend("<div class='video' id='video" + k + "'></div>")
      $boxVideo.find('.video#video' + k).append(m)
      checkTabToLoad()
    }
    m.load()
  }
  g.onerror = function () {
    popupGeneralError({
      error: 'XHR ' + j.replace('./', ''),
      action: 'reload',
    })
  }
  g.open('GET', j)
  g.responseType = 'blob'
  g.send()
}
function preloadImageForCSS(g) {
  var h = g.images.length,
    j = 0,
    k = { p: this }
  function l() {
    var m = new Image(),
      p = g.images[j][0],
      q = g.images[j][1]
    m.onload = function () {
      j++
      g.progress(Math.floor((100 * j) / h))
      j == h ? g.good(k) : l()
    }
    m.onerror = function () {
      var u = q.split('/').pop()
      g.nope(u)
    }
    m.src = q
  }
  l()
}
function loadImage(g) {
  var i = new Image()
  i.onload = function () {
    listImages[g.keyname] = this
    checkTabToLoad()
  }
  i.onerror = function () {
    popupGeneralError({
      error: 'Load ' + g.path.replace('./', ''),
      action: 'reload',
    })
  }
  i.src = g.path
}
var CloudSync = function () {
    return (
      (this.sync = function (h) {
        notnull(h)
      }),
      (this.save = nada),
      (this.remove = nada),
      this
    )
  },
  LocalStorage = function () {
    var h = this
    return (
      (this.setItem = function (i, j, k) {
        window.localStorage.setItem(i, j)
        k && cloud.save(i, j)
      }),
      (this.getItem = function (i) {
        return window.localStorage.getItem(i)
      }),
      (this.getAllItem = function () {
        return window.localStorage
      }),
      (this.removeItem = function (i, j) {
        window.localStorage.removeItem(i)
        j && cloud.remove(i)
      }),
      (this.clear = function () {
        window.localStorage.clear()
      }),
      (this.weight = function () {
        var j,
          k,
          l = window.localStorage,
          m = 0,
          p = 'LS | --------------------------\n'
        for (k in l)
          (m += j = 2 * (l[k].length + k.length)),
            (p +=
              'LS | ' +
              k.substr(0, 50) +
              ' = ' +
              (j / 1024).toFixed(2) +
              ' KB\n')
        return (p =
          p +
          ('LS | Total = ' + (m / 1024).toFixed(2) + ' KB\n') +
          'LS | --------------------------')
      }),
      (this.restoreMixFromDB = function (i) {
        var j = {},
          k =
            ((j.uuid = getListUUID()),
            (j.guid = getUserInfo().guid),
            (j.mixids = localMixObject.getAllMixId()),
            i || nada)
        hasNetwork &&
          (j.uuid.length || j.user.guid || j.mixids.length) &&
          $.ajax({
            type: 'POST',
            url: domainOnline + 'ph3/get-all-mix-db.php',
            data: j,
            dataType: 'json',
            crossdomain: true,
            success: function (l) {
              var p
              'success' == l.state
                ? (l.mixlist.forEach(function (q) {
                    q.synced = true
                    q.online = true
                    q.mymix = true
                    localMixObject.saveMix(q)
                    localMixObject.getMix('fav-' + q.link) &&
                      localMixObject.saveMix(q, true)
                  }),
                  localMixObject.getAllMix().forEach(function (q) {
                    q.mymix &&
                      q.online &&
                      !q.synced &&
                      (h.removeItem('mix-' + q.link),
                      h.removeItem('fav-' + q.link),
                      0)
                  }),
                  (p = getListUUID()),
                  p.forEach(function (q) {
                    q.toUpperCase() == machine.uuid.toUpperCase() ||
                      existInArray(l.uuidlist, q, false) ||
                      (h.removeItem('uuid-' + q, true), 0)
                  }),
                  l.uuidlist.forEach(function (q) {
                    h.setItem('uuid-' + q.toUpperCase(), '', true)
                    0
                  }),
                  k({
                    msg: 'ok',
                    nb: l.mixlist.length,
                  }))
                : k({ msg: 'bug' })
            },
            error: function (l) {
              k({ msg: 'error' })
            },
          })
      }),
      this
    )
  },
  LocalMixObject = function () {
    var h = this
    this.saveMix = function (i, j) {
      var k,
        j = !!notnull(j) && j
      return (
        !!notnull(i) &&
        ((k = -1 == i.link.indexOf('mix-') ? 'mix-' + i.link : i.link),
        (k = j ? k.replace('mix-', 'fav-') : k),
        (j = jsonEncode(i)),
        storage.setItem(k, j),
        true)
      )
    }
    this.deleteMix = function (i) {
      return (
        !!notnull(storage.getItem(i)) && (storage.removeItem(i, true), true)
      )
    }
    this.deleteMixById = function (i) {
      var j,
        k = h.getAllMix(true),
        l = h.getAllMix(true, true)
      for (j in k)
        k[j].id == i &&
          (h.deleteMix('mix-' + k[j].link), h.deleteMix('fav-' + k[j].link))
      for (j in l)
        l[j].id == i &&
          (h.deleteMix('fav-' + l[j].link), h.deleteMix('mix-' + l[j].link))
    }
    this.getMix = function (i) {
      return !!notnull(storage.getItem(i)) && jsonDecode(storage.getItem(i))
    }
    this.getAllMix = function (j, k) {
      var l,
        m,
        p = !!notnull(j) && j,
        j = !!notnull(k) && k,
        q = [],
        u = storage.getAllItem(),
        v = j ? 'fav-' : 'mix-'
      for (l in u)
        -1 != l.indexOf(v) &&
          (isnull((m = jsonDecode(u[l])).datedb) &&
            (m.datedb = notnull(m.date) ? m.date : getDateNow()),
          (p &&
            -1 == l.indexOf('v' + app.version) &&
            -1 == l.indexOf('-IOSV' + app.version)) ||
            q.push(m))
      return q
    }
    this.saveMixOffline = function () {
      var i,
        j = h.getAllMix()
      for (i in j) {
        var k = j[i]
        !k.online && k.mymix && saveMixDB(k)
      }
    }
    this.getAllMixId = function () {
      var i,
        j = h.getAllMix(false),
        k = []
      for (i in j) {
        var l = j[i]
        l.id && k.push(parseInt(l.id))
      }
      return k
    }
    this.getMixlist = function () {
      var i = h.getAllMix(true, false)
      return h.sortArrayMix(i)
    }
    this.getFavlist = function () {
      var i = h.getAllMix(true, true)
      return h.sortArrayMix(i)
    }
    this.sortArrayMix = function (i, j) {
      return (
        i.sort(function (k, l) {
          return l.datedb > k.datedb ? 1 : l.datedb < k.datedb ? -1 : 0
        }),
        (i = true === j ? i.reverse() : i)
      )
    }
    this.getLastMix = function () {
      var i = h.getAllMix(false),
        j = i.length
      return 0 < j ? i[j - 1] : null
    }
    this.getLastDjName = function () {
      var i = h.getLastMix()
      return notnull(i) ? i.name : ''
    }
    this.deleteAllMix = function () {
      for (var i in storage.getAllItem())
        (-1 == i.indexOf('mix-') && -1 == i.indexOf('fav-')) ||
          storage.removeItem(i)
    }
    this.getStatMixOnline = function (j) {
      var k = h.getAllMixId()
      k.length
        ? xhr(
            'GET',
            domainOnline + 'ph3/get-stat-mix.php',
            { id: k },
            function (l) {
              if ('success' == l.state) {
                XHRmemotime.mymix = new Date()
                var l = l.list,
                  m = []
                if (
                  (l.forEach(function (r) {
                    m.push(parseInt(r.id))
                    var s = h.getMix('mix-' + r.link)
                    s.id = r.id
                    s.newnbview = r.nbview
                    s.newnblike = r.nblike
                    h.saveMix(s)
                  }),
                  m.length < k.length)
                ) {
                  var p,
                    l = uniqueBetweenArray(m, k)
                  for (p of l) h.deleteMixById(p)
                }
                void 0 !== j && j()
              }
            },
            function (l) {}
          )
        : void 0 !== j && j()
    }
    this.getStatFavOnline = function (j) {
      var k = h.getFavlist(),
        l = []
      k.forEach(function (m) {
        ;(m.mymix && !m.online) || !notnull(m.id) || l.push(parseInt(m.id))
      })
      l.length
        ? xhr(
            'GET',
            domainOnline + 'ph3/get-stat-mix.php',
            { id: l },
            function (m) {
              if ('success' == m.state) {
                XHRmemotime.myfav = new Date()
                var m = m.list,
                  p = []
                if (
                  (m.forEach(function (r) {
                    p.push(parseInt(r.id))
                    var s = h.getMix('fav-' + r.link)
                    s.id = r.id
                    s.nbview = r.nbview
                    s.nblike = r.nblike
                    h.saveMix(s, true)
                  }),
                  p.length < l.length)
                ) {
                  var q,
                    m = uniqueBetweenArray(p, l)
                  for (q of m) h.deleteMixById(q)
                }
                void 0 !== j && j()
              }
            },
            function (m) {}
          )
        : void 0 !== j && j()
    }
  },
  BonusObject = function (j, q, z) {
    var B,
      E = this,
      F = j + 1,
      G = $('#bt-bonus-' + F),
      H = G.find('.quarter'),
      I = $('.circle', G),
      J = $('#box-video .video#video' + F),
      K = $('#box-video .video#video' + F + ' video')[0],
      L = false,
      M = false,
      N = new SoundObject('bonus' + F),
      O = new SoundObject('aspire' + F),
      P = z.snd,
      Q = z.aspire,
      R = numberArray(q.code.split(',')),
      S = R.length,
      U = [],
      V = 0,
      W = 0,
      j =
        ((this['$div'] = J),
        (this.tabSVG = U),
        (this.video = K),
        (this.found = false),
        (this.unlock = false),
        (E.cntCode = 0),
        (E.nbLoop = q.loop),
        (E.sound = N),
        (this.init = function () {
          var a1 = storage.getItem('v' + appVersion + '-bonus-complete') || 0
          0 == E.getId() || E.getId() <= a1 ? E.unlockme() : E.lockme()
          for (var a2 = 0; a2 < S; a2++) {
            var a3 = {
              obj: $('.svg.q' + (a2 + 1), H),
              col: $('.svg.q' + (a2 + 1) + ' svg', H).css('fill'),
            }
            U.push(a3)
          }
          E.modeTouch()
        }),
        (this.reinit = function () {
          E.hideLoader()
          G.removeClass('inprogress found bounce')
          H.find('.svg').removeClass('directshow show hide')
          E.found = false
          E.inprogress = false
          E.cntCode = 0
          E.modeTouch()
        }),
        (this.modeTouch = function () {
          G.off().on(pointerEventType.down, E.touchStart)
        }),
        (this.modeClick = function () {
          G.off().on(pointerEventType.down, E.launchVideo)
        }),
        (this.unlockme = function () {
          G.addClass('unlock')
          this.unlock = true
        }),
        (this.lockme = function () {
          G.removeClass('unlock')
          this.unlock = false
        }),
        (this.getId = function () {
          return F - 1
        }),
        (this.getCode = function () {
          return R
        }),
        G.find('.box-loader .zone')),
      X = j.find('.loader'),
      Y = j.find('.bar'),
      Z = false,
      a0 =
        ((this.showLoader = function () {
          Z = true
          X.addClass('show')
          Y.css({
            'animation-duration':
              decimal(getRemainingTimeBeforeBonus() / 1000, 2) + 's',
          })
          Y.addClass('progress')
        }),
        (this.hideLoader = function () {
          Z && ((Z = false), X.removeClass('show'), Y.removeClass('progress'))
        }),
        new ClockObject('canvas-bt-bonus-' + F))
    a0.init(43, 43, 1, 35, 16)
    this.playAspiration = function (a1) {
      a1 = notnull(a1) ? a1 : 0
      O.prepare(Q, 0)
      O.play(a1, true)
      M = true
    }
    this.stopAspiration = function () {
      M && (O.stop(true), (M = false))
    }
    this.hasCode = function (a1) {
      return -1 != R.indexOf(a1)
    }
    this.checkCode = function (a1, a2) {
      a1 = R.indexOf(a1)
      ;-1 < a1 && (a2 ? E.showQuarter(a1) : E.hideQuarter(a1))
    }
    this.showQuarter = function (a1) {
      E.cntCode++
      var a2 = U[a1].obj,
        a1 = U[a1].col
      E.cntCode == S && E.unlock && E.hasBeenFound()
      1 == E.cntCode && ((E.inprogress = true), G.addClass('inprogress'))
      I.addClass('show').one(animationEnd, function (a3) {
        $(a3.target).removeClass('show')
      })
      I.css({ 'border-color': a1 })
      a2.removeClass('hide').addClass('directshow show')
    }
    this.hideQuarter = function (a1) {
      E.unlock
        ? a1.addClass('hide').one(animationEnd, function (a3) {
            $(a3.target).removeClass(a2.GaDGZ)
          })
        : a1.removeClass('directshow show hide')
      E.cntCode == S && (cancelClickBtBonus(), this.notFoundAnymore())
      E.cntCode--
      E.cntCode < 0 && (E.cntCode = 0)
      0 == E.cntCode && ((E.inprogress = false), G.removeClass('inprogress'))
      E.unlock
        ? a1.addClass('hide').one(animationEnd, function (a3) {
            $(a3.target).removeClass(a2.GaDGZ)
          })
        : a1.removeClass('directshow show hide'),
        E.cntCode == S && (cancelClickBtBonus(), this.notFoundAnymore()),
        E.cntCode--,
        E.cntCode < 0 && (E.cntCode = 0),
        0 == E.cntCode && ((E.inprogress = false), G.removeClass('inprogress'))
    }
    this.hideClock = function () {
      a0.stop(true)
    }
    this.render = function () {
      a0.render()
    }
    this.hasBeenFound = function () {
      modeReplay || (G.addClass('found bounce'), popupBonusUnlocked())
      E.modeClick()
      E.found = true
    }
    this.notFoundAnymore = function () {
      modeReplay || G.removeClass('found bounce')
      E.found = false
      E.hideClock()
      E.hideLoader()
      E.modeTouch()
    }
    this.touchStart = function (a1) {
      a1.preventDefault()
      E.unlock
        ? bonusPlaying ||
          ((B = ~a1.type.indexOf('touch') ? G : $body).on(
            pointerEventType.up,
            E.touchEnd
          ),
          (V = getTime()),
          showPoloAndPictoInCombo(F))
        : popupFindPreviousBonus()
    }
    this.touchEnd = function (a1) {
      a1.preventDefault()
      B.off(pointerEventType.up, E.touchEnd)
      stopShowingPoloInArray(V)
    }
    this.launchVideo = function () {
      var a1
      bonusWaiting ||
        bonusPlaying ||
        ((a1 = !app.bonusloopA || boucleA),
        !modeWatch && getRemainingTime() < 500 && a1) ||
        (E.modeTouch(),
        E.showLoader(),
        recordMix.xmlAction('bonus', E),
        clickBtBonus(F),
        G.removeClass('bounce'),
        I.addClass('showCircle').one(animationEnd, function (a2) {
          $(a2.target).removeClass('showCircle')
        }),
        E.prepareVideo(1))
    }
    this.prepareVideo = function (a1) {
      K.error && K.load()
      W = (app.looptime * (a1 - 1)) / 1000
      K.currentTime = W
    }
    this.videoPlaying = function () {}
    this.videoEnded = function () {}
    this.play = function () {
      M = !(L = true)
      G.addClass('playing')
      E.hideLoader()
      a0.start(loopDuration * E.nbLoop, false)
      N.prepare(P)
      N.play(W)
      J.addClass('show')
      K.play()
        .then(() => {})
        .catch((a1) => {
          throw new Error(a1)
        })
    }
    this.stop = function () {
      G.removeClass('playing')
      loopOn && E.found && E.modeClick()
      L && (N.stop(true), a0.stop(true))
      E.stopAspiration()
      L = false
      J.removeClass('show')
      K.pause()
    }
    this.pause = function () {
      L && K.pause()
      a0.pause()
    }
    this.resume = function () {
      L && K.play()
      a0.resume()
    }
    this.init()
  },
  ClockObject = function (j) {
    var q,
      w,
      x,
      y,
      z,
      A,
      B,
      C,
      D,
      E,
      F,
      G = this,
      H = $('#' + j)[0].getContext('2d'),
      I = 2 * Math.PI,
      J = Math.PI / 2,
      K = false,
      L = false,
      M = 0
    this.start = function (N, O) {
      C = isDarkMode() ? '#CCCCCC' : '#5A5A5A'
      H.strokeStyle = C
      L = !(K = true)
      F = O
      E = 100 / N
      D = getTime()
    }
    this.stop = function (N) {
      K = false
      N ? G.clear() : ((L = true), (q = F ? 0 : 1))
    }
    this.pause = function () {
      M = getTime()
    }
    this.resume = function () {
      var N = getTime() - M
      D += N
    }
    this.render = function () {
      var N, O
      ;(K || L) &&
        (K
          ? ((N = getTime() - D), (w = (N * E) / 100))
          : L && (w += 0.2 * (q - w)),
        0.999 < (w = w < 0.001 ? 0.001 : w) && (w = 0.999),
        (N = F ? -J : I * w - J),
        (O = F ? I * w - J : -J),
        G.clear(),
        H.beginPath(),
        H.arc(x, y, A, N, O, false),
        H.stroke(),
        !L || (0.001 != w && 0.999 != w) || ((L = false), G.clear()))
    }
    this.clear = function () {
      H.clearRect(x - A - B / 2, y - A - B / 2, 2 * A + B, 2 * A + B)
    }
    this.init = function (N, O, P, Q, R, S) {
      x = null == N ? 0 : N
      y = null == O ? 0 : O
      z = null == P ? 1 : P
      A = null == Q ? 18 : Q
      B = null == R ? 6 : R
      C = null == S ? '#FFFFFF' : S
      H.lineWidth = B
      H.strokeStyle = C
      H.globalAlpha = z
    }
  },
  ReadingBar = function (g, h, j) {
    var q,
      w = this,
      x = $(g),
      y = $('#reading-buffer', x),
      z = $cntRecord.find('#t-spent'),
      A = $cntRecord.find('#t-duration'),
      B = '00:00',
      C = false,
      D = 0,
      E = 'record',
      F = secToText(app.looptime * app.recmaxloop),
      G = 0,
      H = 0
    this.minLoop = h
    this.maxLoop = j
    this.maxTime = 0
    this.cntLoop = 0
    this.bonusList = []
    this.onLoopsFinished = nada
    this.onLooping = nada
    this.isFinished = function () {
      return this.cntLoop == this.maxLoop
    }
    this.isLastLoop = function () {
      return this.cntLoop + 1 == this.maxLoop
    }
    this.open = function (I, J) {
      return (
        (E = I),
        w.createRecordBlock(J),
        (w.cntLoop = 0),
        (w.maxTime = 'record' == E ? F : secToText(w.maxLoop * app.looptime)),
        y.css({ transform: 'scaleX(0)' }),
        (B = '00:00'),
        z.text(B),
        A.text(' / ' + w.maxTime),
        (G = 0),
        (H = 100 / readingBar.maxLoop),
        x.addClass('open'),
        $cntRecord.addClass('fadeIn'),
        callParentWindow('replayTime', {
          state: 'open',
          spent: B,
          duration: w.maxTime,
        }),
        w
      )
    }
    this.close = function () {
      return (
        (w.onLoopsFinished = nada),
        (w.onLooping = nada),
        removeTransition(x, 'open', 'transform', function () {
          y.removeClass('progress')
          $('#reading-marker').empty()
          $('#reading-marker-bonus').empty()
          w.bonusList = []
        }),
        $cntRecord.removeClass('fadeIn cssdelay'),
        w
      )
    }
    this.start = function () {
      return (
        (C = true),
        (w.cntLoop = 0),
        (D = 0),
        w.render(),
        (G = Math.floor(D + q) / w.maxLoop),
        y.css({
          transform: 'scaleX(' + G / 100 + ')',
          'animation-duration':
            decimal((w.maxLoop * app.looptime) / 1000, 2) + 's',
        }),
        y.addClass('progress'),
        callParentWindow('replayTime', {
          state: 'start',
          spent: B,
          duration: w.maxTime,
        }),
        w
      )
    }
    this.stop = function () {
      return (
        (C = false),
        callParentWindow('replayTime', {
          state: 'stop',
          spent: B,
          duration: w.maxTime,
        }),
        w
      )
    }
    this.froze = function () {
      y.addClass('froze')
    }
    this.seek = function (I) {
      w.cntLoop = I
      y.removeClass('progress')
      resetAnimationCSS(y[0])
      y.css({ transform: 'scaleX(' + (H * w.cntLoop) / 100 + ')' })
      w.render()
    }
    this.unfroze = function () {
      y.css({
        transform: 'scaleX(' + (H * w.cntLoop) / 100 + ')',
        'animation-duration':
          decimal(((w.maxLoop - w.cntLoop) * app.looptime) / 1000, 2) + 's',
      })
      y.removeClass('froze').addClass('progress')
    }
    this.openBig = function () {
      x.addClass('seeking')
    }
    this.openNormal = function () {
      x.removeClass('seeking')
    }
    this.loop = function () {
      return (
        w.cntLoop++,
        (D += q),
        w.isFinished()
          ? w.onLoopsFinished && w.onLoopsFinished()
          : w.onLooping && w.onLooping(),
        w
      )
    }
    this.render = function () {
      var I
      C &&
        ((q = pctMetronome),
        (I = secToText(getTimeSpent() + loopDuration * w.cntLoop)),
        B != I) &&
        ((B = I),
        z.text(B),
        callParentWindow('replayTime', {
          state: 'render',
          spent: B,
          duration: w.maxTime,
        }))
    }
    this.createRecordBlock = function (I) {
      var J = 'record' == E ? '#D20A0A' : miniPlayer ? '#2C86FE' : '#36B460',
        K = 'record' == E ? decimal(w.minLoop / w.maxLoop, 2) : 0
      if (
        ($('#reading-block', x).css({ transform: 'scale(' + K + ', 1)' }),
        $($cntRecord).css({ color: J }),
        y.css({ 'background-color': J }),
        true === I)
      ) {
        for (
          var L = '', M = 100 / w.maxLoop, N = 0, N = 0;
          N < w.maxLoop;
          N++
        ) {
          L += "<div class='marker' style='left:" + M * N + "%'></div>"
        }
        for (
          $('#reading-marker').html(L), L = '', N = 0;
          N < w.bonusList.length;
          N++
        ) {
          L +=
            "<div class='marker' style='left:" +
            M * w.bonusList[N].loopIndex +
            '%; width:' +
            M +
            "%'></div>"
        }
        $('#reading-marker-bonus').html(L)
      }
    }
    this.createRecordBlock()
  },
  RenderRAF = function (g) {
    var h,
      j = g || nada,
      k = false
    function l(m) {
      j()
      h = requestAnimationFrame(l)
    }
    this.start = function () {
      k || ((k = true), l())
    }
    this.stop = function () {
      k && ((k = false), cancelAnimationFrame(h))
    }
  },
  Spinner = {
    $bt: null,
    $svg: null,
    xlink: '',
    add: function (g) {
      notnull(g) &&
        ((this['$bt'] = g),
        (this['$svg'] = this['$bt'].find('svg use')),
        0 < this['$svg'].length &&
          ((this.xlink = this['$svg'].attr('xlink:href')),
          this['$svg'].attr('xlink:href', '#ic-loader')),
        this['$bt'].addClass('spin'))
    },
    reset: function () {
      notnull(this['$bt']) && this['$bt'].removeClass('spin')
      notnull(this['$svg']) &&
        0 < this['$svg'].length &&
        this['$svg'].attr('xlink:href', this.xlink)
      this['$bt'] = null
      this['$svg'] = null
      this.xlink = ''
    },
  }
function CustomButton(g) {
  var j = g,
    k = j.find('svg'),
    l = k.find('use'),
    m = l.attr('xlink:href'),
    p = false,
    q = false
  return (
    (j.addSpinner = function () {
      return (
        p ||
          ((p = true), l.attr('xlink:href', '#ic-loader'), k.addClass('spin')),
        j
      )
    }),
    (j.removeSpinner = function () {
      return (
        p && ((p = false), l.attr('xlink:href', m), k.removeClass('spin')), j
      )
    }),
    (j.addTouchAnimation = function () {
      return (
        q && j.removeClass('ontouch').get(0).offsetHeight,
        (q = true),
        j.addClass('ontouch').one(animationEnd, function (r) {
          j.removeClass('ontouch')
          q = false
        }),
        j
      )
    }),
    j
  )
}
function CanvasObj(g) {
  var i,
    j = this
  return (
    (this.id = g),
    (this.div = document.getElementById(g)),
    (this.context = this.div.getContext('2d')),
    (this.saveImage = function () {
      i = j.context.getImageData(0, 0, j.div.width, j.div.height)
    }),
    (this.showImage = function () {
      j.clear(), j.context.putImageData(i, 0, 0)
    }),
    (this.clear = function () {
      j.context.clearRect(0, 0, j.div.width, j.div.height)
    }),
    this
  )
}
var $focused,
  focusList = [],
  focusPos = -1,
  focusHistory = []
function initFocusEvent() {
  killFocusEvent()
  document.addEventListener('keydown', keyDown, false)
  $(document).on(pointerEventType.down, (g) => {
    3 != g.isTrigger && removeFocus(g)
  })
}
function killFocusEvent() {
  document.removeEventListener('keydown', keyDown, false)
  $(document).off(pointerEventType.down, removeFocus)
}
function keyDown(g) {
  var i = g.key.toLowerCase()
  ;(g.shiftKey && 9 == g.keyCode) ||
    (9 == g.keyCode && g.preventDefault(),
    27 == g.keyCode && g.preventDefault(),
    38 == g.keyCode && g.preventDefault(),
    40 == g.keyCode && g.preventDefault(),
    $('input').is(':focus') ||
      (13 == g.keyCode && g.preventDefault(),
      37 == g.keyCode && g.preventDefault(),
      39 == g.keyCode && g.preventDefault()),
    hitKey(i))
}
function nextFocus() {
  var g, h
  focusPos = ++focusPos > focusList.length - 1 ? focusList.length - 1 : focusPos
  'playlist-all' == focusHistory[focusHistory.length - 1] &&
    (h = $scrollbox.find('.boxline .line.focused')).length &&
    0 < (g = h.index()) &&
    ((h = h.height()),
    $scrollbox[0].scroll({
      top: g * h,
      left: 0,
      behavior: 'smooth',
    }))
  addFocus()
}
function prevFocus() {
  var h, i
  focusPos = --focusPos < 0 ? 0 : focusPos
  'playlist-all' == focusHistory[focusHistory.length - 1] &&
    (i = $scrollbox.find('.boxline .line.focused')).length &&
    0 < (h = i.index()) &&
    ((i = i.height()),
    $scrollbox[0].scroll({
      top: h * i - 2 * i,
      left: 0,
      behavior: 'smooth',
    }))
  addFocus()
}
function addFocus() {
  notnull($focused) && ($focused.removeClass('focused'), ($focused = null))
  0 < focusList.length &&
    ($focused = focusList[focusPos].toFocus).addClass('focused')
}
function removeFocus() {
  notnull($focused) &&
    ($focused.removeClass('focused'), ($focused = null), (focusPos = -1))
}
function enterFocus() {
  var h
  notnull($focused) &&
    (notnull(focusList[focusPos].onEnter)
      ? focusList[focusPos].onEnter()
      : ((h = focusList[focusPos].toClick || focusList[focusPos].toFocus),
        null != $['_data'](h, 'events')
          ? h.trigger(pointerEventType.down)
          : h[0].dispatchEvent(new Event(pointerEventType.down))))
}
function deleteFocus() {
  if ('popup-menu-exit' == focusHistory[focusHistory.length - 1]) {
    return false
  }
  notnull($focused) && ($focused.removeClass('focused'), ($focused = null))
  focusList = []
  focusPos = -1
}
function hitKey(g) {
  switch (g) {
    case 'tab':
      $('input').is(':focus') && blurAll(), nextFocus()
      break
    case 'enter':
      if (
        isnull($focused) &&
        'pop-safe-code' == focusHistory[focusHistory.length - 1]
      ) {
        return focusList[10].toFocus.trigger(pointerEventType.down), false
      }
      $('input').hasClass('focused') &&
        $('input').is(':focus') &&
        (blurAll(), nextFocus()),
        enterFocus()
      break
    case 'escape':
      if ($('input').is(':focus')) {
        return blurAll(), false
      }
      if ((notnull($focused) && removeFocus(), pageApp && pause)) {
        return false
      }
      if (boxDialog.isOpen()) {
        return false
      }
      if (pageApp && $lockAll.hasClass('show')) {
        return false
      }
      if ('pop-safe-code' == focusHistory[focusHistory.length - 1]) {
        return boxPopup.close(), false
      }
      if ('popup-news' == focusHistory[focusHistory.length - 1]) {
        return boxPopup.close(), false
      }
      if ('popup-switch' == focusHistory[focusHistory.length - 1]) {
        return boxSwitch.close(), false
      }
      if (boxInfo.isOpen()) {
        return boxInfo.close(), false
      }
      if (boxParam.isOpen()) {
        return boxParam.close(), false
      }
      if (pageApp && boxPopup.isOpen()) {
        return (
          boxPopup['$popup'].hasClass('action') ||
          boxPopup['$popup'].hasClass('action-back')
            ? boxPopup['$icon'].trigger(pointerEventType.down)
            : boxPopup.close(),
          false
        )
      }
      if (pageApp && $mixlist.isOpen()) {
        if ('playlist-line-open' == focusHistory[focusHistory.length - 1]) {
          return (
            $lineOpened
              .trigger(pointerEventType.down)
              .trigger(pointerEventType.up),
            false
          )
        }
        if ('playlist-all' == focusHistory[focusHistory.length - 1]) {
          return closePlaylist(), false
        }
      }
      if ((window.cordova || window.electron) && null == $focused) {
        return (
          removeFocus(),
          boxMenu.isOpen() ? boxMenu.close() : popupMenuExit(),
          false
        )
      }
      break
    case ' ':
      !(pageApp && onGame && loopOn) ||
        $lockAll.hasClass('show') ||
        (void 0 !== boxMenu && boxMenu.isOpen()) ||
        $btClock.trigger(pointerEventType.down)
      break
    case 'arrowright':
      $('input').is(':focus') || nextFocus()
      break
    case 'arrowleft':
      $('input').is(':focus') || prevFocus()
      break
    case 'arrowdown':
      $('input').is(':focus') || nextFocus()
      break
    case 'arrowup':
      $('input').is(':focus') || prevFocus()
      break
    case '1':
      'pop-safe-code' == focusHistory[focusHistory.length - 1] &&
        focusList[0].toFocus.trigger(pointerEventType.down)
      break
    case '2':
      'pop-safe-code' == focusHistory[focusHistory.length - 1] &&
        focusList[1].toFocus.trigger(pointerEventType.down)
      break
    case '3':
      'pop-safe-code' == focusHistory[focusHistory.length - 1] &&
        focusList[2].toFocus.trigger(pointerEventType.down)
      break
    case '4':
      'pop-safe-code' == focusHistory[focusHistory.length - 1] &&
        focusList[3].toFocus.trigger(pointerEventType.down)
      break
    case '5':
      'pop-safe-code' == focusHistory[focusHistory.length - 1] &&
        focusList[4].toFocus.trigger(pointerEventType.down)
      break
    case '6':
      'pop-safe-code' == focusHistory[focusHistory.length - 1] &&
        focusList[5].toFocus.trigger(pointerEventType.down)
      break
    case '7':
      'pop-safe-code' == focusHistory[focusHistory.length - 1] &&
        focusList[6].toFocus.trigger(pointerEventType.down)
      break
    case '8':
      'pop-safe-code' == focusHistory[focusHistory.length - 1] &&
        focusList[7].toFocus.trigger(pointerEventType.down)
      break
    case '9':
      'pop-safe-code' == focusHistory[focusHistory.length - 1] &&
        focusList[8].toFocus.trigger(pointerEventType.down)
      break
    case '0':
      'pop-safe-code' == focusHistory[focusHistory.length - 1] &&
        focusList[9].toFocus.trigger(pointerEventType.down)
      break
    case 'backspace':
      'pop-safe-code' == focusHistory[focusHistory.length - 1] &&
        boxPopup['$popup'].find('.text').text('_ _ _ _')
  }
}
function createFocus(g, h) {
  if (boxMenu && boxMenu.isOpen() && 'popup-menu-exit' != g) {
    return (
      removeInArray('popup-menu-exit', focusHistory),
      focusHistory.push(g),
      focusHistory.push('popup-menu-exit'),
      false
    )
  }
  if (boxDialog && boxDialog.isOpen() && 'popup-dialog' != g) {
    return (
      removeInArray('popup-dialog', focusHistory),
      focusHistory.push(g),
      focusHistory.push('popup-dialog'),
      false
    )
  }
  focusList = []
  focusPos = -1
  'popup-menu-exit' == g &&
    (boxMenu['$popup'].find('.bt:not(.icon)').each(function (v) {
      focusList.push({ toFocus: $(this) })
    }),
    focusList.push({ toFocus: boxMenu['$icon'] }))
  pageApp &&
    'home' == g &&
    ($homeBtNews &&
      0 < $homeBtNews.length &&
      focusList.push({
        toFocus: $homeBtNews.find('.bck'),
        toClick: $homeBtNews,
      }),
    focusList.push({ toFocus: $homeBtInfo }),
    focusList.push({ toFocus: $homeBtParam }),
    $('#home-bt-fs').is(':visible') &&
      focusList.push({ toFocus: $('#home-bt-fs') }),
    focusList.push({ toFocus: $homeBtSwitch }),
    focusList.push({ toFocus: $homeBtPlay }),
    focusList.push({ toFocus: $homeBtList }))
  'popup-news' == g &&
    (focusList.push({ toFocus: boxPopup['$popup'].find('.bt:not(.icon)') }),
    focusList.push({ toFocus: boxPopup['$icon'] }))
  ;('pop-tuto' != g && 'pop-credit' != g && 'pop-follow' != g) ||
    $('#pop-info .box-tab .tab').each(function (v) {
      focusList.push({ toFocus: $(this) })
    })
  'pop-tuto' == g &&
    $('#pop-info #pop-tuto .bt').each(function (v) {
      focusList.push({ toFocus: $(this) })
    })
  'pop-credit' == g &&
    $('#pop-info #pop-credit .bt').each(function (v) {
      focusList.push({ toFocus: $(this) })
    })
  'pop-follow' == g &&
    ($('#pop-info #pop-follow .bt').each(function (v) {
      focusList.push({ toFocus: $(this) })
    }),
    focusList.push({ toFocus: $('#pop-info #pop-follow #img-shop') }))
  ;('pop-language' != g && 'pop-setting' != g) ||
    $('#pop-param .box-tab .tab').each(function (v) {
      focusList.push({ toFocus: $(this) })
    })
  'pop-language' == g &&
    $('#pop-param #pop-language .bt').each(function (v) {
      focusList.push({ toFocus: $(this) })
    })
  'pop-setting' == g &&
    $('#pop-param #pop-setting .bt-onoff, #pop-param #pop-setting .bt').each(
      function (v) {
        focusList.push({ toFocus: $(this) })
      }
    )
  'pop-safe-code' == g &&
    (boxPopup['$popup'].find('.bt:not(.icon)').each(function (v) {
      focusList.push({ toFocus: $(this) })
    }),
    focusList.push({ toFocus: boxPopup['$icon'] }))
  'index-select' == g &&
    ($homeBtNews &&
      0 < $homeBtNews.length &&
      focusList.push({
        toFocus: $homeBtNews.find('.bck'),
        toClick: $homeBtNews,
      }),
    $('#home-bt-fs').is(':visible') &&
      focusList.push({ toFocus: $('#home-bt-fs') }),
    focusList.push({ toFocus: $('#home-bt-info') }),
    focusList.push({ toFocus: $('#home-bt-param') }),
    $('#sp-select .vicon:not(.open)').each(function (v) {
      focusList.push({
        toFocus: $(this).find('.img'),
        onEnter: () => {
          $(this).trigger(pointerEventType.up)
        },
      })
    }))
  'popup-switch' == g &&
    $('#sp-select .vicon:not(.open)').each(function (v) {
      focusList.push({
        toFocus: $(this).find('.img'),
        onEnter: () => {
          $(this).trigger(pointerEventType.up)
        },
      })
    })
  'toolbar' == g &&
    (focusList.push({ toFocus: $btTool }),
    focusList.push({ toFocus: $btClock }))
  'toolbar-open' == g &&
    $('#game #box-bt1 .bt').each(function (v) {
      focusList.push({ toFocus: $(this) })
    })
  'game-paused' == g &&
    ('visible' == $lockPause.css('visibility')
      ? focusList.push({
          toFocus: $btClock,
          toClick: $lockPause,
        })
      : focusList.push({ toFocus: $btClock }))
  'mode-replay' == g &&
    (focusList.push({ toFocus: $btTool }),
    focusList.push({ toFocus: $btClock }),
    focusList.push({ toFocus: $btSave }),
    focusList.push({ toFocus: $btLike }))
  'popup-record-complete' == g &&
    (boxPopup['$popup'].find('.box-bt-haut .bt').each(function (v) {
      focusList.push({ toFocus: $(this) })
    }),
    focusList.push({ toFocus: boxPopup['$icon'] }))
  'popup-save-form' == g &&
    (boxPopup['$popup']
      .find('.formzone .formline:visible input')
      .each(function (v) {
        var w = $(this)
        focusList.push({
          toFocus: w,
          onEnter: function () {
            var x = w.val().length
            w.focus()
            w[0].setSelectionRange(x, x)
          },
        })
      }),
    focusList.push({ toFocus: boxPopup['$popup'].find('.bt-onofftext') }),
    focusList.push({ toFocus: boxPopup['$popup'].find('.bt.valid') }),
    focusList.push({ toFocus: boxPopup['$icon'] }))
  'popup-mix-saved' == g &&
    (boxPopup['$popup'].find('.box-bt-haut .bt').each(function (v) {
      focusList.push({ toFocus: $(this) })
    }),
    focusList.push({ toFocus: boxPopup['$icon'] }))
  'popup-global-share' == g &&
    (boxPopup['$popup'].find('.box-bt-haut .bt').each(function (v) {
      focusList.push({ toFocus: $(this) })
    }),
    focusList.push({ toFocus: boxPopup['$icon'] }))
  'popup-email-form' == g &&
    (boxPopup['$popup'].find('.formzone .formline input').each(function (v) {
      var w = $(this)
      focusList.push({
        toFocus: w,
        onEnter: function () {
          var x = w.val().length
          w.focus()
          w[0].setSelectionRange(x, x)
        },
      })
    }),
    focusList.push({ toFocus: boxPopup['$popup'].find('.bt.valid') }),
    focusList.push({ toFocus: boxPopup['$icon'] }))
  'popup-convert-mix' == g && focusList.push({ toFocus: boxPopup['$icon'] })
  'popup-convert-mix-ready' == g &&
    ((k = boxPopup['$popup'].find('#bt-save-file')),
    focusList.push({
      toFocus: k,
      onEnter: function () {
        k[0].click()
      },
    }),
    focusList.push({ toFocus: boxPopup['$icon'] }))
  'popup-dialog' == g &&
    $('#pop-dialog .bt').each(function (v) {
      focusList.push({ toFocus: $(this) })
    })
  'playlist-all' == g &&
    ($('#mixlist .tabbox .tab').each(function (v) {
      focusList.push({ toFocus: $(this) })
    }),
    (l = $('#mixlist .pagebox.show'))
      .find('.tab-filter:visible')
      .find('.bt')
      .each(function (v) {
        focusList.push({ toFocus: $(this) })
      }),
    'box-search' == l.attr('id') &&
      (focusList.push({
        toFocus: l.find('.formline input'),
        onEnter: function () {
          l.find('.formline input').focus()
        },
      }),
      focusList.push({ toFocus: l.find('.bt.search') })),
    $scrollbox.find('.boxline .line').each(function (v) {
      var w = $(this)
      focusList.push({
        toFocus: w,
        onEnter: function () {
          w.trigger(pointerEventType.down).trigger(pointerEventType.up)
        },
      })
    }))
  'playlist-line-open' == g &&
    $lineOpened &&
    $lineOpened.find('.box-action .bt').each(function (v) {
      focusList.push({ toFocus: $(this) })
    })
  var k,
    l,
    m,
    p = []
  for (m in focusList) isVisible(focusList[m]) && p.push(focusList[m])
  if (
    ((focusList = p),
    g != focusHistory[focusHistory.length - 1] && focusHistory.push(g),
    5 < focusHistory.length && focusHistory.shift(),
    notnull(h))
  ) {
    for (var q = 0, u = focusList.length; q < u; q++) {
      if (focusList[q].toFocus && focusList[q].toFocus[0] === h[0]) {
        focusPos = q
        break
      }
    }
  }
}
function removeInFocusHistory(g) {
  removeInArray(g, focusHistory)
}
function createFocusFromHistory() {
  focusHistory.length && createFocus(focusHistory[focusHistory.length - 1])
}
function isVisible(g) {
  return (
    !!notnull(g) &&
    !!(g = notnull(g.toClick) ? g.toClick : g.toFocus).length &&
    'hidden' != g.css('visibility') &&
    'none' != g.css('display')
  )
}
function initParam() {
  appBrowser && isIOS && $('#home-bt-fs').hide()
  isDarkMode() &&
    ($('body').addClass('darkmode'),
    $('#pop-setting #param-dark .bt-onoff').addClass('active'))
  isSafeMode() &&
    ($('body').addClass('safemode'),
    $('#pop-setting #param-safe .bt-onoff').addClass('active'))
  $('#pop-setting #param-reset .bt')
    .on(pointerEventType.down, clickbtParamReset)
    .parent()
    .find('.ic-info')
    .on(pointerEventType.down, clickbtParamResetInfo)
  $('#pop-setting #param-dark .bt-onoff').on(
    pointerEventType.down,
    clickbtParamDark
  )
  $('#pop-setting #param-safe .bt-onoff')
    .on(pointerEventType.down, clickbtParamSafe)
    .parent()
    .find('.ic-info')
    .on(pointerEventType.down, clickbtParamSafeInfo)
}
function isDarkMode() {
  return (
    null != storage.getItem('param-dark') &&
    'true' == storage.getItem('param-dark')
  )
}
function isSafeMode() {
  return null != storage.getItem('param-safe')
}
function clickbtParamReset(g) {
  g.preventDefault()
  storage.removeItem('popupDragViewed')
  storage.removeItem('popup-bonus-next')
  storage.removeItem('popup-bonus-unlock')
  for (var i = 1; i <= versions.total; i++) {
    storage.removeItem('v' + i + '-popup-bonus-next')
    storage.removeItem('v' + i + '-popup-bonus-unlock')
    storage.removeItem('v' + i + '-bonus-complete')
  }
  pageApp
    ? addTransition($('#fade-all'), 'fadeIn', 'opacity', function () {
        window.location.href =
          void 0 !== appNumberVersion ? '?v=' + appNumberVersion : ''
      })
    : $(g.currentTarget).addClass('disable')
}
function clickbtParamResetInfo(g) {
  g.preventDefault()
  boxDialog.open(STR('pop.paramResetInfoText'), '', [STR('bt.gotit')], [])
}
function unlockAllBonus() {
  for (var h = 1; h <= versions.total; h++) {
    storage.setItem('v' + h + '-popup-bonus-next', 'ok')
    storage.setItem('v' + h + '-popup-bonus-unlock', 'ok')
    storage.setItem('v' + h + '-bonus-complete', '2')
  }
  addTransition($('#fade-all'), 'fadeIn', 'opacity', function () {
    window.location.href =
      void 0 !== appNumberVersion ? '?v=' + appNumberVersion : ''
  })
}
function clickbtParamDark(g) {
  g.preventDefault()
  isDarkMode()
    ? (storage.setItem('param-dark', false),
      $body.removeClass('darkmode'),
      $('#pop-setting #param-dark .bt-onoff').removeClass('active'))
    : (storage.setItem('param-dark', true),
      $body.addClass('darkmode'),
      $('#pop-setting #param-dark .bt-onoff').addClass('active'))
}
var $homeBtNews,
  paramsafecode = ''
function clickbtParamSafe(g) {
  g.preventDefault()
  deleteFocus()
  popupCode()
}
function turnOnSafeMode(g) {
  storage.setItem('param-safe', g)
  $body.addClass('safemode')
  $('#pop-setting #param-safe .bt-onoff').addClass('active')
}
function turnOffSafeMode() {
  storage.removeItem('param-safe')
  $body.removeClass('safemode')
  $('#pop-setting #param-safe .bt-onoff').removeClass('active')
}
function popupCode() {
  boxPopup.open({
    name: 'safe-code',
    icntype: 'action',
    content: function () {
      return (
        "<div class='title'>" +
        (isSafeMode() ? STR('txt.codeEnter') : STR('txt.codeChoose')) +
        "</div>\n\t\t\t\t<div class='text'>_ _ _ _</div>\n\t\t\t\t<div class='content'>\n\t\t\t\t\t<div class='bt bt-round bt-soft bt-number'><div class='bck'><div class='txt'>1</div></div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-round bt-soft bt-number'><div class='bck'><div class='txt'>2</div></div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-round bt-soft bt-number'><div class='bck'><div class='txt'>3</div></div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-round bt-soft bt-number'><div class='bck'><div class='txt'>4</div></div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-round bt-soft bt-number'><div class='bck'><div class='txt'>5</div></div><div class='hitzone'></div></div><br>\n\t\t\t\t\t<div class='bt bt-round bt-soft bt-number'><div class='bck'><div class='txt'>6</div></div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-round bt-soft bt-number'><div class='bck'><div class='txt'>7</div></div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-round bt-soft bt-number'><div class='bck'><div class='txt'>8</div></div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-round bt-soft bt-number'><div class='bck'><div class='txt'>9</div></div><div class='hitzone'></div></div>\n\t\t\t\t\t<div class='bt bt-round bt-soft bt-number'><div class='bck'><div class='txt'>0</div></div><div class='hitzone'></div></div><br>\n\t\t\t\t\t<br>\n\t\t\t\t\t<div class='bt bt-light' id='bt-valid-code'><div class='bck'><div class='txt'>" +
        STR('bt.ok') +
        "</div></div><div class='hitzone'></div></div>\n\t\t\t\t</div>"
      )
    },
    onBoxOpenEnd: function () {
      createFocus('pop-safe-code'),
        isSafeMode(),
        (paramsafecode = ''),
        boxPopup['$icon'].on(pointerEventType.down, boxPopup.close),
        boxPopup['$popup']
          .find('.bt-number')
          .on(pointerEventType.down, function (i) {
            i.preventDefault()
            var i = boxPopup['$popup'].find('.text'),
              j = i.text(),
              k = j.indexOf('_')
            ;-1 < k && i.text(j.replaceAt(k, $(this).text()))
            !isSafeMode() ||
              ('15092009' != (paramsafecode += $(this).text()) &&
                i.text().replace(/ /g, '') != storage.getItem('param-safe')) ||
              (turnOffSafeMode(), boxPopup.close())
            $(this).hasClass('ontouch') &&
              $(this).removeClass('ontouch').get(0).offsetHeight
            $(this)
              .addClass('ontouch')
              .one(animationEnd, function (l) {
                $(l.target).removeClass('ontouch')
              })
          }),
        boxPopup['$popup']
          .find('#bt-valid-code')
          .on(pointerEventType.down, function (i) {
            var j = boxPopup['$popup'].find('.text').text().replace(/ /g, '')
            ;-1 == j.indexOf('_')
              ? isSafeMode()
                ? j == storage.getItem('param-safe')
                  ? (turnOffSafeMode(), boxPopup.close())
                  : boxPopup['$popup']
                      .find('.text')
                      .addClass('shake')
                      .one(animationEnd, function (k) {
                        paramsafecode = ''
                        $(k.target).text('_ _ _ _').removeClass('shake')
                      })
                : (turnOnSafeMode(j.replace(/ /g, '')), boxPopup.close())
              : boxPopup['$popup']
                  .find('.text')
                  .addClass('shake')
                  .one(animationEnd, function (k) {
                    $(k.target).removeClass('shake')
                  })
          })
    },
    onBoxCloseStart: function () {
      removeInFocusHistory('pop-safe-code')
      deleteFocus()
      boxPopup['$icon'].off()
      boxPopup['$popup'].find('.bt').off()
    },
    onCloseComplete: function () {
      createFocusFromHistory()
    },
  })
}
function clickbtParamSafeInfo(g) {
  g.preventDefault()
  boxDialog.open(STR('pop.paramSafeInfoText'), '', [STR('bt.gotit')], [])
}
function clickbtParamRecover(g) {}
function clickbtParamRecoverInfo(g) {}
var hasNews = false
function initNews() {
  !isSafeMode() && hasNetwork && checkNews()
}
function activeBtNews() {
  hasNews &&
    ($homeBtNews = $('#home-bt-news'))
      .on(pointerEventType.down, function (g) {
        g.preventDefault()
        preventAction(popupNews)
      })
      .addClass('animate')
}
function checkNews() {
  var h = getAppData(),
    i = JSON.parse(localStorage.getItem('news')) || {
      id: '',
      lang: '',
    },
    i = {
      id: i.id,
      lang: i.lang,
    }
  h.news = i
  $.ajax({
    type: 'POST',
    url: domainOnline + 'ph3/check-news.php',
    data: h,
    dataType: 'json',
    crossdomain: true,
    success: function (j) {
      null != j.nada && localStorage.removeItem('news')
      null != j.deja && (hasNews = true)
      null != j.news &&
        (localStorage.setItem('news', JSON.stringify(j.news)), (hasNews = true))
    },
    error: function (j) {},
  })
}
var newsImageLoaded = false
function popupNews() {
  var h, i, j
  null != localStorage.getItem('news') &&
    ((h = JSON.parse(localStorage.getItem('news'))),
    (j = (i = null != h.bt)
      ? '<div class="bt bt-light"><div class="bck"><div class="txt">' +
        h.bt +
        '</div></div><div class="hitzone"></div></div>'
      : ''),
    boxPopup.open({
      name: 'popup-news',
      icntype: 'action',
      bodyclose: true,
      class: 'big column',
      content:
        "\n            <div class='left'>\n               <div class='img-box'></div>\n               <div class='icn-box' class='spin'><svg class='icn-svg icn-gray'><use xlink:href='#ic-loader'></use></svg></div>\n            </div>\n            <div class='right'>\n               <div class='title'>" +
        h.title +
        "</div>\n               <div class='text'>" +
        h.text +
        '</div>\n               ' +
        j +
        '\n            </div>',
      onBoxOpenEnd: function () {
        function l() {
          boxPopup['$popup'].find('.icn-box').remove()
          boxPopup['$popup']
            .find('.img-box')
            .css({ 'background-image': 'url(' + h.img + ')' })
            .addClass('fade')
        }
        var m
        createFocus('popup-news')
        newsImageLoaded
          ? l()
          : (((m = new Image()).src = h.img),
            (m.onload = function () {
              newsImageLoaded = true
              l()
            }))
        boxPopup['$icon'].on(pointerEventType.down, boxPopup.close)
        i &&
          boxPopup['$container']
            .find('.bt')
            .on(pointerEventType.down, function (p) {
              p.preventDefault()
              openURL(h.link)
            })
      },
      onBoxCloseStart: function () {
        boxPopup['$icon'].off()
        i && boxPopup['$container'].find('.bt').off()
      },
      onCloseComplete: function () {
        removeInFocusHistory('popup-news')
        createFocusFromHistory()
      },
    }))
}
var isFullScreenable = window.electron && window.electron.vars.isFullScreenable,
  isMinimizable = window.electron && window.electron.vars.isMinimizable
function popupMenuExit() {
  boxMenu.open({
    name: 'menu-exit',
    icntype: 'action',
    content: function () {
      var h = isFullScreen() ? STR('bt.fullscreenOff') : STR('bt.fullscreenOn'),
        i =
          "\n\t\t\t\t<div class='title'>Menu</div>\n\t\t\t\t<div class='content'>"
      return (
        isFullScreenable &&
          (i +=
            '<div class="bt bt-light" id="bt-exit-fullscreen"><div class="bck"><div class="txt">' +
            h +
            '</div></div><div class="hitzone"></div></div>'),
        isMinimizable &&
          (i +=
            '<div class="bt bt-light" id="bt-minimize"><div class="bck"><div class="txt">' +
            STR('bt.minimizeWindow') +
            '</div></div><div class="hitzone"></div></div>'),
        (i =
          (i +=
            '<div class="bt bt-light" id="bt-open-settings"><div class="bck"><div class="txt">' +
            STR('bt.param') +
            '</div></div><div class="hitzone"></div></div>') +
          ('<div class="bt bt-light" id="bt-open-help"><div class="bck"><div class="txt">' +
            STR('bt.tuto') +
            '</div></div><div class="hitzone"></div></div>')),
        (window.cordova || window.electron) &&
          (i +=
            '<div class="bt bt-light" id="bt-exit-app"><div class="bck"><div class="txt">' +
            STR('bt.quitApp') +
            '</div></div><div class="hitzone"></div></div>'),
        (i += '</div>')
      )
    },
    onBoxOpenStart: function () {
      createFocus('popup-menu-exit')
    },
    onBoxOpenEnd: function () {
      isFullScreenable &&
        boxMenu['$popup']
          .find('#bt-exit-fullscreen')
          .on(pointerEventType.down, switchFullscreen)
      isMinimizable &&
        boxMenu['$popup']
          .find('#bt-minimize')
          .on(pointerEventType.down, minimizeWindow)
      ;(window.cordova || window.electron) &&
        boxMenu['$popup']
          .find('#bt-exit-app')
          .on(pointerEventType.down, exitApp)
      boxMenu['$popup']
        .find('#bt-open-help')
        .on(pointerEventType.down, openHelp)
      boxMenu['$popup']
        .find('#bt-open-settings')
        .on(pointerEventType.down, openSettings)
      boxMenu['$icon'].on(pointerEventType.down, boxMenu.close)
    },
    onBoxCloseStart: function () {
      boxMenu['$icon'].off()
      boxMenu['$popup'].find('.bt').off()
    },
    onCloseComplete: function () {
      removeInFocusHistory('popup-menu-exit')
      createFocusFromHistory()
    },
  })
}
function isFullScreen() {
  return window.electron && electron.ipc.isFullScreen()
}
function switchFullscreen(g) {
  notnull(g) && g.preventDefault()
  g = $(g.currentTarget).find('.txt')
  isFullScreen()
    ? (g.text(STR('bt.fullscreenOn')), electron.ipc.leaveFullScreen())
    : (g.text(STR('bt.fullscreenOff')), electron.ipc.enterFullScreen())
}
function minimizeWindow(g) {
  notnull(g) && g.preventDefault()
  electron.ipc.minimize()
  boxMenu.close()
}
function exitApp(g) {
  notnull(g) && g.preventDefault()
  window.electron
    ? electron.ipc.close()
    : window.cordova &&
      boxDialog.open(
        STR('txt.quitAppConfirm'),
        '',
        [STR('bt.yes'), STR('bt.no')],
        [
          () => {
            navigator.app.exitApp()
          },
        ]
      )
  boxMenu.close()
}
function openSettings() {
  boxMenu.close()
  boxInfo.isOpen() && boxInfo.close()
  popupParam()
}
function openHelp() {
  boxMenu.close()
  boxParam.isOpen() && boxParam.close()
  popupInfo()
}
var storage,
  cloud,
  $body,
  $incredibox,
  $bckGlobal,
  $lockAll,
  $lockPause,
  $fadeAll,
  $watchInfo,
  $mixlist,
  $poplist,
  $tabLatest,
  $tabTop50,
  $tabSearch,
  $tabMixlist,
  $home,
  $homeVersion,
  $homeTitre,
  $homeLoadbox,
  $homeLoadbar,
  $homeBtPlay,
  $homeBtList,
  $homeBtSwitch,
  $homeBtInfo,
  $homeBtParam,
  $homeBtFs,
  $homeBck,
  $boxStage,
  $boxVideo,
  $fadeVideo,
  $boxTop,
  $boxBtBonus,
  $boxBottom,
  $boxPicto,
  $boxLoaderPolo,
  $btTool,
  $boxBt,
  $btBack,
  $btHome,
  $btSave,
  $btLike,
  $btHelp,
  $btSwitch,
  $btStop,
  $btRecord,
  $btRandom,
  $btClock,
  $cntRecord,
  boxDialog,
  boxMenu,
  boxPopup,
  boxInfo,
  boxParam,
  boxSwitch,
  pageApp = false
function pageLoadComplete() {
  cloud = new CloudSync()
  storage = new LocalStorage()
  localMixObject = new LocalMixObject()
  checkSystem()
  initAnalytics()
  initLanguage()
  resizeApp()
  localMixObject.saveMixOffline()
  $(document).ready(function () {
    isIframe && appBrowser ? callParentWindow('appIsReady') : documentReady()
  })
}
function documentReady() {
  if (
    (($body = $('body')),
    (boxMenu = new Popup('.box-popup#pop-menu-exit')),
    (boxDialog = new BoxDialog('#pop-dialog')),
    (boxPopup = new Popup('.box-popup#pop-popup')),
    'ok' != checkSupported())
  ) {
    return (
      removeFadeAll(),
      popupGeneralError({
        error: checkSupported(),
        action: 'kill',
      }),
      false
    )
  }
  loadLanguage({
    cbck: function () {
      pageCanRun()
    },
    fail: function () {
      removeFadeAll()
      popupGeneralError({
        error: 'no language found',
        action: 'reload',
      })
    },
  })
}
function pageCanRun() {
  pageApp && initVersions()
  initJqueryVar()
  initRulesCSS()
  initFocusEvent()
  initParam()
  initPopup()
  initNews()
  changeDomTxt()
  ;(pageApp ? pageAppReady : pageIndexReady)()
}
function switchVersion(g) {
  var i = $(this).attr('id').split('icon').join(''),
    j = 'app.' + pageExt + '?v=' + i,
    j =
      (j +=
        null != getParameterByName('lang')
          ? '&l=' + getParameterByName('lang')
          : '') +
      (null != getParameterByName('afs')
        ? '&afs=' + getParameterByName('afs')
        : '')
  featureLocked && 4 < parseInt(i)
    ? dialogGetApp()
    : i != appVersion &&
      (lock(),
      (focusHistory = []),
      deleteFocus(),
      pageApp &&
        $('.box-popup#pop-switch #icon' + appVersion).addClass('close'),
      $(this)
        .addClass('open clicked')
        .one(animationEnd, function () {
          addTransition($fadeAll, 'fadeIn', 'opacity', function () {
            gotoAppUrl(j)
          })
        }))
}
function initJqueryVar() {
  $body = $('body')
  $fadeAll = $('#fade-all')
  $lockAll = $('#lock-all').on(pointerEventType.down, stopProp)
  $bckGlobal = $('#bck-global')
  $homeBtInfo = $('#home-bt-info')
  $homeBtParam = $('#home-bt-param')
  $homeBtFs = $('#home-bt-fs')
  pageApp &&
    (($incredibox = $('#app-incredibox')),
    ($lockPause = $('#lock-pause').on(pointerEventType.down, function (h) {
      h.preventDefault()
      h.pageY - $incredibox[0].getBoundingClientRect().y <
        0.7 * $incredibox[0].getBoundingClientRect().height &&
        preventAction(clickBtClock)
    })),
    (($mixlist = $('#mixlist')).isOpen = function () {
      return $mixlist.hasClass('show')
    }),
    ($tabLatest = $('#tab-latest')),
    ($tabTop50 = $('#tab-top50')),
    ($tabSearch = $('#tab-search')),
    ($tabMixlist = $('#tab-mixlist')),
    ($home = $('#home')),
    ($homeBck = $('#home #img-bck')),
    ($homeVersion = $('#home #img-version')),
    ($homeTitre = $('#home #img-titre')),
    ($homeLoadbox = $('#home #load-box')),
    ($homeLoadbar = $('#home #load-box #load-bar')),
    ($homeBtPlay = new CustomButton($('#home #home-bt-play'))),
    ($homeBtList = new CustomButton($('#home #home-bt-list'))),
    ($homeBtSwitch = $('#home #home-bt-switch')),
    ($boxBt = $('#box-bt')),
    ($btBack = $('#bt-back')),
    (($btTool = $('#bt-tool'))['$bck'] = $('#bt-tool .bck')),
    ($btTool['$svg'] = $btTool['$bck'].find('svg use')),
    ($btTool.bounce = function () {
      this.addClass('animateBounce').one(animationEnd, function (h) {
        $(h.target).removeClass('animateBounce')
      })
    }),
    ($btStop = $('#bt-stop')),
    ($btRandom = $('#bt-random')),
    ($btRecord = $('#bt-record')),
    ($btHome = $('#bt-home')),
    ($btHelp = $('#bt-help')),
    ($btSwitch = $('#bt-switch')),
    ($btClock = $('#bt-clock')),
    ($cntRecord = $('#cnt-record')),
    ($btSave = $('#bt-save')),
    ($btLike = $('#bt-like')),
    ($boxStage = $('#box-stage')),
    ($boxVideo = $('#box-video')),
    ($fadeVideo = $('#fade-video')),
    ($boxTop = $('#box-top')),
    ($boxBtBonus = $('#box-bt-bonus')),
    ($boxBottom = $('#box-bottom')),
    ($boxPicto = $('#box-picto')),
    ($boxLoaderPolo = $('#box-loader-polo')),
    (($watchInfo = $('#watch-info'))['$title'] = $('#watch-info .title')),
    ($watchInfo['$name'] = $('#watch-info .name')),
    ($watchInfo['$dedi'] = $('#watch-info .dedi')),
    ($watchInfo['$date'] = $('#watch-info .date')),
    (boxSwitch = new Popup('.box-popup#pop-switch')),
    $('.box-popup#pop-switch #icon' + appVersion).addClass('open'),
    $('.box-popup#pop-switch .vicon').on(pointerEventType.up, switchVersion))
}
function removeFadeAll() {
  ;($fadeAll = isnull($fadeAll) ? $('#fade-all') : $fadeAll).hasClass(
    'fadeIn'
  ) && $fadeAll.removeClass('fadeIn')
}
function clickAndroidBackButton() {
  pageApp
    ? onGame && loopOn && !pause
      ? stopAllStage()
      : gotoAppUrl('index.html?back=1')
    : exitApp()
}
function pageIndexReady() {
  if (
    (cloud.sync(storage.restoreMixFromDB),
    removeTransition($('#fade-all'), 'fadeIn', 'opacity', function () {
      window.cordova && $('#fade-all').removeClass('white')
    }),
    getParameterByName('skipintro'))
  ) {
    return introComplete(), false
  }
  afterPP()
}
function afterPP() {
  checkRatingModul(function () {
    setTimeout(launchIntro, 2000)
  })
}
function launchIntro() {
  $('#page-splash #sp-title').addClass('titleTweenUp')
  $('#page-splash #sp-baseline').addClass('baselineTweenUp')
  $('#page-splash #sp-experience')
    .html(STR('txt.useHeadphones'))
    .addClass('experienceTweenUp')
  $('#page-splash #sp-headphone').addClass('headphoneTweenUp')
  setTimeout(function () {
    $('#page-splash #sp-title').addClass('titleTweenUpHide')
    $('#page-splash #sp-experience').addClass('experienceTweenUpHide')
    $('#page-splash #sp-choose')
      .html(STR('txt.selectVersion'))
      .addClass('chooseTweenUp')
    $('#page-splash #sp-headphone')
      .addClass('headphoneTweenUpHide')
      .one(animationEnd, introComplete)
  }, 2500)
}
function introComplete() {
  $homeBtInfo.on(pointerEventType.down, popupInfo).addClass('animate')
  $homeBtParam.on(pointerEventType.down, popupParam).addClass('animate')
  $homeBtFs
    .on(pointerEventType.down, function () {
      callParentWindow('openFullscreen')
    })
    .addClass('animate')
  activeBtNews()
  $('#page-splash').addClass('enabled')
  $('#page-splash #sp-select .vicon')
    .addClass('iconTweenUp')
    .on(pointerEventType.up, switchVersion)
  createFocus('index-select')
}
document.addEventListener(
  window.cordova ? 'deviceready' : 'DOMContentLoaded',
  pageLoadComplete,
  false
)
var rateShown = false
function checkRatingModul(g) {
  var j,
    k,
    l = 0,
    m = 'ratemsg'
  function p(q) {
    1 == q
      ? storage.setItem(m, 'false:0')
      : 2 == q
      ? storage.removeItem(m)
      : (storage.removeItem(m),
        openURL(
          isIOS || (window.electron && isOSX)
            ? build.storeRateURL
            : build.storeURL
        ))
    g()
  }
  ;((window.cordova || window.electron) &&
    hasNetwork &&
    !isSafeMode() &&
    'steam' != build.store &&
    (isnull(storage.getItem(m)) && storage.setItem(m, 'true:0'),
    isnull((j = storage.getItem(m))) ||
      ((j = String(j).split(':')),
      (k = Boolean('true' == j[0])),
      (l = Number(j[1])),
      k &&
        (5 <= ++l
          ? ((rateShown = true),
            boxDialog.open(
              STR('pop.rateText'),
              STR('pop.rateTitle'),
              [STR('bt.nope'), STR('bt.later'), STR('bt.sure')],
              [
                function () {
                  p(1)
                },
                function () {
                  p(2)
                },
                function () {
                  p(3)
                },
              ]
            ))
          : storage.setItem(m, 'true:' + String(l)))),
    rateShown)) ||
    g()
}
function reinitRatingModul() {
  storage.setItem('ratemsg', 'true:0')
}
function showPopupPP(g) {
  g()
}
var app,
  clock,
  mainCanvas,
  contextCanvas,
  localMixObject,
  mixlink = getParameterByName('mix'),
  miniPlayer = null != mixlink || '1' == getParameterByName('replay'),
  appNumberVersion =
    miniPlayer && mixlink ? mixlink.slice(-1) : getParameterByName('v'),
  appVersion =
    pageApp &&
    (isnull(appNumberVersion) ||
      isNaN(appNumberVersion) ||
      1 != appNumberVersion.length)
      ? 4
      : appNumberVersion,
  appVersion =
    pageApp &&
    miniPlayer &&
    mixlink &&
    -1 == mixlink.indexOf('-') &&
    13 == mixlink.length
      ? 2
      : appVersion,
  appLoaded = false,
  appViewed = false,
  modeWatch = false,
  isBackToHome = false,
  delayassist = 500,
  onGame = false,
  loopOn = false,
  pause = false
function pageAppReady() {
  if (
    (initRightClick(),
    initSilentMode(),
    listenFocus(),
    initAd(),
    (contextCanvas = $('#cnv-stage')[0].getContext('2d')),
    initAudioContext(),
    initAudioRoute(),
    bugBluetoothLatency())
  ) {
    return false
  }
  $home.addClass('animate')
  $home[0].onanimationend = () => {
    $home.removeClass('animate')
  }
  removeTransition($fadeAll, 'fadeIn', 'opacity', function () {
    ;(miniPlayer ? displayHomeReplay : (initMixlist(), showHome))()
  })
}
var loopDuration,
  nbPoloMax,
  mixToWatchLoaded = false,
  displayHomeReplayWaiting = false
function tryToLoadMix() {
  xhr(
    'GET',
    domainOnline + 'ph3/get-mix-db.php',
    { id: mixlink },
    function (g) {
      mixToWatchLoaded = !(mixToWatch = null)
      'success' == g.state
        ? (mixToWatch = g.mixlist[0])
        : popupGeneralError({
            error: 'load mix',
            action: 'kill',
          })
      displayHomeReplayWaiting && displayHomeReplay()
    },
    function (g) {
      popupGeneralError({
        error: 'mix not found',
        action: 'kill',
      })
      mixToWatchLoaded = true
    }
  )
}
function prepareMixReplay(g) {
  mixToWatchLoaded = true
  mixToWatch = g
}
function displayHomeReplay() {
  mixToWatchLoaded
    ? (mixToWatch.dedi &&
        '' != mixToWatch.dedi &&
        ($('#home #home-dedicated').html(
          STR('txt.dedicatedTo').replace('%{name}', mixToWatch.dedi)
        ),
        $('#home #home-dedicated').addClass('animate')),
      $fadeAll.removeClass('fadeIn'),
      isnull(mixToWatch) || (parseXmlAndCheckAssets(), showHomeLoadbar()))
    : ((displayHomeReplayWaiting = true), isIframe || tryToLoadMix())
}
function showHome() {
  unlock()
  unlockScreenEdges()
  $fadeAll.removeClass('fadeIn')
  $homeTitre.addClass('animate')
  $homeVersion.addClass(g.sIGyX)
  ;(appViewed = miniPlayer && appBrowserSchool ? true : appViewed) ||
    ((appViewed = true),
    (appLoaded ? showBtHome : showHomeLoadbar)(),
    $homeBtSwitch
      .on(pointerEventType.down, function (h) {
        preventAction(popupSwitch)
      })
      .addClass('animate'),
    $homeBtInfo
      .on(pointerEventType.down, function (h) {
        h.preventDefault()
        preventAction(popupInfo)
      })
      .addClass('animate'),
    $homeBtParam
      .on(pointerEventType.down, function (h) {
        h.preventDefault()
        preventAction(popupParam)
      })
      .addClass('animate'),
    $homeBtFs
      .on(pointerEventType.down, function (h) {
        h.preventDefault()
        callParentWindow('openFullscreen')
      })
      .addClass('animate'),
    activeBtNews())
}
function showHomeLoadbar() {
  $homeLoadbox.addClass('animate')
  preparerArray()
}
function hideHomeLoadbar() {
  $homeLoadbox.removeClass('animate')
  miniPlayer
    ? appBrowserSchool
      ? callParentWindow('replayIsReady', {
          func: function () {
            loopOn
              ? clickBtClock()
              : forceUserGesture(function () {
                  clickBtWatch(mixToWatch)
                })
          },
        })
      : showBtPlayListen()
    : showBtHome(true)
}
function showBtPlayListen() {
  $homeBtPlay.on(pointerEventType.down, function () {
    $homeBtPlay.addSpinner()
    forceUserGesture(function () {
      clickBtWatch(mixToWatch)
      callParentWindow('replayStart', mixToWatch)
    })
  })
  $homeBtPlay.addClass('animate')
  var h = 0
  $body.on(pointerEventType.down, function (i) {
    h = window.top.scrollY
  })
  $body.on(pointerEventType.up, function (i) {
    window.top.scrollY == h && loopOn && clickBtClock()
  })
  $lockPause.off()
}
function showBtHome(g) {
  g && createFocus('home')
  $homeBtPlay.addClass('animate')
  $homeBtList.addClass('animate')
  $homeBtPlay.on(pointerEventType.down, function () {
    lock()
    $homeBtPlay.addSpinner()
    forceUserGesture(clickHomeBtPlay)
  })
  $homeBtList.on(pointerEventType.down, function () {
    appBrowser
      ? dialogGetApp()
      : (lock(),
        $homeBtList.addSpinner(),
        forceUserGesture(clickHomeBtPlaylist))
  })
  debugGame && clickHomeBtPlay()
}
function clickHomeBtPlaylist() {
  deleteFocus()
  lock()
  TweenMax.delayedCall(0.5, function () {
    unlock()
    openPlaylist()
  })
}
function clickHomeBtPlay() {
  appBrowserSchool && !miniPlayer && callParentWindow('clickBtPlay')
  deleteFocus()
  addTransition($fadeAll, 'fadeIn', 'opacity', function () {
    callAd('start', 'new-game', hideHome)
  })
}
function hideHome() {
  lock()
  lockScreenEdges()
  detectSilentMode()
  onGame = !(isBackToHome = false)
  $home.hide()
  $incredibox.addClass('show')
  document.body.classList.remove('darkback')
  $homeBtPlay.removeSpinner()
  renderRAF.start()
  modeWatch
    ? (prepareReplayMode(), afficherAllPolo(true))
    : (showDiv($boxBtBonus),
      showDiv($boxPicto),
      showDiv($boxLoaderPolo),
      baisserAllPolo())
  removeTransition($fadeAll, 'fadeIn', 'opacity', lancerApp)
}
function backToHome(g) {
  deleteFocus()
  lock()
  isBackToHome = true
  pictoForceOnDrop()
  addTransition($fadeAll, 'fadeIn', 'opacity', function () {
    hideGame()
    g && g()
  })
}
function hideGame() {
  document.body.classList.add('darkback')
  onGame = false
  stopAllStage()
  renderRAF.stop()
  closeTool()
  checkIfPopupOpen()
  $home.show()
  $incredibox.removeClass('show')
  removeTransition($fadeAll, 'fadeIn', 'opacity', showHome)
  modeWatch
    ? (reinitModeWatch(), createFocusFromHistory())
    : ((focusHistory = []), createFocus('home'))
}
function lancerApp() {
  $fadeAll.removeClass('fadeIn')
  modeWatch
    ? startReplayMode()
    : (unlock(),
      afficherAllPolo(),
      createFocus('toolbar'),
      isnull(storage.getItem('popupDragViewed')) && setTimeout(popupDrag, 600))
  saveGA('game', 'launch')
}
var listPolo,
  listPicto,
  readingBar,
  randomMix,
  recordMix,
  replayMix,
  listBonus = [],
  listPoloDrop = [],
  listPoloToRemove = [],
  listPoloToSolo = [],
  poloAllVisible = false,
  modeRandom = false,
  modeRecord = false,
  modeReplay = false,
  waitForRecording = false,
  mouseX = 0,
  mouseY = 0
function createGame() {
  appLoaded = true
  loopDuration = app.looptime
  nbPoloMax = app.nbpolo
  stepAnimation = frameHalf / loopDuration
  stepPercent = 100 / loopDuration
  tabBuffer.metro[0].snd = audioCtx.createBuffer(
    2,
    globalSampleRate * (app.looptime / 1000),
    globalSampleRate
  )
  ;(sndMetronome = new SoundObject('metronome')).setSilence()
  ;(clock = new ClockObject('cnv-clock')).init(76, 76, 1, 68, 16)
  renderRAF = new RenderRAF(renderLoop)
  mainCanvas = new CanvasObj('cnv-stage')
  miniPlayer
    ? (((recordMix = function () {}).xmlAction = function () {}),
      (randomMix = function () {}))
    : ((randomMix = new RandomMix()), (recordMix = new RecordMix()))
  replayMix = new ReplayMix()
  readingBar = new ReadingBar('#reading-bar', app.recminloop, app.recmaxloop)
  listPolo = createBoxPolo()
  majListPoloDrop()
  listPicto = createBoxPicto()
  createBtBonus()
  listBonus = createBoxBonus()
  document.getElementById('box-stage-bck').style.backgroundImage =
    'url(' + listImages.gameBck.src + ')'
  miniPlayer ||
    document.querySelectorAll('.picto .bck').forEach((h) => {
      h.style.backgroundImage = 'url(' + listImages.gamePicto.src + ')'
    })
  enableBtGame()
  resizeApp()
}
function createBoxPicto() {
  for (var g = [], h = '', j = '', k = 0, k = 0; k < nbSound; k++) {
    var l =
      '<div class="picto" id="picto' +
      k +
      '" data-picto-num="' +
      k +
      '"><div class="bck"></div><div class="hitzone"></div></div>'
    k < 10 ? (h += l) : (j += l)
  }
  for (
    $boxPicto.find('.pictoline.top').html(h),
      $boxPicto.find('.pictoline.bot').html(j),
      k = 0;
    k < nbSound;
    k++
  ) {
    g.push(new PictoObject(k, $boxPicto))
  }
  return g
}
function createBoxPolo() {
  for (var h = [], i = '', j = '', k = 0, k = 0; k < nbPoloMax; k++) {
    i +=
      '\n\t\t\t<div class="polo" data-polo-id="' +
      k +
      '">\n\t\t\t\t<div class="ctrl">\n\t\t\t\t\t<div class="cbt icon-game-bt-mute"><svg class="icn-svg"><use xlink:href="#ic-mute"></use></svg></div>\n\t\t\t\t\t<div class="cbt icon-game-bt-solo"><svg class="icn-svg"><use xlink:href="#ic-solo"></use></svg></div>\n\t\t\t\t\t<div class="cbt icon-game-bt-delete"><svg class="icn-svg"><use xlink:href="#ic-close"></use></svg></div>\n\t\t\t\t</div>\n\t\t\t</div>'
    j +=
      '\n\t\t\t<div class="zone" data-polo-id="' +
      k +
      '">\n\t\t\t\t<div class="loader">\n\t\t\t\t\t<div class="bar"></div>\n\t\t\t\t</div>\n\t\t\t</div>'
  }
  for (
    document.querySelector('#box-polo').innerHTML = i,
      document.querySelector('#box-loader-polo').innerHTML = j,
      k = 0;
    k < nbPoloMax;
    k++
  ) {
    h.push(new PoloObject(k, contextCanvas))
  }
  return h
}
function createBoxBonus() {
  for (var g = [], h = 0; h < nbBonus; h++) {
    for (
      var j = app.bonusarray[h],
        k = j.code.split(','),
        l = $('#bt-bonus-' + (h + 1)),
        m = 0,
        p = k.length;
      m < p;
      m++
    ) {
      var q = app.animearray[k[m] - 1].color
      $('.svg.q' + (m + 1) + ' svg', l).css({ fill: '#' + q })
    }
    tabBuffer.bonus[h].aspire ||
      (tabBuffer.bonus[h].aspire = audioCtx.createBuffer(
        2,
        globalSampleRate * (app.looptime / 1000),
        globalSampleRate
      ))
    j = new BonusObject(h, j, tabBuffer.bonus[h])
    g.push(j)
  }
  return g
}
function createBtBonus() {
  for (var g = '', h = 1; h <= nbBonus; h++) {
    g +=
      '\n\t\t\t<div class="bt-bonus" id="bt-bonus-' +
      h +
      '">\n\t\t\t\t<div class="circle"></div>\n\t\t\t\t<div class="quarter">\n\t\t\t\t\t<div class="svg q0"><svg x="0px" y="0px" width="86px" height="86px" viewBox="0 0 86 86"><path d="M83.88,29.72A42.83,42.83,0,1,0,86,43,43,43,0,0,0,83.88,29.72ZM43,58.64A15.69,15.69,0,0,1,27.36,43,15.64,15.64,0,1,1,52.18,55.64,15.52,15.52,0,0,1,43,58.64Z"/></svg></div>\n\t\t\t\t\t<div class="svg q1"><svg x="0px" y="0px" width="86px" height="86px" viewBox="0 0 86 86"><path d="M57.87,38.17l26-8.45A43,43,0,0,0,43,0V27.36A15.65,15.65,0,0,1,57.87,38.17Z"/></svg></div>\n\t\t\t\t\t<div class="svg q2"><svg x="0px" y="0px" width="86px" height="86px" viewBox="0 0 86 86"><path d="M83.88,29.72l-26,8.45a15.58,15.58,0,0,1-5.69,17.47L68.25,77.75a42.83,42.83,0,0,0,15.63-48Z"/></svg></div>\n\t\t\t\t\t<div class="svg q3"><svg x="0px" y="0px" width="86px" height="86px" viewBox="0 0 86 86"><path d="M52.18,55.64a15.55,15.55,0,0,1-18.36,0L17.75,77.75a42.77,42.77,0,0,0,50.5,0Z"/></svg></div>\n\t\t\t\t\t<div class="svg q4"><svg x="0px" y="0px" width="86px" height="86px" viewBox="0 0 86 86"><path d="M27.36,43a15.71,15.71,0,0,1,.77-4.83l-26-8.45a42.88,42.88,0,0,0,15.64,48L33.82,55.64A15.61,15.61,0,0,1,27.36,43Z"/></svg></div>\n\t\t\t\t\t<div class="svg q5"><svg x="0px" y="0px" width="86px" height="86px" viewBox="0 0 86 86"><path d="M43,27.36V0A43,43,0,0,0,2.11,29.72l26,8.45A15.65,15.65,0,0,1,43,27.36Z"/></svg></div>\n\t\t\t\t</div>\n\t\t\t\t<canvas id="canvas-bt-bonus-' +
      h +
      '" width="86" height="86"></canvas>\n\t\t\t\t<div class="icon">\n\t\t\t\t\t<div class="icn-bck"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="hitzone"></div>\n\t\t\t\t<div class="box-loader">\n\t\t\t\t\t<div class="zone"><div class="loader"><div class="bar"></div></div></div>\n\t\t\t\t</div>\n\t\t\t</div>'
  }
  $boxBtBonus.append(g)
}
var isToolbarOpen = false,
  isToolbarMove = false
function enableBtGame() {
  $btBack.on(pointerEventType.down, function (h) {
    h.preventDefault()
    isToolbarMove || preventAction(clickTool)
  })
  $btStop.on(pointerEventType.down, function (h) {
    h.preventDefault()
    !isToolbarMove && loopOn && preventAction(clickBtStop)
  })
  $btRandom.on(pointerEventType.down, function (h) {
    h.preventDefault()
    isToolbarMove || preventAction(clickBtRandom)
  })
  $btRecord.on(pointerEventType.down, function (h) {
    h.preventDefault()
    isToolbarMove || preventAction(clickBtRecord)
  })
  $btHome.on(pointerEventType.down, function (h) {
    h.preventDefault()
    isToolbarMove || preventAction(clickBtHome)
  })
  $btHelp.on(pointerEventType.down, function (h) {
    h.preventDefault()
    isToolbarMove || preventAction(clickBtHelp)
  })
  $btSwitch.on(pointerEventType.down, function (h) {
    h.preventDefault()
    isToolbarMove || preventAction(clickBtSwitch)
  })
  enableBtTool()
  enablePictoDraggable()
}
function enableBtTool() {
  $btTool.on(pointerEventType.down, function (g) {
    g.preventDefault()
    isToolbarMove || preventAction(clickTool)
  })
}
function clickTool() {
  isToolbarMove = true
  ;(isToolbarOpen ? closeTool : openTool)()
}
function openTool() {
  deleteFocus()
  document.body.addEventListener(pointerEventType.down, clickStage)
  addTransition($boxBt, 'open', 'transform', endToolMove, true)
  isToolbarOpen = true
}
function closeTool() {
  deleteFocus()
  document.body.removeEventListener(pointerEventType.down, clickStage)
  removeTransition($boxBt, 'open', 'transform', endToolMove)
  isToolbarOpen = false
}
function endToolMove() {
  isToolbarMove = false
  onGame && createFocus(isToolbarOpen ? 'toolbar-open' : 'toolbar')
}
function clickStage(g) {
  $boxBt[0].contains(g.target) || clickTool()
}
function clickBtStop() {
  stopAllStage()
}
function clickBtHome() {
  backToHome()
}
function clickBtRandom() {
  startRandomMode()
}
function clickBtRecord() {
  startRecordMode()
}
function clickBtHelp() {
  backToHome(popupInfo)
}
function clickBtSwitch() {
  backToHome(popupSwitch)
}
function baisserAllPolo() {
  if (poloAllVisible) {
    poloAllVisible = false
    for (var g = 0; g < nbPoloMax; g++) {
      listPolo[g].baisser()
    }
  }
}
function afficherAllPolo(g) {
  if (!poloAllVisible) {
    poloAllVisible = true
    for (var h = 0; h < nbPoloMax; h++) {
      listPolo[h].remonte(0.03 * h, false, g)
    }
  }
}
function habillerPolo(g, h, j, k) {
  j = isnull(j) ? 0 : j
  var l = h.id,
    l = tabAnime[l]
  g.habiller(h, cntBoucle, l, j, k)
  loopOn
    ? (g.showLoader(), g.activerClick())
    : waitingFirstLoop ||
      ((waitingFirstLoop = true),
      checkAudioCanRun()
        .then(() => {
          startFirstLoop()
        })
        .catch((m) => {
          rebuildAudioContext()
            .then(() => {
              startFirstLoop()
            })
            .catch(() => {
              stopAllStage()
              popupGeneralError({
                error: 'Audio',
                action: 'reload',
              })
            })
        }))
}
function startFirstLoop() {
  waitingFirstLoop = false
  globalVolumeFadeIn()
  enableClickFirstPolos()
  startLoop()
  waitForRecording && startRecording()
  enableBtClock()
}
function enableClickFirstPolos() {
  for (var g = 0; g < nbPoloMax; g++) {
    var h = listPolo[g]
    h.getBusy() && h.activerClick()
  }
}
function clickPolo(g) {
  bonusPlaying ||
    modeRandom ||
    ((g = g).desactiverClick(),
    getRemainingTime() < delayassist ? listPoloToRemove.push(g) : removePolo(g),
    0 !== (g = getListPoloBusy().length) && g != listPoloToRemove.length) ||
    stopLoop()
}
function mutePolo(g) {
  g.mute()
}
function unmutePolo(g) {
  g.unmute()
}
function soloPolo() {
  for (var g = getListPoloBusy(), h = g.length, i = 0; i < h; i++) {
    var j = g[i]
    j.getSolo() ? j.unmute() : j.mute()
  }
}
function muteAll(g) {
  for (var h = getListPoloBusy(), j = h.length, k = 0; k < j; k++) {
    var l = h[k]
    l.id != g.id ? (l.setSolo(false), l.mute()) : (l.setSolo(true), l.unmute())
  }
}
function unmuteAll() {
  for (var h = getListPoloBusy(), i = h.length, j = 0; j < i; j++) {
    var k = h[j]
    k.setSolo(false)
    listPoloToSolo.push(k)
  }
  getRemainingTime() > delayassist && checkPoloToSolo()
}
function checkPoloToSolo() {
  for (var g = 0, h = listPoloToSolo.length; g < h; g++) {
    listPoloToSolo[g].unmute()
  }
  listPoloToSolo = []
}
function getTotalSolo() {
  for (var g = getListPoloBusy(), h = g.length, i = 0, j = 0; j < h; j++) {
    g[j].getSolo() && i++
  }
  return i
}
function stopSoloPolo() {
  for (var h = getListPoloBusy(), i = h.length, j = 0; j < i; j++) {
    var k = h[j]
    listPoloToSolo.push(k)
  }
  getRemainingTime() > delayassist && checkPoloToSolo()
}
function stopOtherSolo() {
  for (var g = getListPoloBusy(), h = g.length, i = 0; i < h; i++) {
    g[i].setSolo(false)
  }
}
function removePolo(g, h, i) {
  checkerCodeBonus(g.getPicto(), false)
  1 == getTotalSolo() && g.getSolo() && (g.setSolo(false), stopSoloPolo())
  g.deshabiller(h, bonusPlaying)
  g.desactiverClick()
  g.stopSound(i)
  h = getListPoloBusy()
  1 == h.length &&
    (g = h[0]).getSolo() &&
    isMouseDevice &&
    !isTouchDevice &&
    g.setSolo(false)
}
function checkPoloToRemove(g) {
  for (
    var h = listPoloToRemove.length,
      j = bonusPlaying ? 0.01 : 0.03,
      k = 0,
      l = h - 1;
    k < h;
    k++, l--
  ) {
    removePolo(listPoloToRemove[k], l * j, g)
  }
  listPoloToRemove = []
}
function poloStartWatchPicto() {
  for (var h = 0, i = listPoloDrop.length; h < i; h++) {
    'hover' != listPoloDrop[h].state && listPoloDrop[h].mode('regarde')
  }
}
function poloStopWatchPicto() {
  for (var g = 0, h = listPoloDrop.length; g < h; g++) {
    listPoloDrop[g].mode('normal')
  }
}
function checkPictoHoverPolo(g) {
  for (var h = 0, i = listPoloDrop.length; h < i; h++) {
    var j = listPoloDrop[h]
    j.hitTestPicto(g)
      ? (j.rollover(), (j.pictoHoverId = g.id))
      : j.pictoHoverId == g.id && (j.rollout(), (j.pictoHoverId = null))
  }
}
function pictoOnDrop(g, h) {
  var j,
    k = 0,
    h = !!notnull(h) && h,
    l = listPoloDrop.length,
    m = false
  if (!h && !isBackToHome) {
    for (k = 0; k < l; k++) {
      m ||
        ((j = listPoloDrop[k]).hitTestPicto(g) &&
          ((m = true), pictoTouchePolo(j, g)))
    }
  }
  m ? (majListPoloDrop(), listPoloDrop.length) : g.replacer()
}
function pictoTouchePolo(g, h, i, j) {
  h.absorber(g)
  checkerCodeBonus(h, true)
  habillerPolo(g, h, i, j)
  0 < getTotalSolo() && g.mute()
}
function majListPoloDrop() {
  listPoloDrop = []
  for (var g = 0; g < nbPoloMax; g++) {
    var h = listPolo[g]
    h.getBusy() || listPoloDrop.push(h)
  }
}
var btClockClickedAt = 0
function clickBtClock() {
  350 < getTime() - btClockClickedAt &&
    (pauseGame(), (btClockClickedAt = getTime()))
}
function enableBtClock() {
  $btClock
    .off()
    .on(pointerEventType.down, function (g) {
      g.preventDefault()
      preventAction(clickBtClock)
    })
    .addClass('enable')
}
function disableBtClock() {
  $btClock.off().removeClass('enable')
}
var curBonus = null
function clickBtBonus(g) {
  g = decimal(getRemainingTimeBeforeBonus() / 1000, 2)
  g = (g = g - 0.5) < 0.5 ? 0 : g
  curBonus = listBonus[(bonusQueue = g) - 1]
  checkSndAspiration(true)
  ;(g = decimal(getRemainingTimeBeforeBonus() / 1000, 2)),
    (g = (g = g - 0.5) < 0.5 ? 0 : g)
  TweenMax.delayedCall(g, showBlackFadeAtStart)
}
function cancelClickBtBonus() {
  bonusWaiting && stopBonusVideo()
}
function showBlackFadeAtStart() {
  $boxVideo.addClass('visible')
  $fadeVideo[0].offsetHeight
  $fadeVideo.addClass('animateFadeIn')
  modeReplay ||
    modeRandom ||
    miniPlayer ||
    (hideDiv($boxPicto, true), hideDiv($boxLoaderPolo, true))
}
function blackFadeRemoved() {
  $boxVideo.removeClass()
  $fadeVideo.removeClass()
  modeReplay ||
    modeRandom ||
    miniPlayer ||
    ($boxStage.removeClass('pointerlock'),
    showDiv($boxPicto, true),
    showDiv($boxLoaderPolo, true))
}
function videoSlideDown() {
  bottomNeedSlide && !miniPlayer && $body.addClass('bottomSlide')
}
function launchBonusVideo() {
  $boxVideo.addClass('visible')
  $boxStage.addClass('pointerlock')
  $fadeVideo.removeClass()
  pictoForceOnDrop()
  videoSlideDown()
  curBonus.play()
  bonusPlaying = !(bonusWaiting = false)
}
function stopBonusVideo() {
  killTransitionBonus()
  curBonus && curBonus.stop()
  videoFadeOut()
  bonusPlaying = bonusWaiting = false
  cntBoucleBonus = bonusQueue = 0
  curBonus = null
}
function videoFadeOut() {
  $boxVideo.hasClass('visible')
    ? ($fadeVideo.removeClass().addClass('show'),
      $fadeVideo[0].offsetHeight,
      $body.hasClass('bottomSlide')
        ? ($body.removeClass('bottomSlide'),
          $boxVideo.one(transitionEnd, function () {
            $fadeVideo
              .addClass('animateFadeOut')
              .one(animationEnd, blackFadeRemoved)
          }))
        : $fadeVideo
            .addClass('animateFadeOut')
            .one(animationEnd, blackFadeRemoved))
    : blackFadeRemoved()
}
function killTransitionBonus() {
  TweenMax.killTweensOf(showBlackFadeAtStart)
}
function checkerCodeBonus(g, h) {
  for (var i = g.id + 1, j = 0; j < nbBonus; j++) {
    listBonus[j].checkCode(i, h)
  }
}
function checkUnlockNextBonus() {
  var h, i
  modeReplay ||
    modeRandom ||
    ((h = curBonus.getId()),
    (i = 'v' + appVersion + '-bonus-complete'),
    (storage.getItem(i) || 0) <= h &&
      h < nbBonus - 1 &&
      (storage.setItem(i, (i = h + 1)),
      listBonus[i].unlockme(),
      popupBonusFindNext()))
}
function showDiv(g, h, i) {
  h ? addTransition(g, 'fade', 'opacity', i) : g.removeClass('fade')
  g.removeClass('hide')
}
function hideDiv(g, h, i) {
  h ? addTransition(g, 'fade', 'opacity', i) : g.removeClass('fade')
  g.addClass('hide')
}
var timenow,
  timespent,
  renderRAF,
  sndMetronome,
  waitingFirstLoop = false,
  bonusPlaying = false,
  bonusWaiting = false,
  shouldImmediatePlayBonus = false,
  bonusQueue = 0,
  leaveApp = false,
  boucleA = true,
  cntBoucle = 0,
  cntBoucleBonus = 0,
  timeremain = 0,
  pctMetronome = 0,
  pctMetronomeBoucleA = 0,
  frame = 0,
  frameTotal = 0,
  frameHalf = 0,
  framePart2 = 0,
  stepAnimation = 0,
  stepPercent = 0,
  currentSndPart = 0,
  startboucle = 0,
  pausedAt = 0
function loopFinished() {
  checkPoloToRemove()
  checkPoloToSolo()
  modeRandom && randomMix.loop()
  modeReplay &&
    (replayMix.waitForReloop &&
      cntBoucleBonus == curBonus.nbLoop &&
      ((replayMix.waitForReloop = false), (replayMix.reloop = true)),
    readingBar.loop())
  loopOn && startLoop()
  modeRecord && readingBar.loop()
}
function startLoop() {
  bonusPlaying &&
    cntBoucleBonus == curBonus.nbLoop &&
    app.bonusendloopA &&
    !boucleA &&
    (boucleA = true)
  0 == cntBoucle && keepAppAwake()
  startboucle = getTime()
  loopOn = true
  frame = 0
  currentSndPart = boucleA ? (framePart2 = 0) : ((framePart2 = frameHalf), 1)
  clock.start(loopDuration, boucleA)
  sndMetronome.prepare(tabBuffer.metro[0].snd)
  modeReplay && readingBar.isLastLoop()
    ? sndMetronome.onComplete(readingBar.loop)
    : sndMetronome.onComplete(loopFinished)
  ;(bonusWaiting || bonusPlaying) && playBonus()
  bonusPlaying || playSounds()
  checkSndAspiration()
  sndMetronome.play()
  cntBoucle++
  boucleA = !boucleA
}
function checkSndAspiration(g) {
  bonusWaiting &&
    (g
      ? (boucleA || !app.bonusloopA) &&
        600 < getRemainingTime() &&
        curBonus.playAspiration(decimal(getTimeSpent() / 1000, 2))
      : boucleA || curBonus.playAspiration(0))
}
function stopLoop() {
  boucleA = !(loopOn = false)
  currentSndPart = cntBoucle = 0
  clock.stop()
  stopBonusVideo()
  checkPoloToRemove(bonusPlaying)
  sndMetronome.stop()
  disableBtClock()
  modeRecord && stopRecordMode()
  modeReplay && stopReplayMode()
  stopKeepingAppAwake()
}
function playBonus() {
  var g = !app.bonusloopA || boucleA
  ;(g = modeReplay ? !!replayMix.waitForReloop || g : g) &&
    !bonusPlaying &&
    (launchBonusVideo(), hidePoloLoader())
  bonusPlaying &&
    ++cntBoucleBonus > curBonus.nbLoop &&
    (checkUnlockNextBonus(), stopBonusVideo())
}
function playSounds() {
  for (var h = 0; h < nbPoloMax; h++) {
    var i = listPolo[h]
    i.getBusy() &&
      (i.waitOneLoop
        ? (i.showLoader(), (i.waitOneLoop = false))
        : playSoundPolo(i))
  }
}
function playSoundPolo(g) {
  var h = 0 == currentSndPart ? 'sndA' : 'sndB'
  g.sound.prepare(tabBuffer.sound[g.getAssetId()][h])
  g.hideLoader()
  g.getMute() || g.getHide() || g.mode('anime')
  g.playSound()
}
function renderLoop() {
  if (
    ((timenow = getTime()),
    (timespent = getTimeSpent()),
    (timeremain = getTimeRemain()),
    (pctMetronome = timespent * stepPercent),
    (pctMetronomeBoucleA = app.bonusloopA
      ? decimal(
          100 -
            (pctMetronomeBoucleA = getRemainingTime(!boucleA) * stepPercent) /
              2,
          2
        )
      : pctMetronome),
    (frame = Math.floor(timespent * stepAnimation)),
    clock.render(),
    readingBar.render(),
    isnull(curBonus) || (bonusPlaying && curBonus.render()),
    !bonusPlaying)
  ) {
    mainCanvas.clear()
    for (var h = 0; h < nbPoloMax; h++) {
      listPolo[h].draw()
    }
  }
}
function stopAllStage() {
  modeRandom && stopRandomMode()
  pictoForceOnDrop()
  for (var g = getListPoloBusy(), h = 0, i = g.length; h < i; h++) {
    var j = g[h]
    listPoloToRemove.push(j)
  }
  for (h = 0, i = listBonus.length; h < i; h++) {
    listBonus[h].reinit()
  }
  globalVolumeFadeOut(stopLoop)
}
function hidePoloLoader() {
  for (var g = getListPoloBusy(), h = 0, i = g.length; h < i; h++) {
    g[h].hideLoader()
  }
}
var gamePausedByUser = false
function pauseGame() {
  ;(pause
    ? ((gamePausedByUser = false), pauseOff)
    : ((gamePausedByUser = true), pauseOn))()
}
function pauseOn() {
  pause ||
    ((pause = true),
    (pausedAt = getTime()),
    $body.addClass('pause'),
    pauseAudioContext(),
    onGame &&
      (isToolbarOpen && closeTool(),
      loopOn &&
        !froze &&
        (clock.pause(), TweenMax.pauseAll(), curBonus) &&
        curBonus.pause(),
      froze && clearTimeout(controlTimeout),
      renderRAF.stop(),
      pictoForceOnDrop(),
      createFocus('game-paused')))
}
function pauseOff() {
  pause &&
    ((pause = false),
    (startboucle += getTime() - pausedAt),
    $body.removeClass('pause'),
    resumeAudioContext(),
    onGame) &&
    (loopOn &&
      !froze &&
      (clock.resume(), TweenMax.resumeAll(), curBonus) &&
      curBonus.resume(),
    froze && controlTimeoutComplete(),
    renderRAF.start(),
    removeInFocusHistory('game-paused'),
    createFocusFromHistory())
}
function appOnPause() {
  pauseOn()
  leaveApp = true
  lock()
  TweenMax.killTweensOf(appOnResumeComplete)
}
function appOnResume() {
  needToforceUserGesture = !(leaveApp = false)
  TweenMax.killTweensOf(appOnResumeComplete)
  TweenMax.delayedCall(0.25, appOnResumeComplete)
}
function appOnResumeComplete() {
  unlock()
  popupStillHere()
}
function clickPopupStillHere() {
  lock()
  forceUserGesture(function () {
    gamePausedByUser || pauseOff()
    unlock()
  })
}
function pauseAudioContext() {
  globalVolumeFadeOut(() => {
    audioCtx
      .suspend()
      .then(() => {})
      .catch((g) => {})
  })
}
function resumeAudioContext() {
  audioCtx
    .resume()
    .then(() => {
      checkAudioCanRun()
        .then(() => {
          globalVolumeFadeIn()
        })
        .catch((g) => {
          stopAllStage()
        })
    })
    .catch((g) => {
      stopAllStage()
    })
}
var audioCtx,
  froze = false
function frozeScene() {
  pause ||
    froze ||
    ((loopOn = !(froze = true)),
    sndMetronome.stop(),
    immediateKillAllPolo(),
    replayMix.stop(),
    readingBar.froze(),
    renderRAF.stop(),
    clock.stop(true),
    mainCanvas.saveImage(),
    mainCanvas.showImage(),
    notnull(curBonus) &&
      (bonusWaiting
        ? stopBonusVideo()
        : bonusPlaying &&
          (killTransitionBonus(),
          curBonus.sound.stop(),
          curBonus.pause(),
          (bonusPlaying = false))))
}
function unfrozeScene(g) {
  var i, j
  !pause &&
    froze &&
    ((i = curBonus),
    (j = froze = false),
    replayMix.loop(g),
    renderRAF.start(),
    readingBar.unfroze(),
    i &&
      (shouldImmediatePlayBonus
        ? curBonus.getId() != i.getId()
          ? i.stop()
          : (j = true)
        : stopBonusVideo()),
    shouldImmediatePlayBonus
      ? ((shouldImmediatePlayBonus = false),
        (replayMix.waitForReloop = true),
        startLoop(),
        j ||
          ($fadeVideo[0].offsetHeight,
          $fadeVideo.removeClass().addClass('show animateFadeOut')))
      : mainCanvas.showImage())
}
function immediateKillAllPolo() {
  for (var g = getListPoloBusy(), h = 0, i = g.length; h < i; h++) {
    checkerCodeBonus(g[h].getPicto(), false)
    g[h].stopSound()
    g[h].deshabiller(0, true)
    g[h].desactiverClick()
  }
}
function immediatePlayBonus(g, h) {
  bonusWaiting = shouldImmediatePlayBonus = true
  ;(curBonus = listBonus[(bonusQueue = g)]).prepareVideo(h)
  cntBoucleBonus = h - 1
}
function showPoloAndPictoInCombo(g) {
  for (
    var j = getListPoloBusy(),
      k = listBonus[g - 1],
      l = [],
      m = 0,
      p = j.length;
    m < p;
    m++
  ) {
    var q = j[m].getPicto().id
    k.hasCode(q + 1) && l.push(j[m].id)
  }
  showPoloInArray(l)
  showPictoInCombo(g)
}
function showPoloInArray(g) {
  TweenMax.killTweensOf(stopShowPoloInArray)
  var h = getListPoloBusy()
  if (1 < h.length) {
    for (var j = 0, k = h.length; j < k; j++) {
      var l = h[j]
      existInArray(g, l.id)
        ? l.getHide() && l.stopHidingYourself()
        : l.hideYourself()
    }
  }
}
function stopShowingPoloInArray(g) {
  var h = getListPoloHidden(),
    g = g || 0,
    g = decimal((getTime() - g) / 1000, 2)
  TweenMax.delayedCall(g < 1 ? 1 : 0.1, stopShowPoloInArray, [h])
}
function stopShowPoloInArray(g) {
  for (var h = 0, i = g.length; h < i; h++) {
    g[h].stopHidingYourself()
  }
  stopShowPictoInCombo()
}
function showPictoInCombo(g) {
  stopShowPictoInCombo()
  for (
    var h = listBonus[g - 1].getCode(),
      j = h.length,
      k = 0,
      l = listPicto.length;
    k < l;
    k++
  ) {
    for (var m = listPicto[k], p = 0; p < j; p++) {
      existInArray(h, m.id + 1) || m.hideYourself()
    }
  }
}
function stopShowPictoInCombo() {
  for (var g = 0, h = listPicto.length; g < h; g++) {
    listPicto[g].stopHiddingYourself()
  }
}
function getStringDate(g, h) {
  g = -1 == g.indexOf('/') ? g.split('-').join('/') : g
  var j,
    k,
    g = new Date(g)
  return h
    ? ((h = g.getHours()),
      (j = g.getMinutes()),
      (k = g.getSeconds()),
      (h = h < 10 ? String('0' + h) : String(h)),
      (j = j < 10 ? String('0' + j) : String(j)),
      (k = k < 10 ? String('0' + k) : String(k)),
      String(h + ':' + j + ':' + k))
    : ((h = g.getDate()),
      (j = g.getMonth()),
      (k = g.getFullYear()),
      (g = h + ' ' + STR('txt.months')[j] + ' ' + k),
      'zh-cn' != currentLanguage.toLowerCase() &&
      'zh-tw' != currentLanguage.toLowerCase()
        ? g
        : k + ' 年 ' + (j + 1) + ' 月 ' + h + ' 日')
}
function getTimeSpent(g) {
  return loopOn || g ? timenow - startboucle : 0
}
function getTimeRemain() {
  return loopDuration - getTimeSpent()
}
function getRemainingTime(g) {
  return (g = void 0 !== g && g)
    ? 2 * loopDuration - (getTime() - startboucle)
    : loopDuration - (getTime() - startboucle)
}
function getRemainingTimeBeforeBonus() {
  return getRemainingTime(!!app.bonusloopA && !boucleA)
}
function getRandomObject(g) {
  var h = Math.floor(Math.random() * g.length)
  return g.splice(h, 1)[0]
}
function getListPoloBusy() {
  for (var h = [], i = 0; i < nbPoloMax; i++) {
    var j = listPolo[i]
    j.getBusy() && h.push(j)
  }
  return h
}
function getListPoloUnmute() {
  for (var h = [], j = getListPoloBusy(), k = 0, l = j.length; k < l; k++) {
    var m = j[k]
    m.getMute() || h.push(m)
  }
  return h
}
function getListPoloFree() {
  for (var g = [], h = 0; h < nbPoloMax; h++) {
    var i = listPolo[h]
    i.getBusy() || g.push(i)
  }
  return g
}
function getListPictoBusy() {
  for (var h = [], i = 0; i < nbSound; i++) {
    var j = listPicto[i]
    j.used && h.push(j)
  }
  return h
}
function getListPictoFree() {
  for (var g = [], h = 0; h < nbSound; h++) {
    var i = listPicto[h]
    i.used || g.push(i)
  }
  return g
}
function getListPoloHidden() {
  for (var h = [], j = getListPoloBusy(), k = 0, l = j.length; k < l; k++) {
    var m = j[k]
    m.getHide() && h.push(m)
  }
  return h
}
function lock() {
  $lockAll.addClass('show')
  pictoForceOnDrop()
}
function unlock() {
  $lockAll.removeClass('show')
}
var globalGain,
  globalFilter,
  audioPort = '',
  globalSampleRate = 44100,
  globalVolumeMax = 1,
  globalVolumeMin = 0,
  globalFadeSpeed = 0.015
function rebuildAudioContext() {
  return new Promise(function (g, h) {
    killAudioContext()
    initAudioContext()
    audioCtx
      .resume()
      .then(() => {
        g()
      })
      .catch((i) => {
        h(i)
      })
  })
}
function initAudioContext() {
  ;(audioCtx = new AudioContext()).onstatechange = checkStateAudioCtx
  audioCtx.hasOwnProperty('sampleRate')
  audioCtx.hasOwnProperty('baseLatency')
  ;(globalGain = audioCtx.createGain()).connect(audioCtx.destination)
  globalGain.gain.value = globalVolumeMin
}
function killAudioContext() {
  var g, h
  audioCtx &&
    ((g = audioCtx.createBuffer(2, globalSampleRate / 2, globalSampleRate)),
    ((h = audioCtx.createBufferSource()).buffer = g),
    h.connect(audioCtx.destination),
    h.start(0),
    h.disconnect(),
    audioCtx.close(),
    (audioCtx = null))
}
function globalVolumeFadeOut(g) {
  globalGain.gain.cancelScheduledValues(audioCtx.currentTime)
  globalGain.gain.setTargetAtTime(
    globalVolumeMin,
    audioCtx.currentTime,
    globalFadeSpeed
  )
  setTimeout(() => {
    globalGain.gain.value = globalVolumeMin
    g && g()
  }, 6000 * globalFadeSpeed)
}
function globalVolumeFadeIn(g) {
  globalGain.gain.cancelScheduledValues(audioCtx.currentTime)
  globalGain.gain.setTargetAtTime(
    globalVolumeMax,
    audioCtx.currentTime,
    globalFadeSpeed
  )
  setTimeout(() => {
    globalGain.gain.value = globalVolumeMax
    g && g()
  }, 6000 * globalFadeSpeed)
}
function checkStateAudioCtx() {
  audioCtx &&
    'running' != audioCtx.state &&
    onGame &&
    loopOn &&
    !pause &&
    !leaveApp &&
    (appOnPause(), appOnResume())
}
function checkAudioCanRun() {
  return new Promise(function (h, i) {
    var j
    audioCtx && audioCtx.currentTime
      ? ((j = audioCtx.currentTime),
        setTimeout(() => {
          j == audioCtx.currentTime
            ? i(new Error('audioCtx.currentTime is stuck'))
            : h()
        }, 150))
      : i(new Error('audioCtx or audioCtx.currentTime is null'))
  })
}
var needToforceUserGesture = true
function forceUserGesture(g) {
  if (!needToforceUserGesture) {
    return g && g(), false
  }
  needToforceUserGesture = false
  var i,
    j = new SoundObject()
  j.setSilence()
  j.prepare(tabBuffer.sound[0].sndA)
  j.play()
  j.stop()
  listBonus.length
    ? ((i = 0),
      listBonus.forEach(function (k) {
        var m = k.video.currentTime
        k.video
          .play()
          .then(function () {
            k.video.pause()
            k.video.currentTime = m
            ++i == listBonus.length && g && g()
          })
          .catch(function (p) {
            if (h.FcqKq === 'zWehp') {
              throw (
                (popupGeneralError({ error: 'force video play' }), new Error(p))
              )
            } else {
              q &&
                r(s.currentTarget).parent().parent().scrollTop() == g &&
                u.attr('data-key') == v(w.currentTarget).attr('data-key') &&
                x(y.currentTarget)
              z = null
            }
          })
      }))
    : g && g()
}
function initAudioRoute() {}
function initSilentMode() {}
function detectSilentMode() {}
function bugBluetoothLatency() {
  return false
}
var SoundObject = function (g) {
    if ('object' != typeof audioCtx || !audioCtx) {
      throw new Error("Aucun AudioContxt n'a été déclaré")
    }
    var j = this,
      k = null,
      m = null,
      p = null,
      q = 0,
      v = false,
      w = false,
      x = false
    this.getMute = function () {
      return v
    }
    this.getDuration = function () {
      return null != m ? m.duration : 0
    }
    this.getCurrentTime = function () {
      return null != k && null != k.context ? k.context.currentTime : 0
    }
    this.setSilence = function () {
      x = true
    }
    this.setVolume = function (y) {
      p.gain.setValueAtTime(y, audioCtx.currentTime)
    }
    this.onComplete = function (y) {
      k.onended = y
      0
    }
    this.prepare = function (y, z) {
      j.setVolume(y)
      k.connect(p)
      p.connect(globalGain)
      globalGain.connect(audioCtx.destination)
      p = audioCtx.createGain()
      ;(k = audioCtx.createBufferSource()).buffer = m
      y = 0 == z || v || x ? globalVolumeMin : globalVolumeMax
      j.setVolume(y),
        k.connect(p),
        p.connect(globalGain),
        globalGain.connect(audioCtx.destination)
    }
    this.play = function (y, z) {
      w = true
      q =
        (q =
          (q = decimal(y, 3) || 0) > j.getDuration()
            ? decimal(j.getDuration(), 2) - 0.01
            : q) < 0
          ? 0
          : q
      k.start(0, q)
      true !== z || v || x || j.fadeIn()
    }
    this.stop = function (y) {
      y || null == k || !w || x || v ? j.stopSource() : j.fadeOut(true)
    }
    this.stopSource = function () {
      null != k && w && (k.stop(0), (k.onended = null))
      q = 0
      p = k = null
      w = v = false
    }
    this.fadeOut = function (y) {
      p.gain.setTargetAtTime(
        globalVolumeMin,
        audioCtx.currentTime,
        globalFadeSpeed
      )
      y &&
        (k.stop(audioCtx.currentTime + 6 * globalFadeSpeed),
        (k.onended = j.stopSource))
    }
    this.fadeIn = function () {
      p.gain.setTargetAtTime(
        globalVolumeMax,
        audioCtx.currentTime,
        globalFadeSpeed
      )
    }
    this.mute = function () {
      k && !x && j.fadeOut()
      v = true
    }
    this.unmute = function () {
      k && !x && j.fadeIn()
      v = false
    }
  },
  pointerList = []
function enablePictoDraggable() {
  document.body.addEventListener(pointerEventType.down, pictoPointerDown)
  document.body.addEventListener(pointerEventType.up, pictoPointerUp)
  document.body.addEventListener(pointerEventType.cancel, pictoPointerUp)
  document.body.addEventListener(pointerEventType.leave, pictoPointerUp)
  document.body.addEventListener(pointerEventType.move, pictoPointerMove)
}
function pictoPointerDown(g) {
  var i, j, k
  isPictoDiv(g) &&
    ((j = (i = 'targetTouches' in g ? g.targetTouches[0] : g).target.parentNode
      .dataset.pictoNum),
    (k = listPicto[j]).locked ||
      ((mouseX = i.pageX), (mouseY = i.pageY), k.onDrag) ||
      -1 != getIndexFromPointerList('pictoNum', j) ||
      ((g = {
        event: g,
        uniqueId: 'identifier' in i ? i.identifier : i.pointerId,
        picto: k,
        pictoNum: j,
        dropForced: false,
      }),
      k.used
        ? k.usedTouchStart()
        : (k.startDrag(), k.moveDrag(i.pageX, i.pageY), poloStartWatchPicto()),
      pointerList.push(g)))
}
function pictoPointerUp(g) {
  var i
  pointerList.length &&
    0 <=
      (g = getIndexFromPointerList(
        'uniqueId',
        (g = 'changedTouches' in g ? g.changedTouches[0] : g)[
          'identifier' in g ? 'identifier' : 'pointerId'
        ]
      )) &&
    ((i = pointerList[g].picto).used
      ? i.usedTouchEnd()
      : (i.stopDrag(), pictoOnDrop(i, pointerList[g].dropForced)),
    1 == pointerList.length && poloStopWatchPicto(),
    pointerList.splice(g, 1))
}
function pictoForceOnDrop() {
  for (; pointerList.length; ) {
    var g = pointerList[0]
    g.dropForced = true
    pictoPointerUp(g.event)
  }
}
function pictoPointerMove(g) {
  var h
  pointerList.length &&
    0 <=
      (h = getIndexFromPointerList(
        'uniqueId',
        (g = 'targetTouches' in g ? g.targetTouches[0] : g)[
          'identifier' in g ? 'identifier' : 'pointerId'
        ]
      )) &&
    (h = pointerList[h].picto).onDrag &&
    (h.moveDrag(g.pageX, g.pageY),
    checkPictoHoverPolo(h),
    (mouseX = pointerList[pointerList.length - 1].picto.pointerAxis.px),
    (mouseY = pointerList[pointerList.length - 1].picto.pointerAxis.py))
}
function isPictoDiv(g) {
  return (
    g.target.classList.contains('hitzone') &&
    g.target.parentNode.classList.contains('picto')
  )
}
function getIndexFromPointerList(g, h) {
  return pointerList.findIndex((i) => i[g] == h)
}
var $activeTab,
  $activeFilter,
  $activePage,
  $scrollbox,
  $boxline,
  $boxinfo,
  PictoObject = function (g, h) {
    var k,
      l = this,
      m = h.find('#picto' + g),
      p = 0,
      q = isMobile ? 1.1 : 1.2
    this.id = g
    this.used = false
    this.locked = false
    this.onDrag = false
    this.polo = null
    this.pointerAxis = {
      px: 0,
      py: 0,
    }
    this.startDrag = function () {
      k = m[0].getBoundingClientRect()
      l.onDrag = true
      m.removeClass('flashme')
      m.addClass('drag')
    }
    this.moveDrag = function (r, u) {
      l.setTranslation(r, u)
    }
    this.stopDrag = function () {
      l.onDrag = false
      m.removeClass('drag')
    }
    this.replacer = function () {
      l.locked = true
      m.addClass('replacer').one(animationEnd, l.replacerFini)
    }
    this.absorber = function (r) {
      m.css({ transform: 'translate3d(0px, 0px, 0px)' })
      m.removeClass('replacer')
      m.addClass('griser')
      l.used = true
      l.polo = r
    }
    this.reactiver = function (r) {
      m.removeClass('griser')
      l.polo = null
      !r || modeRandom || modeReplay
        ? l.replacerFini()
        : m.addClass('flashme').one(animationEnd, function (u) {
            $(u.target).removeClass('flashme')
            l.replacerFini()
          })
      r = !!notnull(r) && r
      m.removeClass('griser'),
        (l.polo = null),
        !r || modeRandom || modeReplay
          ? l.replacerFini()
          : m.addClass('flashme').one(animationEnd, function (u) {
              $(u.target).removeClass('flashme')
              l.replacerFini()
            })
    }
    this.replacerFini = function () {
      m.removeClass('replacer')
      m.css({ transform: 'translate3d(0px, 0px, 0px)' })
      l.used = false
      l.locked = false
      l.pointerAxis = {
        px: 0,
        py: 0,
      }
    }
    this.usedTouchStart = function () {
      p = getTime()
      showPoloInArray([l.polo.id])
    }
    this.usedTouchEnd = function () {
      stopShowingPoloInArray(p)
      p = 0
    }
    this.checkusedTouchStart = function () {
      0 != p && l.usedTouchEnd()
    }
    this.hideYourself = function () {
      m.addClass('hideYourself')
    }
    this.stopHiddingYourself = function () {
      m.removeClass('hideYourself')
    }
    this.setTranslation = function (r, u) {
      r -= k.width / 2
      u -= k.width / q
      m.css({ transform: 'translate3d(' + r + 'px, ' + u + 'px, 0px)' })
      ;(r -= k.x), (u -= k.y)
      ;(r -= k.width / 2),
        (u -= k.width / q),
        m.css({ transform: 'translate3d(' + r + 'px, ' + u + 'px, 0px)' })
    }
  },
  PoloObject = function (a0, a1) {
    this.sound = new SoundObject('polo' + a0)
    var a3,
      a4,
      a5,
      a6,
      a7,
      a8,
      a9,
      aa,
      ab,
      ac,
      ad,
      ae,
      af,
      ag,
      ah,
      ai,
      aj,
      ak,
      al,
      am,
      an,
      ap,
      aq,
      ar,
      as = this,
      at = $('#box-polo').find(".polo[data-polo-id='" + a0 + "']"),
      au = $('#box-loader-polo').find(".zone[data-polo-id='" + a0 + "']"),
      av = au.find('.loader'),
      aw = au.find('.bar'),
      ax = false,
      ay = a1,
      az = '',
      aA = false,
      aB = listImages.spritePolo,
      aC = aL,
      aF = 0,
      aG = false,
      aH = ((this.id = a0), (this.state = 'normal'), at.find('.ctrl'))
    function aI() {
      ay.globalAlpha = 1
      ay.drawImage(
        aB,
        0,
        0,
        cropPoloW,
        cropPoloH,
        as.drawPoloX,
        as.drawPoloY,
        drawPoloW,
        drawPoloH
      )
    }
    function aJ(b7, b8) {
      ay.drawImage(
        aB,
        b7,
        b8,
        cropEyeW,
        cropEyeH,
        as.drawPoloX,
        as.drawPoloY + drawEyeY,
        drawEyeW,
        drawEyeH
      )
    }
    function aK() {
      ay.globalAlpha = 0.5
      ay.drawImage(
        aB,
        cropPoloW,
        0,
        cropPoloW,
        cropPoloH,
        as.drawPoloX,
        as.drawPoloY,
        drawPoloW,
        drawPoloH
      )
    }
    function aL() {
      aI()
      aJ(cropEyeX, cropEyeY)
      aK()
    }
    function aM() {
      ay.globalAlpha = 1
      ay.drawImage(
        a9,
        0,
        0,
        cropAnimW,
        cropAnimH,
        as.drawPoloX,
        as.drawPoloY,
        drawAnimW,
        drawAnimH
      )
    }
    function aN() {
      aM()
      ay.globalAlpha = 0.7
      ay.drawImage(
        a9,
        2 * cropAnimW,
        0,
        cropAnimW,
        cropAnimH,
        as.drawPoloX,
        as.drawPoloY,
        drawAnimW,
        drawAnimH
      )
    }
    function aO() {
      aM()
      aF = 1
      ay.globalAlpha = aF
      ay.drawImage(
        a9,
        2 * cropAnimW,
        0,
        cropAnimW,
        cropAnimH,
        as.drawPoloX,
        as.drawPoloY,
        drawAnimW,
        drawAnimH
      )
    }
    function aP() {
      aM()
      var b7 = af ? 0.7 : 0
      aF = aF <= b7 ? b7 : decimal(aF - 0.1, 2)
      ay.globalAlpha = aF
      ay.drawImage(
        a9,
        2 * cropAnimW,
        0,
        cropAnimW,
        cropAnimH,
        as.drawPoloX,
        as.drawPoloY,
        drawAnimW,
        drawAnimH
      )
      aF <= b7 && as.stopHidingYourselfComplete()
    }
    function aQ() {
      aa
        ? aL()
        : (as.anime(),
          (ay.globalAlpha = 1),
          ay.drawImage(
            a9,
            cropAnimW,
            0,
            cropAnimW,
            cropAnimH,
            as.drawPoloX,
            as.drawPoloY,
            drawAnimW,
            drawAnimH
          ),
          ay.drawImage(
            a9,
            an,
            ap + 1,
            cropAnimW,
            am - 1,
            as.drawPoloX + ak,
            as.drawPoloY + al + 1,
            drawAnimW,
            aj - 1
          ))
    }
    function aR() {
      var b7 = timenow - aq,
        b7 = Math.floor(b7 * aV),
        b7 = ar - 1 < b7 ? ar - 1 : b7
      aI()
      aJ(cropEyeX, aW[b7] * cropEyeH)
      aK()
      ar - 1 <= b7 && as.mode('normal')
    }
    function aS() {
      var b7, b8
      ae
        ? aQ()
        : (aI(),
          (b8 = as.getPupPos(drawPup1X, drawPup1Y)),
          (b7 = as.getPupPos(drawPup2X, drawPup2Y)),
          ay.drawImage(
            aB,
            0,
            cropPupY,
            cropPupW,
            cropPupW,
            b8[0],
            b8[1],
            drawPupW,
            drawPupW
          ),
          ay.drawImage(
            aB,
            0,
            cropPupY,
            cropPupW,
            cropPupW,
            b7[0],
            b7[1],
            drawPupW,
            drawPupW
          ),
          (b8 = (mouseY - canvasBound.top) * cnvPXD) <
          as.drawPoloY + 90 * poloRatio * cnvPXD
            ? aJ(cropEyelidX, cropEyelid4Y)
            : b8 >= as.drawPoloY + 90 * poloRatio * cnvPXD &&
              b8 < as.drawPoloY + 130 * poloRatio * cnvPXD
            ? aJ(cropEyelidX, cropEyelid3Y)
            : b8 >= as.drawPoloY + 170 * poloRatio * cnvPXD
            ? aJ(cropEyelidX, cropEyelid2Y)
            : aJ(cropEyelidX, cropEyelid1Y))
    }
    function aT() {
      aS()
      aK()
    }
    function aU() {
      aS()
    }
    this['$btcMute'] = at.find('.icon-game-bt-mute')
    this['$btcSolo'] = at.find('.icon-game-bt-solo')
    this['$btcStop'] = at.find('.icon-game-bt-delete')
    this.pictoHoverId = null
    this.reinit = function () {
      aY()
      as.draw()
      aG = false
      as.pictoHoverId = null
      a3 = a4 = a5 = 0
      az = a6 = a7 = a8 = a9 = null
      aa = ab = ac = ad = ae = af = ag = ah = false
    }
    this.getPicto = function () {
      return a6
    }
    this.getAssetId = function () {
      return a7
    }
    this.getMoment = function () {
      return a3
    }
    this.getLoop = function () {
      return a4
    }
    this.getEnabled = function () {
      return ab
    }
    this.getBusy = function () {
      return ac
    }
    this.getHover = function () {
      return aG
    }
    this.getDeleting = function () {
      return ae
    }
    this.getPlaying = function () {
      return ad
    }
    this.getDiv = function () {
      return at
    }
    this.getMute = function () {
      return af
    }
    this.getHide = function () {
      return ah
    }
    this.getSolo = function () {
      return ag
    }
    this.setSolo = function (b7) {
      ;(ag = b7)
        ? as['$btcSolo'].addClass('light')
        : as['$btcSolo'].removeClass('light')
    }
    this.setLoop = function (b7) {
      a4 = b7
    }
    this.setMoment = function (b7) {
      a3 = b7
    }
    this.setPlaying = function (b7) {
      ad = b7
    }
    this.habiller = function (b7, b8, b9, ba, bb) {
      as.checkState()
      a7 = (a6 = b7).id
      a3 = b8
      a8 = b9.imgData
      a9 = b9.imgSprite
      ai = b9.headHeight
      am = b9.headHeight * animSize
      az = b9.color
      a5 = a8.length
      ac = true
      as.resize()
      aw.css({ 'background-color': '#' + az })
      aA
        ? as.mode('waiting')
        : ((aa = true),
          TweenMax.delayedCall(ba, function () {
            as.rebond(bb)
          }))
      recordMix.xmlAction('append', as)
    }
    this.checkState = function () {
      !ae || aA || (TweenMax.killTweensOf(as), as.remonte(0, true, false))
    }
    this.deshabiller = function (b7, b8) {
      aa &&
        ((aa = false),
        TweenMax.killTweensOf(as.rebond),
        TweenMax.killTweensOf(as.rebond2))
      ac = !(ae = true)
      TweenMax.to(as, b8 ? 0 : 0.3, {
        drawPoloY: drawMaxTopY,
        ease: Quint.easeIn,
        onComplete: as.remonte,
        onCompleteParams: [0, true, b8],
        delay: b7,
        overwrite: true,
      })
      this.hideLoader()
      recordMix.xmlAction('remove', as)
    }
    this.baisser = function () {
      as.drawPoloY = drawMaxTopY
    }
    this.remonte = function (b7, b8, b9) {
      ;(aA = true) === b8 &&
        ((b8 = !modeReplay && !modeRandom && !modeWatch),
        a6.reactiver(b8),
        as.reinit(),
        majListPoloDrop())
      as.mode('normal')
      b8 = randomRangeInt(drawMinTopY, drawMinTopY + drawMaxRandPosY)
      TweenMax.to(as, b9 ? 0 : 0.4, {
        drawPoloY: b8,
        ease: Back.easeOut,
        delay: b9 ? 0 : b7,
        overwrite: true,
        onComplete: function () {
          aA = false
        },
      })
    }
    this.rebond = function (b7) {
      var b8 = as.drawPoloY - drawMaxBounceY,
        b9 = ad ? 'anime' : 'waiting',
        ba = b7 ? 0 : 0.1,
        b9 = as.getMute() ? 'mute' : b9
      as.mode(b9)
      TweenMax.to(as, ba, {
        drawPoloY: b8,
        ease: Quint.easeOut,
        onComplete: as.rebond2,
        onCompleteParams: [b7],
        overwrite: true,
      })
      aa = false
    }
    this.rebond2 = function (b7) {
      var b8 = as.drawPoloY + drawMaxBounceY
      TweenMax.to(as, b7 ? 0 : 0.2, {
        drawPoloY: b8,
        ease: Back.easeOut,
        overwrite: true,
      })
    }
    this.showLoader = function () {
      ax = true
      av.addClass('show')
      aw.css({
        'animation-duration': decimal(getRemainingTime() / 1000, 2) + 's',
      })
      aw.addClass('progress')
    }
    this.hideLoader = function () {
      ax && ((ax = false), av.removeClass('show'), aw.removeClass('progress'))
    }
    this.hideYourself = function () {
      ;(ad || ac) && ((ah = true), (aF = af ? 0.7 : aF), as.mode('hide'))
    }
    this.stopHidingYourself = function () {
      ;(ad || ac) && as.mode('unhide')
    }
    this.stopHidingYourselfComplete = function () {
      ah = false
      af ? as.mode('mute') : ad ? as.mode('anime') : as.mode('waiting')
    }
    this.drawPoloX = 0
    this.drawPoloY = drawMaxTopY
    this.resize = function () {
      aj = ai * poloRatio * cnvPXD
      as.drawPoloX = poloBlocX * as.id * cnvPXD
      at[0].style.left =
        poloBlocX * as.id + (sizes.polo.overlapW * poloRatio) / 2 + 'px'
      at[0].style.width = poloBlocW - sizes.polo.overlapW * poloRatio + 'px'
      au[0].style.left =
        poloBlocX * as.id + (sizes.polo.overlapW * poloRatio) / 2 + 'px'
      au[0].style.width = poloBlocW - sizes.polo.overlapW * poloRatio + 'px'
    }
    this.draw = function () {
      aC()
    }
    this.mode = function (b7) {
      if (b7 != as.state) {
        switch ((TweenMax.killTweensOf(aZ), (as.state = b7), as.state)) {
          case 'normal':
            ;(aC = aL), aY()
            break
          case 'cligne':
            aC = aR
            break
          case 'regarde':
            aC = aT
            break
          case 'hover':
            aC = aU
            break
          case 'waiting':
            aC = aM
            break
          case 'anime':
            aC = aQ
            break
          case 'mute':
            aC = aN
            break
          case 'hide':
            aC = aO
            break
          case 'unhide':
            aC = aP
        }
      }
    }
    this.anime = function () {
      var b7 = frame
      boucleA && a5 == frameTotal && (b7 += frameHalf)
      an = a8[(b7 = a5 - 1 <= b7 ? a5 - 1 : b7)][0] * animSize
      ap = a8[b7][1] * animSize
      ak = a8[b7][2] * poloRatio * cnvPXD
      al = a8[b7][3] * poloRatio * cnvPXD
    }
    this.getPupPos = function (b7, b8) {
      var b9 = (mouseX - canvasBound.left) * cnvPXD,
        ba = (mouseY - canvasBound.top) * cnvPXD,
        b9 = b9 - b7 - as.drawPoloX - drawPupW / 2,
        ba = ba - b8 - as.drawPoloY - drawPupW / 2,
        ba = Math.atan2(ba, b9)
      return [
        drawMaxPupMove * Math.cos(ba) + (as.drawPoloX + b7),
        drawMaxPupMove * Math.sin(ba) + (as.drawPoloY + b8),
      ]
    }
    var aV = 0,
      aW = [],
      aX = [
        [0, 1, 2, 2, 1, 0],
        [0, 3, 4, 5, 6, 7, 8, 0],
        [0, 3, 4, 4, 3, 0],
        [
          0, 1, 2, 2, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 10, 10, 10,
          10, 10, 10, 10, 10, 10, 10, 10, 10, 1, 2, 2, 2, 2, 0,
        ],
        [
          0, 1, 2, 2, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 1, 2, 2, 9, 9,
          9, 9, 2, 2, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9,
          0,
        ],
        [
          0, 1, 2, 2, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 2, 2, 2, 10, 10, 10, 10, 10,
          10, 10, 10, 10, 10, 1, 2, 2, 10, 10, 10, 10, 10, 2, 2, 0,
        ],
      ]
    function aY() {
      var b7 = random(7) + 2
      TweenMax.delayedCall(b7, aZ)
    }
    function aZ() {
      aq = getTime()
      var b7 = random(aX.length - 1)
      aW = aX[b7]
      ar = aW.length
      aV = ar / (36 * ar)
      as.mode('cligne')
    }
    var b0 = 0,
      b1 = 0,
      b2 = 0,
      b3 = 0
    function b4(b7) {
      notnull(b7) && b7.preventDefault()
      ag
        ? (1 == getTotalSolo() ? stopSoloPolo() : as.mute(), (ag = false))
        : as.switchMute()
      af || ag || stopOtherSolo()
    }
    function b5(b7) {
      notnull(b7) && b7.preventDefault()
      clickPolo(as)
    }
    function b6(b7) {
      notnull(b7) && b7.preventDefault()
      ;(ag ? ((ag = false), unmuteAll) : ((ag = true), muteAll))(as)
    }
    this.activerClick = function () {
      ab ||
        ((ab = true),
        at[0].addEventListener(pointerEventType.down, as.touchStart),
        as.activerCtrl())
    }
    this.desactiverClick = function () {
      ab &&
        ((ab = false),
        TweenMax.killTweensOf(as.touchLong),
        at[0].removeEventListener(pointerEventType.down, as.touchStart),
        at[0].removeEventListener(pointerEventType.move, as.touchMove),
        at[0].removeEventListener(pointerEventType.up, as.touchEnd),
        as.desactiverCtrl())
    }
    this.touchStart = function (b7) {
      b7.preventDefault()
      0
      var b8 = 'targetTouches' in b7 ? b7.targetTouches[0] : b7
      b0 = b1 = b8.pageX
      b2 = b3 = b8.pageY
      TweenMax.delayedCall(0.25, as.touchLong, [b7])
      at[0].removeEventListener(pointerEventType.down, as.touchStart)
      at[0].addEventListener(pointerEventType.move, as.touchMove)
      at[0].addEventListener(pointerEventType.up, as.touchEnd)
    }
    this.touchMove = function (b7) {
      b7.preventDefault()
      var b8 = 'targetTouches' in b7,
        b7 = b8 ? b7.targetTouches[0] : b7,
        b9 = b8 ? 60 : 20
      b1 = b7.pageX
      b3 = b7.pageY
      b2 + (b8 ? 60 : 20) < b3 &&
        Math.abs(b1 - b0) < b9 &&
        (TweenMax.killTweensOf(as.touchLong), clickPolo(as))
    }
    this.touchLong = function (b7) {
      b7.preventDefault()
      TweenMax.killTweensOf(as.touchLong)
      ag = true
      soloPolo()
      as['$btcSolo'].addClass('light')
    }
    this.touchEnd = function (b7) {
      b7.preventDefault()
      TweenMax.killTweensOf(as.touchLong)
      at[0].removeEventListener(pointerEventType.move, as.touchMove)
      at[0].removeEventListener(pointerEventType.up, as.touchEnd)
      at[0].addEventListener(pointerEventType.down, as.touchStart)
      ag
        ? (1 == getTotalSolo() ? stopSoloPolo() : as.mute(),
          (ag = false),
          as['$btcSolo'].removeClass('light'))
        : as.switchMute()
    }
    this.activerCtrl = function () {
      aH.addClass('visible').on(pointerEventType.down, stopProp)
      as['$btcMute'].on(pointerEventType.down, b4)
      as['$btcSolo'].on(pointerEventType.down, b6)
      as['$btcStop'].on(pointerEventType.down, b5)
    }
    this.desactiverCtrl = function () {
      aH.removeClass('visible').off()
      as['$btcMute'].off().removeClass('light')
      as['$btcSolo'].off().removeClass('light')
      as['$btcStop'].off().removeClass('light')
    }
    this.playSound = function () {
      ad = true
      this.sound.play()
      a4++
    }
    this.stopSound = function (b7) {
      ad = false
      this.sound.stop(b7)
    }
    this.mute = function () {
      af = true
      ah || (as.mode('mute'), as['$btcMute'].addClass('light'))
      as.sound.mute()
      recordMix.xmlAction('mute', as)
    }
    this.unmute = function () {
      af = false
      ah ||
        (ad ? this.mode('anime') : this.mode('waiting'),
        as['$btcMute'].removeClass('light'))
      this.sound.unmute()
      recordMix.xmlAction('unmute', as)
    }
    this.switchMute = function () {
      af ? as.unmute() : as.mute()
    }
    this.hitTest = function (b7, b8) {
      var b7 = (b7 - canvasBound.left) * cnvPXD,
        b8 = (b8 - canvasBound.top) * cnvPXD,
        b9 = (poloOverlapW * cnvPXD) / 2
      return (
        b7 > as.drawPoloX + b9 &&
        b7 < as.drawPoloX + drawPoloW - b9 &&
        b8 > as.drawPoloY &&
        b8 < canvasBound.height * cnvPXD
      )
    }
    this.hitTestPicto = function (b7) {
      return (
        !ac &&
        !ae &&
        as.hitTest(Math.round(b7.pointerAxis.px), Math.round(b7.pointerAxis.py))
      )
    }
    this.rollover = function () {
      aG || ((aG = true), as.mode('hover'))
    }
    this.rollout = function (b7) {
      !!notnull(b7) && b7
        ? ((aG = false), as.mode('normal'))
        : aG && ((aG = false), as.mode('regarde'))
    }
    this.resize()
    this.reinit()
  },
  mixToWatch = null,
  mixToShare = null,
  XHRmemotime = {},
  $lineOpened = null,
  scrollPosY = 0,
  lineClicked = null,
  showLastMix = false,
  mixDB = {
    latest: [],
    search: [],
    top50: {
      day: [],
      week: [],
      month: [],
      year: [],
    },
    totalNbMix: 0,
  }
function initMixlist() {
  $poplist = $mixlist.find('#poplist')
  $mixlist['$bck'] = $mixlist.find('.bac')
  $mixlist['$bck'].fadeIn = function () {
    this.addClass('animateFadeIn')
  }
  $mixlist['$bck'].fadeOut = function () {
    this.addClass('animateFadeOut').one(animationEnd, function (h) {
      $(h.target).removeClass('animateFadeIn animateFadeOut')
    })
  }
  $scrollbox = $poplist.find('#scrollbox')
  $boxinfo = $scrollbox.find('.boxinfo')
  $boxline = $scrollbox.find('.boxline')
  $tabLatest = $('#tab-latest')
  $tabTop50 = $('#tab-top50')
  $tabSearch = $('#tab-search')
  $tabMixlist = $('#tab-mixlist')
  $mixlist.find('.tabbox .tab').on(pointerEventType.down, clickBtTab)
  $mixlist
    .find('.pagebox .tab-filter .bt')
    .on(pointerEventType.down, clickBtFilter)
  $mixlist
    .find('.pagebox#box-search .bt.search')
    .on(pointerEventType.down, clickBtSearch)
}
function openPlaylist(g, h, i) {
  lock()
  showLastMix = true === i
  $mixlist.addClass('show')
  $mixlist['$bck'].fadeIn()
  h
    ? enableMixlist()
    : $poplist.addClass('open').one(animationEnd, enableMixlist)
  'mixlist' == g || !hasNetwork || isSafeMode()
    ? (delete XHRmemotime.mymix, activeBtTab('mixlist'))
    : activeBtTab('top50' == g ? 'top50' : 'latest')
}
function enableMixlist() {
  unlock()
  $homeBtList.removeSpinner()
  $poplist.addClass('opened')
  $mixlist['$bck'].on(pointerEventType.down, closePlaylist)
  $mixlist
    .find('.pagebox#box-search input#input-search')
    .on(pointerEventType.down, function (h) {
      $mixlist
        .find('.pagebox#box-search .formline .input-loader')
        .addClass('spin')
        .show()
    })
  $mixlist
    .find('.pagebox#box-search input#input-search')
    .on('focus', function () {
      $mixlist
        .find('.pagebox#box-search .formline .input-loader')
        .removeClass('spin')
        .hide()
    })
}
function closePlaylist() {
  focusHistory = []
  deleteFocus()
  lock()
  $mixlist['$bck'].off()
  $mixlist['$bck'].fadeOut()
  $mixlist.find('.pagebox#box-search input#input-search').off()
  $poplist
    .removeClass('opened')
    .addClass('close')
    .one(animationEnd, hideMixlist)
}
function hideMixlist() {
  closeActionLine($lineOpened)
  $poplist.removeClass('open close')
  $mixlist.removeClass('show')
  $('.tab', $poplist).removeClass('active')
  $activeFilter = $activePage = $activeTab = null
  blurAll()
  unlock()
  createFocus('home')
}
function cleanScrollbox() {
  $boxline &&
    ($scrollbox.scrollTop(0),
    closeActionLine($lineOpened),
    unbindAllLine(),
    $boxline.empty(),
    $boxinfo.empty())
}
function bindAllLine() {
  $boxline.find('.line').on(pointerEventType.down, clickLineStart)
  $boxline.find('.line').on(pointerEventType.up, clickLineEnd)
  $boxline.find('.box-action').on(pointerEventType.down, stopProp)
  $boxline.find('.box-action').on(pointerEventType.up, stopProp)
  $boxline.find('.bt.watch').on(pointerEventType.down, clickBtWatch)
  $boxline.find('.bt.share').on(pointerEventType.down, clickBtShare)
  $boxline.find('.bt.link').on(pointerEventType.down, clickBtLink)
  $boxline.find('.bt.fav').on(pointerEventType.down, clickBtFav)
  $boxline.find('.bt.delete').on(pointerEventType.down, clickBtDelete)
  $boxline.find('.bt.download').on(pointerEventType.down, clickBtDownload)
}
function unbindAllLine() {
  $boxline.find('.line').off()
  $boxline.find('.line .box-action').off()
  $boxline.find('.line .box-action .bt').off()
}
function unbindLine(g) {
  g.off()
  g.find('.box-action').off()
  g.find('.box-action .bt').off()
}
function clickLineStart(g) {
  var h = $(g.currentTarget).parent().parent()
  scrollPosY = h.scrollTop()
  lineClicked = $(g.currentTarget)
}
function clickLineEnd(g) {
  lineClicked &&
    $(g.currentTarget).parent().parent().scrollTop() == scrollPosY &&
    lineClicked.attr('data-key') == $(g.currentTarget).attr('data-key') &&
    openActionLine(g.currentTarget)
  lineClicked = null
}
function clickBtTab() {
  blurAll()
  $(this).hasClass('active')
    ? $scrollbox.scrollTop(0)
    : activeBtTab($(this).attr('id').replace('tab-', ''))
}
function activeBtTab(g) {
  blurAll()
  $scrollbox.find('.spinner-box').removeClass('spin')
  $scrollbox.find('.spinner-box').hide()
  $boxinfo.empty()
  $poplist.find('.tabbox .tab').removeClass('active')
  ;($activeTab = $poplist.find('.tabbox .tab#tab-' + g)).addClass('active')
  cleanScrollbox()
  $poplist.find('.pagebox').removeClass('show')
  ;($activePage = $poplist.find('.pagebox#box-' + g)).addClass('show')
  'latest' == g
    ? loadLatest()
    : 'top50' == g
    ? activeFilter('day')
    : 'search' == g
    ? (cleanSearchInput(), activeFilter('name'))
    : 'mixlist' == g && activeFilter('mymix')
}
function clickBtFilter() {
  blurAll()
  $(this).hasClass('active')
    ? $scrollbox.scrollTop(0)
    : activeFilter($(this).attr('id').replace('bt-', ''))
}
function activeFilter(g) {
  blurAll()
  $poplist.find('.tab-filter .bt').removeClass('active')
  ;($activeFilter = $poplist.find('.tab-filter .bt#bt-' + g)).addClass('active')
  ;['day', 'week', 'month', 'year'].includes(g)
    ? (cleanScrollbox(), loadTop50())
    : ['name', 'title', 'dedi'].includes(g)
    ? (cleanScrollbox(), clickBtSearch())
    : ['mymix', 'myfav'].includes(g) && (cleanScrollbox(), loadMixlist())
}
function getActiveTabString() {
  return $activeTab && $activeTab.length
    ? $activeTab.attr('id').replace('tab-', '')
    : ''
}
function getActiveFilterString() {
  return $activePage.find('.tab-filter').length &&
    $activeFilter &&
    $activeFilter.length
    ? $activeFilter.attr('id').replace('bt-', '')
    : ''
}
function openActionLine(g) {
  var g = $(g),
    h = null !== $lineOpened ? $lineOpened.index() : -1
  toggleAcionLine($lineOpened)
  h != g.index() && toggleAcionLine(g)
}
function toggleAcionLine(g) {
  null !== g &&
    (g.hasClass('animateOpen')
      ? (g
          .removeClass('animateOpen')
          .addClass('animateClose')
          .one(animationEnd, function () {
            g.removeClass('animateClose')
          }),
        ($lineOpened = null),
        removeInFocusHistory('playlist-line-open'),
        createFocus('playlist-all', g))
      : (g.removeClass('animateClose').addClass('animateOpen'),
        ($lineOpened = g),
        createFocus('playlist-line-open')))
}
function closeActionLine(g) {
  null !== g &&
    (g.removeClass('animateOpen').removeClass('animateClose'),
    ($lineOpened = null))
}
function showSpin(g) {
  g.addClass('spin')
  g.find('svg use').attr('xlink:href', '#ic-loader-mini')
  $scrollbox.find('.spinner-box').addClass('spin')
  $scrollbox.find('.spinner-box').show()
}
function hideSpin(g, h) {
  g.removeClass('spin')
  g.find('svg use').attr('xlink:href', h)
  $scrollbox.find('.spinner-box').removeClass('spin')
  $scrollbox.find('.spinner-box').hide()
}
function clickBtShare(g) {
  g.stopPropagation()
  var g = $(this),
    i = g.parent().parent().attr('data-key').replace('mix-', '')
  notnull((mixToShare = searchMixInCurrentList(i)))
    ? checkIfMixSavedThenShare('global', g)
    : boxDialog.open(
        STR('pop.notFoundText'),
        STR('pop.notFoundTitle'),
        [STR('bt.ok')],
        [
          function () {
            Spinner.reset()
          },
        ]
      )
}
function clickBtLink(g) {
  g.stopPropagation()
  var g = $(this),
    i = g.parent().parent().attr('data-key').replace('mix-', '')
  notnull((mixToShare = searchMixInCurrentList(i)))
    ? checkIfMixSavedThenShare('clipboard', g)
    : boxDialog.open(
        STR('pop.notFoundText'),
        STR('pop.notFoundTitle'),
        [STR('bt.ok')],
        [
          function () {
            Spinner.reset()
          },
        ]
      )
}
function clickBtFav(g) {
  g.stopPropagation()
  var g = $(this).parent().parent(),
    i = g.attr('data-key'),
    j = i.replace('mix-', ''),
    i = i.replace('mix-', 'fav-'),
    j = searchMixInCurrentList(j)
  notnull(j)
    ? isMixInFav(j)
      ? (g.removeClass('isfavoris'),
        localMixObject.deleteMix(i),
        'myfav' == getActiveFilterString() &&
          (unbindLine(g),
          closeActionLine(g),
          g.remove(),
          createFocus('playlist-all')))
      : (g.addClass('isfavoris'),
        localMixObject.saveMix(j, true),
        $tabMixlist.find('svg use').attr('xlink:href', '#ic-rate-mini'),
        $tabMixlist
          .removeClass('animateFavIcon')
          .addClass('animateFavIcon')
          .one(animationEnd, function () {
            $tabMixlist.find('svg use').attr('xlink:href', '#ic-mixlist-mini')
            $tabMixlist.removeClass('animateFavIcon')
          }))
    : popupGeneralError({ error: STR('pop.notFoundTitle') })
}
function clickBtDelete(g) {
  g.stopPropagation()
  var h = $(this),
    i = h.parent().parent(),
    j = searchMixInCurrentList(i.attr('data-key').replace('mix-', ''))
  Spinner.add(h)
  !j.online || hasNetwork
    ? boxDialog.open(
        STR('pop.deleteText'),
        STR('pop.deleteTitle'),
        [STR('bt.yes'), STR('bt.no')],
        [
          function () {
            deleteMixConfirm(h, i, j)
          },
          function () {
            unlock()
            Spinner.reset()
          },
        ]
      )
    : boxDialog.open(
        STR('pop.noNetworkText'),
        STR('pop.noNetworkTitle'),
        [STR('bt.ok')],
        [
          function () {
            unlock()
            Spinner.reset()
          },
        ]
      )
}
function deleteMixConfirm(g, h, i) {
  localMixObject.deleteMix('mix-' + i.link)
    ? (localMixObject.deleteMix('fav-' + i.link),
      unbindLine(h),
      closeActionLine(h),
      h.remove(),
      (h = localMixObject.getMixlist().length) <= 5 && $scrollbox.scrollTop(0),
      0 == h && $boxinfo.html(STR('txt.mixlistEmpty')),
      unlock(),
      createFocus('playlist-all'))
    : boxDialog.open(
        STR('pop.deleteBugText'),
        STR('pop.notFoundTitle'),
        [STR('bt.ok')],
        [
          function () {
            unlock()
          },
        ]
      )
  Spinner.reset()
  i.online &&
    $.ajax({
      type: 'POST',
      url: domainOnline + 'ph3/delete-mix-db.php',
      data: {
        uuid: getListUUID(),
        mix: i,
      },
      dataType: 'json',
      crossdomain: true,
      success: function (k) {
        'success' == k.state
          ? saveGA('mix', 'delete_db', i.link)
          : saveGA('mix', 'delete_db_failed', i.link)
      },
      error: function (k) {
        saveGA('mix', 'delete_db_error', i.link)
      },
    })
}
function clickBtDownload(g) {
  g.stopPropagation()
  var g = $(this),
    i = g.parent().parent().attr('data-key').replace('mix-', '')
  notnull((mixToShare = searchMixInCurrentList(i)))
    ? converterCanRun()
      ? popupConvertMix()
      : checkIfMixSavedThenShare('download', g)
    : boxDialog.open(
        STR('pop.notFoundText'),
        STR('pop.notFoundTitle'),
        [STR('bt.ok')],
        [
          function () {
            Spinner.reset()
          },
        ]
      )
}
var ajaxLatestRunning = false
function loadLatest() {
  if (ajaxLatestRunning) {
    return false
  }
  if (!hasNetwork) {
    return $boxinfo.html(STR('pop.noNetworkText')), false
  }
  if (!minuteMoreThan(1, false, 'latest')) {
    return fillLatest(), false
  }
  ajaxLatestRunning = true
  showSpin($tabLatest)
  var h = { v: app.version }
  $.ajax({
    type: 'GET',
    url: domainOnline + 'ph3/get-live.php?v=' + app.version,
    data: h,
    dataType: 'json',
    crossdomain: true,
    success: function (i) {
      ajaxLatestComplete()
      ;('success' == i.state
        ? ((XHRmemotime.latest = new Date()),
          (mixDB.totalNbMix = i.total),
          (mixDB.latest = i.mixlist),
          mixDB.latest.map(function (j) {
            j.mymix = false
            j.dateQuery = i.created
          }),
          fillLatest)
        : ajaxLatestError)()
    },
    error: function (i) {
      ajaxLatestError()
    },
  })
}
function ajaxLatestComplete() {
  ajaxLatestRunning = false
  hideSpin($tabLatest, '#ic-live-mini')
}
function ajaxLatestError() {
  ajaxLatestComplete()
  $mixlist.isOpen() &&
    $tabLatest.hasClass('active') &&
    boxDialog.open(STR('pop.noCoServerText'), STR('pop.noCoServerTitle'), [
      STR('bt.ok'),
    ])
}
function fillLatest() {
  var h
  $mixlist.isOpen() &&
    $tabLatest.hasClass('active') &&
    ((h = generateHtml(mixDB.latest, generateLineMix, 'latest')),
    $boxline.html(h[0]),
    0 < mixDB.totalNbMix
      ? $boxinfo.html(
          STR('txt.latestMixInfo')
            .replace('%{mix_total}', numberSpaced(mixDB.totalNbMix))
            .replace('%{version_name}', app.name)
        )
      : $boxinfo.html(STR('txt.latestMixInfo').split('<br>')[0]),
    bindAllLine(),
    createFocus('playlist-all'))
}
var ajaxTop50Running = false
function loadTop50() {
  return (
    !ajaxTop50Running &&
    (hasNetwork
      ? mixDB.top50.day.length && !minuteMoreThan(10, false, 'top50')
        ? (fillTop50(), false)
        : ((ajaxTop50Running = true),
          showSpin($tabTop50),
          void $.ajax({
            type: 'GET',
            url: domainOnline + 'ph3/get-top-50.php',
            data: { v: app.version },
            dataType: 'json',
            crossdomain: true,
            success: function (h) {
              'success' == h.state
                ? (ajaxTop50Complete(),
                  (mixDB.top50 = {
                    day: h.listDay,
                    week: h.listWeek,
                    month: h.listMonth,
                    year: h.listYear,
                  }),
                  mixDB.top50.day.map((i) => (i.mymix = false)),
                  mixDB.top50.week.map((i) => (i.mymix = false)),
                  mixDB.top50.month.map((i) => (i.mymix = false)),
                  mixDB.top50.year.map((i) => (i.mymix = false)),
                  fillTop50(),
                  hideSpin($tabTop50, '#ic-trophy-mini'))
                : ajaxTop50Error()
            },
            error: function (h) {
              ajaxTop50Error()
            },
          }))
      : ($boxinfo.html(STR('pop.noNetworkText')), false))
  )
}
function ajaxTop50Complete() {
  ajaxTop50Running = false
  hideSpin($tabTop50, '#ic-trophy-mini')
  XHRmemotime.top50 = new Date()
}
function ajaxTop50Error() {
  ajaxTop50Complete()
  $mixlist.isOpen() &&
    $tabTop50.hasClass('active') &&
    $boxinfo.html(STR('pop.noCoServerText'))
}
function fillTop50() {
  var h, i
  $mixlist.isOpen() &&
    $tabTop50.hasClass('active') &&
    ((i = []),
    'day' == (h = getActiveFilterString())
      ? ((i = generateHtml(mixDB.top50.day, generateLineTop50)),
        $boxline.html(i[0]),
        (mixDB.top50.day = i[1]))
      : 'week' == h
      ? ((i = generateHtml(mixDB.top50.week, generateLineTop50)),
        $boxline.html(i[0]),
        (mixDB.top50.week = i[1]))
      : 'month' == h
      ? ((i = generateHtml(mixDB.top50.month, generateLineTop50)),
        $boxline.html(i[0]),
        (mixDB.top50.month = i[1]))
      : 'year' == h &&
        ((i = generateHtml(mixDB.top50.year, generateLineTop50)),
        $boxline.html(i[0]),
        (mixDB.top50.year = i[1])),
    $boxinfo.html(STR('txt.top50Info')),
    bindAllLine(),
    createFocus('playlist-all'))
}
var ajaxSearchRunning = false,
  lastFilterSearch = '',
  lastSearch = ''
function clickBtSearch() {
  var h, j, k, l, m
  return (
    !ajaxSearchRunning &&
    (hasNetwork
      ? ((h = $poplist.find('form #input-search')),
        (j = getActiveFilterString()),
        (l = (k = cleanInputText((k = h.val().substr(0, 26))))
          .split(' ')
          .join('')),
        (m = regexList.search),
        blurAll(),
        '' == l
          ? ((lastSearch = ''), cleanListSearch())
          : (lastSearch == k.toLowerCase() && lastFilterSearch == j) ||
            (m.test(l)
              ? invalidField(h)
              : ((lastSearch = k.toLowerCase()),
                (lastFilterSearch = j),
                showSpin($tabSearch),
                Spinner.add($poplist.find('#bt-search')),
                loadSearch(k, j))),
        void createFocus('playlist-all'))
      : (boxDialog.open(STR('pop.noNetworkText'), STR('pop.noNetworkTitle'), [
          STR('bt.ok'),
        ]),
        false))
  )
}
function fillSearch() {
  var g
  $tabSearch.hasClass('active') &&
    ((g = generateHtml(mixDB.search, generateLineMix, 'search')),
    $boxline.html(g[0]),
    bindAllLine(),
    createFocus('playlist-all'))
}
function loadSearch(g, h) {
  var j = {
    v: app.version,
    uuid: getListUUID(),
    str: encodeURIComponent(g),
    f: encodeURIComponent(h),
  }
  $('#list-search .spinner-box', $poplist).show()
  ajaxSearchRunning = true
  cleanListSearch()
  $.ajax({
    type: 'GET',
    url: domainOnline + 'ph3/search-mix.php',
    data: j,
    dataType: 'json',
    crossdomain: true,
    success: function (k) {
      var l
      'success' == k.state
        ? (ajaxSearchComplete(),
          (l =
            k.mixlist.length <= 1 && notnull(STR('txt.result.one'))
              ? STR('txt.result.one')
              : STR('txt.result.other')),
          $boxinfo.html(l.replace('%{count}', k.mixlist.length)),
          k.mixlist.length &&
            (k.mixlist.forEach(function (m, n) {
              m.dateQuery = k.now
            }),
            (mixDB.search = k.mixlist),
            fillSearch()))
        : ajaxSearchError()
    },
    error: function (k) {
      ajaxSearchError()
    },
  })
}
function ajaxSearchComplete() {
  ajaxSearchRunning = false
  hideSpin($tabSearch, '#ic-search-mini')
  Spinner.reset()
}
function ajaxSearchError() {
  ajaxSearchComplete()
  $mixlist.isOpen() &&
    $tabSearch.hasClass('active') &&
    boxDialog.open(STR('pop.noCoServerText'), STR('pop.noCoServerTitle'), [
      STR('bt.ok'),
    ])
}
function cleanSearchInput() {
  lastSearch = lastFilterSearch = ''
  $('#box-search #input-search').val('')
}
function cleanListSearch() {
  cleanScrollbox()
  mixDB.search = []
}
function loadMixlist() {
  localMixObject.getMixlist().length || localMixObject.getFavlist().length
    ? fillMixlist()
    : $boxinfo.html(STR('txt.mixlistEmpty'))
}
function fillMixlist() {
  var h, i, j, k
  $mixlist.isOpen() &&
    $tabMixlist.hasClass('active') &&
    ((j = []),
    'mymix' == (h = getActiveFilterString())
      ? (k = localMixObject.getMixlist()).length &&
        ((j = generateHtml(k, generateLineMix, 'mymix')),
        $boxline.html(j[0]),
        hasNetwork
          ? $boxinfo.html(STR('txt.mixlistInfo').replace('%{date_time}', 2))
          : $boxinfo.html(STR('txt.mixlistNoCo')),
        minuteMoreThan(2, false, 'mymix') && localMixObject.getStatMixOnline(),
        showLastMix) &&
        ((showLastMix = false),
        (i = $boxline.find('.line').first())
          .addClass('bckFlash')
          .one(animationEnd, function () {
            i.removeClass('bckFlash')
          }))
      : 'myfav' == h &&
        (k = localMixObject.getFavlist()).length &&
        ((j = generateHtml(k, generateLineMix, 'myfav')),
        $boxline.html(j[0]),
        $boxinfo.empty(),
        minuteMoreThan(2, false, 'myfav')) &&
        localMixObject.getStatFavOnline(),
    bindAllLine(),
    createFocus('playlist-all'))
}
function generateHtml(g, h, j) {
  for (var k = '', l = [], m = 0, p = g.length; m < p; m++) {
    var q = g[m]
    l.push(q)
    k += h(q, m, j)
  }
  return [k, l]
}
function generateLineTop50(g, h) {
  return generateLineMix(g, h, 'top50')
}
function generateLineMix(g, h, j) {
  var g = g || {},
    h = h + 1 || 0,
    j = j || '',
    q = 'top50' === j,
    w = 'top50' === j || 'latest' === j || 'search' === j,
    x = 'latest' === j || 'search' === j,
    y = 'mymix' === j && !g.online,
    z = '1' == g.private,
    A = 'mymix' === j,
    B = 'mymix' === j,
    C = trustAppMobile,
    D = ('mymix' === j || 'search' === j) && isMixInTop50(g),
    E = ('mymix' === j || 'search' === j) && isMixInLatest(g),
    j = 'myfav' === j || isMixInFav(g),
    F = sameMixInLocal(g),
    G = notnull(g.datedb) ? g.datedb : getDateNow(),
    H = 'line',
    H =
      "<div data-key='mix-" +
      g.link +
      "' class='" +
      (H +
        (y ? ' isoffline' : '') +
        (z ? ' isprivate' : '') +
        (j ? ' isfavoris' : '') +
        (F ? ' ismymix' : '') +
        (D ? ' istop50' : '') +
        (E ? ' islatest' : '')) +
      "'>"
  return (
    (H += "<div class='mixbanner box-info" + (q ? ' rating' : '') + "'>") +
    (q ? "<div class='rating'>" + h + '</div>' : '') +
    "<div class='info'>" +
    ("<span class='title'>" + g.title + '</span>') +
    "<div class='dj'>" +
    (w
      ? "<div class='box-flag'><div class='fflag fflag-" +
        g.country.toUpperCase() +
        "'></div></div>"
      : '') +
    ("<span class='name'>" + g.name + '</span>') +
    '</div>' +
    '</div>' +
    "<div class='data'>" +
    "<div class='stat'>" +
    "<div class='boxstat mymix'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-user-mini'></use></svg></div></div>" +
    "<div class='boxstat private'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-lock-mini'></use></svg></div></div>" +
    "<div class='boxstat myfav'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-rate-mini'></use></svg></div></div>" +
    "<div class='boxstat top50'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-trophy-mini'></use></svg></div></div>" +
    "<div class='boxstat latest'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-live-mini'></use></svg></div></div>" +
    ("<div class='boxstat offline'><div class='txt'>" +
      STR('txt.offline') +
      "</div><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-nocloud-mini'></use></svg></div></div>") +
    ("<div class='boxstat liked'><div class='txt'>" +
      numberSpaced(g.nblike) +
      "</div><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-like-mini'></use></svg></div></div>") +
    ("<div class='boxstat viewed'><div class='txt'>" +
      numberSpaced(g.nbview) +
      "</div><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-view-mini'></use></svg></div></div>") +
    '</div>' +
    ("<span class='date' data-date='" +
      G +
      "'>" +
      (x ? getTimeAgo(G, g.dateQuery) : getStringDate(G)) +
      '</span>') +
    '</div>' +
    '</div>' +
    "<div class='box-action'>" +
    "<div class='bt bt-round bt-big watch color-green'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-eye'></use></svg></div><div class='hitzone'></div></div>" +
    "<div class='bt bt-round bt-big share color-blue'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-share'></use></svg></div><div class='hitzone'></div></div>" +
    (C
      ? "<div class='bt bt-round bt-big link color'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-link'></use></svg></div><div class='hitzone'></div></div>"
      : '') +
    "<div class='bt bt-round bt-big fav'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-rate'></use></svg></div><div class='hitzone'></div></div>" +
    (B
      ? "<div class='bt bt-round bt-big download'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-download'></use></svg></div><div class='hitzone'></div></div>"
      : '') +
    (A
      ? "<div class='bt bt-round bt-big delete'><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-trash'></use></svg></div><div class='hitzone'></div></div>"
      : '') +
    '</div>' +
    '</div>'
  )
}
function sameMixInLocal(g) {
  return checkMixInArray(g.id, localMixObject.getMixlist())
}
function isMixInFav(g) {
  return existInArrayFromProp(g.link, 'link', localMixObject.getFavlist())
}
function isMixInTop50(g) {
  return !(
    (g.mymix && !g.online) ||
    !(
      checkMixInArray(g.id, mixDB.top50.day) ||
      checkMixInArray(g.id, mixDB.top50.week) ||
      checkMixInArray(g.id, mixDB.top50.month) ||
      checkMixInArray(g.id, mixDB.top50.year)
    )
  )
}
function isMixInLatest(g) {
  return !(g.mymix && !g.online) && checkMixInArray(g.id, mixDB.latest)
}
function checkMixInArray(g, h, i) {
  for (var k in ((i = i || 'id'), h))
    if (g == h[k][i]) {
      return true
    }
  return false
}
function getMixInArray(g, h, i) {
  for (var j in ((i = i || 'id'), h))
    if (g == h[j][i]) {
      return h[j]
    }
}
function searchMixInCurrentList(g) {
  var j,
    k = getActiveTabString(),
    l = getActiveFilterString(),
    m = g.replace('mix-', '')
  switch (k) {
    case 'latest':
      j = getMixInArray(m, mixDB.latest, 'link')
      break
    case 'top50':
      switch (l) {
        case 'day':
          j = getMixInArray(m, mixDB.top50.day, 'link')
          break
        case 'week':
          j = getMixInArray(m, mixDB.top50.week, 'link')
          break
        case 'month':
          j = getMixInArray(m, mixDB.top50.month, 'link')
          break
        case 'year':
          j = getMixInArray(m, mixDB.top50.year, 'link')
      }
      break
    case 'mixlist':
      switch (l) {
        case 'mymix':
          j = getMixInArray(m, localMixObject.getMixlist(), 'link')
          break
        case 'myfav':
          j = getMixInArray(m, localMixObject.getFavlist(), 'link')
      }
      break
    case 'search':
      j = getMixInArray(m, mixDB.search, 'link')
  }
  return j
}
function minuteMoreThan(g, h, i) {
  var j
  return isnull(XHRmemotime[i])
    ? !h || g
    : ((g = 60 * g),
      (j = new Date()),
      (i = XHRmemotime[i].getTime() - j.getTime()),
      (j = Math.round(Math.abs(i / 1000))),
      true === h ? secToText(1000 * (g - j)) : g <= j)
}
function startRandomMode() {
  modeRandom = true
  $body.addClass('mode-random')
  lock()
  closeTool()
  hideDiv($boxBtBonus)
  hideDiv($boxPicto, true)
  hideDiv($boxLoaderPolo, true)
  $btTool.off().on(pointerEventType.down, function (g) {
    g.preventDefault()
    preventAction(stopRandomMode)
  })
  $btTool.bounce()
  $btTool['$svg'].attr('xlink:href', '#ic-random')
  $bckGlobal.addClass('fadeIn')
  $boxStage.addClass('pointerlock')
  TweenMax.delayedCall(0.4, lancerRandomMode)
}
function showTextRandom() {
  $watchInfo['$title'].html(STR('txt.randomTitle'))
  $watchInfo['$name'].html(STR('txt.randomText'))
  $watchInfo.addClass('fadeIn')
}
function lancerRandomMode() {
  showTextRandom()
  randomMix.start(loopOn)
  unlock()
  saveGA('game', 'random')
}
function stopRandomMode() {
  modeRandom = false
  $body.removeClass('mode-random')
  randomMix.stop()
  $btTool.off()
  $btTool.bounce()
  enableBtTool()
  $bckGlobal.removeClass('fadeIn')
  $btTool['$svg'].attr('xlink:href', '#ic-burger')
  $watchInfo.removeClass('fadeIn')
  TweenMax.delayedCall(0.4, afterStopRandom)
}
function afterStopRandom() {
  showDiv($boxBtBonus, true)
  bonusPlaying || (showDiv($boxPicto, true), showDiv($boxLoaderPolo, true))
  $boxStage.removeClass('pointerlock')
}
var RandomMix = function (h) {
  var j = this
  this.start = function () {
    j.loop()
    j.checkIfPoloMuted()
  }
  this.stop = function () {}
  this.checkIfPoloMuted = function () {
    for (var k = getListPoloBusy(), l = 0, m = k.length; l < m; l++) {
      var p = k[l]
      p.getMute() && p.unmute()
    }
  }
  this.loop = function () {
    var k = getListPoloFree(),
      q = getListPoloBusy(),
      w = getListPictoFree(),
      x = k.length,
      y = q.length,
      z = 0,
      A = random(6),
      B = random(5),
      C = random(2),
      D = random(5) < 4 ? 2 : 1,
      E = false,
      F = 0,
      G = 'ajouter',
      G = A < C ? 'rien' : G
    if (
      ((G = A < B || 0 === x ? 'enlever' : G),
      (G = !loopOn || y <= 1 ? 'ajouter' : G),
      (D = !loopOn || y <= 1 ? 1 : D),
      (G = h ? 'ajouter' : G),
      (G = h && 0 === x ? 'rien' : G),
      bonusPlaying || bonusWaiting)
    ) {
      G = 'bonus'
      cntBoucleBonus == curBonus.nbLoop && ((E = true), (G = 'enlever'))
    } else {
      for (z = 0; z < nbBonus; z++) {
        var H = listBonus[z]
        if (H.found) {
          G = 'bonus'
          H.launchVideo()
          break
        }
      }
    }
    if ('ajouter' == G) {
      for (
        var I, F = Math.round((random(x - 1) + 1) / D), J = [], z = 0;
        z < F;
        z++
      ) {
        I = getRandomObject(k)
        J.push(I.id)
      }
      for (J.sort(), z = 0; z < F; z++) {
        pictoTouchePolo((I = listPolo[J[z]]), getRandomObject(w), 0.03 * z)
        majListPoloDrop()
      }
    } else {
      if ('enlever' == G) {
        for (
          F = Math.round((random(y - 2) + 1) / D),
            F = E && 4 < y - F ? y - 4 : F,
            z = 0;
          z < F;
          z++
        ) {
          ;(2 < (I = getRandomObject(q)).getLoop() || E) && removePolo(I, 0)
        }
      }
    }
    if ('bonus' != G) {
      var y = (q = getListPoloBusy()).length,
        K = 0
      for (z = 0; z < y; z++) {
        var L = q[z]
        7 < L.getLoop() && ++K < y && removePolo(L, 0)
      }
    }
  }
}
function startRecordMode() {
  bonusPlaying
    ? popupBonusPlaying()
    : (lock(),
      (modeRecord = true),
      $body.addClass('mode-record'),
      (waitForRecording = false),
      recordMix.init(),
      (readingBar.maxLoop = app.recmaxloop),
      readingBar.open('record'),
      closeTool(),
      $btTool.off().on(pointerEventType.down, function (g) {
        g.preventDefault()
        preventAction(stopRecordMode)
      }),
      $btTool.bounce(),
      $btTool['$svg'].attr('xlink:href', '#ic-live'),
      loopOn ? lancerRecordMode() : TweenMax.delayedCall(0.4, lancerRecordMode))
}
function lancerRecordMode() {
  ;(loopOn ? startRecording : ((waitForRecording = true), popupDrag))()
  unlock()
}
function startRecording() {
  waitForRecording = false
  readingBar.start()
  readingBar.onLoopsFinished = () => {
    stopRecordMode()
  }
  readingBar.onLooping = () => {
    recordMix.loop()
  }
  recordMix.start()
  saveGA('mix', 'start_recording')
}
function stopRecordMode() {
  modeRecord = false
  $body.removeClass('mode-record')
  readingBar.stop()
  readingBar.close()
  recordMix.stop()
  $btTool['$svg'].attr('xlink:href', '#ic-burger')
  $btTool.off()
  $btTool.bounce()
  enableBtTool()
  readingBar.cntLoop < readingBar.minLoop &&
    !waitForRecording &&
    TweenMax.delayedCall(0.25, popupShort)
  readingBar.cntLoop >= readingBar.minLoop &&
    !waitForRecording &&
    (lock(), pictoForceOnDrop(), stopAllStage(), popupRecok())
}
var controlTimeout,
  RecordMix = function () {
    var h,
      i,
      j,
      k,
      l,
      m = this,
      p = decimal(loopDuration / 1000, 2)
    this.init = function () {
      i = h = ''
      j = false
      k = 0
      l = {}
    }
    this.setData = function (q) {
      l = q
    }
    this.getData = function () {
      return l
    }
    this.getXML = function () {
      return h
    }
    this.start = function () {
      m.init()
      j = true
      m.xmlOpen()
    }
    this.loop = function () {
      m.xmlCloseAction()
      m.xmlCloseLoop()
      k++
      m.xmlOpenLoop()
      m.xmlOpenAction()
    }
    this.stop = function () {
      j = false
      m.xmlClose()
    }
    this.xmlOpen = function () {
      h = "<mix version='" + build.version + "' control='true'>\n"
      m.xmlOpenLoop()
      m.xmlOpenAction()
    }
    this.xmlClose = function () {
      m.xmlCloseAction()
      m.xmlCloseLoop()
      h += '</mix>\n'
    }
    this.xmlOpenLoop = function () {
      if (
        ((i = "\t<loop boucleA='" + !boucleA + "' count='" + k + "'>\n"),
        (i += '\t\t<stage>\n'),
        bonusPlaying)
      ) {
        i +=
          "\t\t\t<bonus id='" +
          (bonusQueue - 1) +
          "' playing='true' cntBoucle='" +
          cntBoucleBonus +
          "' />\n"
      } else {
        bonusWaiting &&
          0 < k &&
          (i += "\t\t\t<bonus id='" + (bonusQueue - 1) + "' waiting='true'/>\n")
        for (var q = 0; q < nbPoloMax; q++) {
          var u,
            v = listPolo[q]
          v.getBusy() &&
            ((u = ''),
            (u =
              v.getPlaying() || 0 !== v.getMoment() || 0 !== v.getLoop()
                ? "\t\t\t<polo id='" +
                  v.id +
                  "' picto='" +
                  v.getPicto().id +
                  "' mute='" +
                  v.getMute() +
                  "' playing='" +
                  v.getPlaying() +
                  "'/>\n"
                : "\t\t\t<polo id='" +
                  v.id +
                  "' picto='" +
                  v.getPicto().id +
                  "' mute='" +
                  v.getMute() +
                  "' playing='true'/>\n"),
            (i += u))
        }
      }
      i += '\t\t</stage>\n'
    }
    this.xmlCloseLoop = function () {
      h += i += '\t</loop>\n'
    }
    this.xmlOpenAction = function () {
      i += '\t\t<action>\n'
      0 === k &&
        bonusWaiting &&
        recordMix.xmlAction('bonus', listBonus[bonusQueue - 1], true)
    }
    this.xmlCloseAction = function () {
      i += '\t\t</action>\n'
    }
    this.xmlAction = function (q, u, v) {
      var w, x
      j &&
        ((v = void 0 !== v && v),
        (w = decimal(getTimeSpent(true) / 1000, 2)),
        (x = ''),
        'bonus' == q
          ? (x += v
              ? "\t\t\t<user type='" +
                q +
                "' bonus='" +
                u.getId() +
                "' when='0.1'/>\n"
              : "\t\t\t<user type='" +
                q +
                "' bonus='" +
                u.getId() +
                "' when='" +
                w +
                "'/>\n")
          : ((w = p - delayassist / 1000 < w ? p : w),
            (x +=
              "\t\t\t<user type='" +
              q +
              "' polo='" +
              u.id +
              "' picto='" +
              u.getPicto().id +
              "' when='" +
              w +
              "'/>\n")),
        (i += x))
    }
  }
function prepareReplayMode() {
  modeReplay = true
  $body.addClass('mode-replay')
  lock()
  closeTool()
  $btTool.off().on(pointerEventType.down, function (h) {
    h.preventDefault()
    preventAction(stopReplayMode)
  })
  $btTool.bounce()
  hideDiv($boxBtBonus, !modeWatch)
  hideDiv($boxPicto, !modeWatch)
  hideDiv($boxLoaderPolo, !modeWatch)
  $btTool['$svg'].attr('xlink:href', '#ic-close')
  $btSave.on(pointerEventType.down, function (h) {
    h.preventDefault()
    preventAction(function () {
      Spinner.add($btSave)
      stopReplayMode(true)
    })
  })
  $boxStage.addClass('pointerlock')
  modeWatch
    ? ($body.addClass('mode-watch'),
      $mixlist.hide(),
      $watchInfo.addClass('fadeIn'))
    : ($watchInfo.addClass('fadeIn'),
      $watchInfo['$title'].html(STR('txt.replayTitle')),
      $watchInfo['$name'].html(STR('txt.replayText')),
      $watchInfo['$dedi'].empty(),
      $btSave.find('.txt').html(STR('bt.save')))
}
function startReplayMode() {
  var h = modeWatch
    ? null != mixToWatch.xml
      ? mixToWatch.xml
      : mixToWatch.mix
    : recordMix.getXML()
  replayMix = new ReplayMix(h)
  readingBar.maxLoop = replayMix.getTotalLoop()
  readingBar.bonusList = replayMix.getBonusList()
  TweenMax.delayedCall(0.4, function () {
    readingBar.open('play', replayMix.control)
    readingBar.onLoopsFinished = () => {
      stopReplayMode()
    }
    readingBar.onLooping = () => {
      replayMix.loop()
    }
    readingBar.start()
    replayMix.start()
  })
  TweenMax.delayedCall(0.6, function () {
    createFocus('mode-replay')
    unlock()
  })
}
function stopReplayMode(g) {
  removeInFocusHistory('mode-replay')
  deleteFocus()
  froze ||
    (desactivateControl(),
    $btTool.off(),
    (modeReplay = false),
    readingBar.stop(),
    readingBar.close(),
    replayMix.stop(),
    modeWatch
      ? (miniPlayer && stopAllStage(), backToHome())
      : (stopAllStage(),
        $btTool.bounce(),
        $btTool['$svg'].attr('xlink:href', '#ic-burger'),
        $watchInfo.removeClass('fadeIn'),
        true === g
          ? (Spinner.reset(), appBrowserDemo ? popupGetApp(true) : popupForm())
          : popupRecok(),
        TweenMax.delayedCall(0.4, afterStopReplay)),
    enableBtTool())
}
function afterStopReplay() {
  showDiv($boxBtBonus, !modeWatch)
  showDiv($boxPicto, !modeWatch)
  showDiv($boxLoaderPolo, !modeWatch)
  $body.removeClass('mode-replay')
  $boxStage.removeClass('pointerlock')
}
function reinitModeWatch() {
  afterStopReplay()
  modeWatch = false
  $body.removeClass('mode-watch')
  $btTool['$svg'].attr('xlink:href', '#ic-burger')
  $watchInfo.removeClass()
  $mixlist.show()
}
function clickBtWatch(g) {
  void 0 !== g.type && g.stopPropagation()
  var i,
    g = void 0 === g.type ? g : null,
    j = isnull(g)
  isnull(
    (g = j
      ? searchMixInCurrentList(
          (i = $(this).parent().parent()).attr('data-key').replace('mix-', '')
        )
      : g)
  )
    ? boxDialog.open(STR('pop.notFoundText'), STR('pop.notFoundTitle'), [
        STR('bt.ok'),
      ])
    : ((modeWatch = true),
      (mixToWatch = g),
      $watchInfo['$title'].html(g.title),
      $watchInfo['$name'].html(
        STR('txt.createdBy').split('%{name}').join(g.name)
      ),
      $watchInfo['$dedi'].html(
        '' == g.dedi ? '' : STR('txt.dedicatedTo').split('%{name}').join(g.dedi)
      ),
      $watchInfo['$date'].html(getStringDate(g.datedb)),
      $watchInfo['$date'].attr('data-date', g.datedb),
      $watchInfo.find('.mixbanner').attr('class', 'mixbanner'),
      $watchInfo.find('.stat').empty(),
      j
        ? ((j = i.find('.stat').html()),
          $watchInfo.find('.stat').html(j),
          (j = $watchInfo.find('.dj .box-flag')),
          g.country
            ? j
                .find('.fflag')
                .removeClass()
                .addClass('fflag fflag-' + g.country.toUpperCase())
            : j.hide(),
          (j = ''),
          (j =
            (j =
              (j =
                (j =
                  (j += i.hasClass('ismymix') ? ' ismymix' : '') +
                  (i.hasClass('isfavoris') ? ' isfavoris' : '')) +
                (i.hasClass('istop50') ? ' istop50' : '')) +
              (i.hasClass('islatest') ? ' islatest' : '')) +
            (i.hasClass('isprivate') ? ' isprivate' : '')),
          $watchInfo.find('.mixbanner').addClass(j))
        : $watchInfo
            .find('.stat')
            .html(
              "\n\t\t\t\t<div class='boxstat liked'><div class='txt'>" +
                numberSpaced(g.nblike) +
                "</div><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-like-mini'></use></svg></div></div>\n\t\t\t\t<div class='boxstat viewed'><div class='txt'>" +
                numberSpaced(g.nbview) +
                "</div><div class='bck'><svg class='icn-svg'><use xlink:href='#ic-view-mini'></use></svg></div></div>\n\t\t\t"
            ),
      mixToWatch.mymix ||
        ($btLike.removeClass('liked already disabled'),
        $btLike.off().on(pointerEventType.down, clickBtLikeMix),
        g.liked && $btLike.addClass('liked'),
        miniPlayer) ||
        countView(),
      clickHomeBtPlay())
}
function clickBtLikeMix(g) {
  if ((g.preventDefault(), $btLike.hasClass('disabled'))) {
    return false
  }
  hasNetwork
    ? ($btLike.addClass('disabled'),
      Spinner.add($btLike),
      TweenMax.delayedCall(0.5, function () {
        true === mixToWatch.liked
          ? ($btLike.removeClass('liked'),
            TweenMax.delayedCall(0.5, function () {
              $btLike.removeClass('disabled')
            }),
            countLike('nbunlike'))
          : ($btLike.addClass('liked'),
            TweenMax.delayedCall(0.5, function () {
              $btLike.removeClass('disabled')
            }),
            countLike('nblike'))
      }))
    : boxDialog.open(STR('pop.noNetworkVotedText'), STR('pop.noNetworkTitle'), [
        STR('bt.ok'),
      ])
}
function countLike(g) {
  var i = {
    uuid: trustAppMobile ? device.uuid : 'unknown',
    id: mixToWatch.id,
    link: mixToWatch.link,
    row: g,
  }
  xhr(
    'POST',
    domainOnline + 'ph3/save-stat-mix.php',
    i,
    function (j) {
      if ('success' == j.state) {
        switch (j.info) {
          case 'like ok':
            ;(mixToWatch.liked = true), mixToWatch.nblike++
            break
          case 'unlike ok':
            delete mixToWatch.liked,
              mixToWatch.nblike--,
              (mixToWatch.nblike =
                mixToWatch.nblike < 0 ? 0 : mixToWatch.nblike)
            break
          case 'already liked':
            boxDialog.open(
              STR('pop.alreadyVotedText'),
              STR('pop.alreadyVotedTitle'),
              [STR('bt.ok')]
            ),
              $btLike.addClass('already liked'),
              (mixToWatch.liked = true)
        }
      }
      Spinner.reset()
      $watchInfo['$like'] = $watchInfo.find('.stat .liked')
      $watchInfo['$like']
        .find('.bck')
        .addClass('popIn')
        .one(animationEnd, function (l) {
          $(l.target).removeClass(_classname)
        })
      $watchInfo['$like'].find('.txt').text(numberSpaced(mixToWatch.nblike))
      miniPlayer ||
        $lineOpened
          .find('.stat .liked .txt')
          .text(numberSpaced(mixToWatch.nblike))
    },
    function (j) {}
  )
}
function countView() {
  var g = {
    uuid: trustAppMobile ? device.uuid : 'unknown',
    link: mixToWatch.link,
    row: 'nbview',
  }
  hasNetwork &&
    xhr('POST', domainOnline + 'ph3/save-stat-mix.php', g, function (h) {
      'success' == h.state && (mixToWatch.viewed = true)
    })
}
var controlBoucle = 0,
  controlIsBuzy = false
function activateControl() {
  $boxStage[0].addEventListener(pointerEventType.down, listenControlPress)
}
function listenControlPress(g) {
  g.preventDefault()
  controlIsBuzy ||
    (clearTimeout(controlTimeout),
    $boxStage[0].removeEventListener(pointerEventType.move, moveControlHead),
    $boxStage[0].addEventListener(pointerEventType.move, moveControlHead),
    document.body.removeEventListener(
      pointerEventType.up,
      listenControlRelease
    ),
    document.body.addEventListener(pointerEventType.up, listenControlRelease),
    readingBar.openBig(),
    moveControlHead(g),
    frozeScene())
}
function listenControlRelease(g) {
  g.preventDefault()
  clearTimeout(controlTimeout)
  $boxStage[0].removeEventListener(pointerEventType.move, moveControlHead)
  document.body.removeEventListener(pointerEventType.up, listenControlRelease)
  readingBar.openNormal()
  controlTimeout = setTimeout(controlTimeoutComplete, 400)
}
function controlTimeoutComplete() {
  controlIsBuzy = true
  unfrozeScene((controlBoucle = readingBar.cntLoop))
  setTimeout(function () {
    controlIsBuzy = false
  }, 200)
}
function moveControlHead(g) {
  g = 'targetTouches' in g ? g.targetTouches[0] : g
  var i = $incredibox[0].offsetLeft,
    g = g.pageX - i,
    g = Math.floor(
      (readingBar.maxLoop * g) / (document.body.clientWidth - 2 * i)
    )
  g = (g = g < 0 ? 0 : g) > readingBar.maxLoop - 1 ? readingBar.maxLoop - 1 : g
  readingBar.seek(g)
}
function desactivateControl() {
  $boxStage[0].removeEventListener(pointerEventType.down, listenControlPress)
  $boxStage[0].removeEventListener(pointerEventType.move, moveControlHead)
  document.body.removeEventListener(pointerEventType.up, listenControlRelease)
  controlBoucle = 0
  clearTimeout(controlTimeout)
}
var ReplayMix = function (g) {
  var j,
    k,
    m,
    o,
    q,
    v,
    w,
    x = this
  function y() {
    var z,
      A = getListPoloBusy(),
      B = getListPoloUnmute()
    if (1 < B.length) {
      for (z in A) A[z].setSolo(false)
    } else {
      if (1 == A.length) {
        A[0].setSolo(false)
      } else {
        if (1 < A.length && 1 == B.length) {
          for (z in A) A[z].setSolo(false)
          B[0].setSolo(true)
        }
      }
    }
  }
  this.control = false
  this.reloop = false
  this.waitForReloop = false
  this.init = function () {
    var z, A
    k = $.parseXML(g)
    0 < (j = $(k)).find('compo').length &&
      ((m = true), (z = convertFlashXml(g)), (k = $.parseXML(z)), (j = $(k)))
    k = j.find('mix')
    o =
      appBrowserDemo ||
      appBrowserSchool ||
      ('true' === k.attr('control') && !appBrowser)
    q = k.children().length
    v = decimal(loopDuration / 1000, 2)
    w = 0
    o &&
      ((A = []),
      j.find('user[type=bonus]').each(function () {
        A.push(parseInt($(this).attr('bonus')))
      }),
      (A = removeDupInArray(A)).length <= app.bonusarray.length
        ? activateControl()
        : (o = false))
    this.control = o
    this.reloop = false
    this.waitForReloop = false
  }
  this.getTotalLoop = function () {
    return q
  }
  this.start = function () {
    x.loop()
  }
  this.stop = function () {
    TweenMax.killTweensOf(x.appendPolo)
    TweenMax.killTweensOf(x.removePolo)
    TweenMax.killTweensOf(x.mutePolo)
    TweenMax.killTweensOf(x.unmutePolo)
    TweenMax.killTweensOf(x.launchBonus)
    TweenMax.killTweensOf(x.soloPolo)
    this.control = false
    x.reloop = false
    x.waitForReloop = false
  }
  this.loop = function (z) {
    var B, C
    notnull(z) && ((w = z), (x.reloop = true))
    w == q
      ? stopReplayMode()
      : ((z = j.find('loop[count="' + w + '"]')),
        (0 !== w && !x.reloop) ||
          ((boucleA = 'true' == z.attr('boucleA')),
          (C = z.find('stage')),
          (B = 0),
          $(C)
            .children()
            .each(function (D) {
              var E,
                F,
                G,
                H,
                I = this.tagName
              'polo' == I &&
                ((E = Number($(this).attr('id'))),
                (F = Number($(this).attr('picto'))),
                (H = 'true' == $(this).attr('mute')),
                (D = -1 == E ? listPolo[D] : listPolo[E]),
                (E = listPicto[F]),
                (F = x.reloop ? 0 : 0.03),
                (G = !!x.reloop),
                x.appendPolo(D, E, B * F, G),
                'false' == $(this).attr('playing') && (D.waitOneLoop = true),
                H && x.mutePolo(D),
                B++)
              0 < w &&
                'bonus' == I &&
                ((E = Number($(this).attr('id'))),
                (F = 'true' === $(this).attr('playing')),
                (G = 'true' === $(this).attr('waiting')),
                (H = Number($(this).attr('cntBoucle'))),
                G
                  ? TweenMax.delayedCall(0.1, x.launchBonus, [E])
                  : F && x.launchBonus(E, H, true))
            }),
          m &&
            1 == (C = getListPoloUnmute()).length &&
            1 < getListPoloBusy().length &&
            C[0].setSolo(true),
          (x.reloop = false)),
        (C = z.find('action')),
        $(C)
          .children()
          .each(function () {
            var D, E, F, G
            'user' == this.tagName &&
              ((D = $(this).attr('type')),
              (E = decimal(Number($(this).attr('when')), 2)),
              (E = v < E ? v : E),
              'bonus' == D
                ? ((F = Number($(this).attr('bonus'))),
                  (F = m ? F - 1 : F),
                  (E = 0 === E ? 0.1 : E),
                  (E =
                    waitingFirstLoop && E < delayassist / 1000
                      ? E + delayassist / 1000
                      : E),
                  TweenMax.delayedCall(E, x.launchBonus, [F]))
                : ((F = Number($(this).attr('polo'))),
                  (G = Number($(this).attr('picto'))),
                  (F = -1 == F ? { fromFlash: true } : listPolo[F]),
                  (G = listPicto[G]),
                  'append' == D
                    ? TweenMax.delayedCall(E, x.appendPolo, [F, G])
                    : 'remove' == D
                    ? TweenMax.delayedCall(E, x.removePolo, [F, G])
                    : 'mute' == D
                    ? TweenMax.delayedCall(E, x.mutePolo, [F, G])
                    : 'unmute' == D &&
                      TweenMax.delayedCall(E, x.unmutePolo, [F, G]),
                  m && 'solo' == D && TweenMax.delayedCall(E, x.soloPolo, [G])))
          }),
        w++)
  }
  this.getBonusList = function () {
    var z = []
    return (
      $(j)
        .find("bonus[playing='true']")
        .each(function () {
          z.push({
            id: parseInt($(this).attr('id')),
            loopIndex: parseInt($(this).parent().parent().attr('count')),
          })
        }),
      z
    )
  }
  this.appendPolo = function (z, A, B, C) {
    pictoTouchePolo(
      (z = true === z.fromFlash ? getListPoloFree()[0] : z),
      A,
      B,
      C
    )
    majListPoloDrop()
  }
  this.removePolo = function (z, A) {
    ;(z = true === z.fromFlash ? A.polo : z).getBusy() && clickPolo(z)
  }
  this.mutePolo = function (z, A) {
    ;(z = true === z.fromFlash ? A.polo : z).getBusy() &&
      (mutePolo(z), m) &&
      y()
  }
  this.unmutePolo = function (z, A) {
    ;(z = true === z.fromFlash ? A.polo : z).getBusy() &&
      (unmutePolo(z), m) &&
      y()
  }
  this.launchBonus = function (z, A, B) {
    notnull(listBonus[z]) &&
      (B ? immediatePlayBonus(z, A) : listBonus[z].launchVideo())
  }
  this.soloPolo = function (z) {
    if (m) {
      z = z.polo
      if (z.getBusy()) {
        if (z.getSolo()) {
          z.setSolo(false)
          stopSoloPolo()
        } else {
          for (var A = getListPoloBusy(), B = 0, C = A.length; B < C; B++) {
            A[B].setSolo(false)
          }
          z.setSolo(true)
          soloPolo()
        }
      }
    }
  }
  notnull(g) && this.init()
}
function convertFlashXml(g) {
  var g = $.parseXML(g),
    g = $(g).find('compo'),
    i = 'true' === g.attr('boucle'),
    j = '<mix version="flash">\n'
  return (
    g.children().each(function (k) {
      var n = '\t<loop boucleA="' + i + '" count="' + k + '">\n',
        p = '\t\t<stage>\n',
        q = '\t\t<action>\n'
      $(this)
        .children()
        .each(function (v) {
          var w,
            x = $(this),
            y = x.find('polo'),
            z = x.attr('type'),
            A = y.attr('picto'),
            B = '0' === y.attr('vol'),
            y = 0 < y.attr('nbBoucle'),
            x = x.find('moment').attr('seconde'),
            x = decimal(Number(x), 2).toString()
          if (
            ((z =
              '' !=
              (w =
                -1 <
                (z =
                  'mute' ===
                    (z =
                      'mute' !==
                        (z =
                          'supprimer' === (z = 'ajouter' === z ? 'append' : z)
                            ? 'remove'
                            : z) || B
                        ? z
                        : 'mute') && B
                    ? 'unmute'
                    : z).indexOf('bonus')
                  ? z.split('bonus').join('')
                  : '')
                ? 'bonus'
                : z),
            (A = Number(A.split('picto').join(''))),
            2 == Number(appVersion))
          ) {
            switch (A) {
              case 0:
                A = 5
                break
              case 1:
                A = 6
                break
              case 2:
                A = 7
                break
              case 3:
                A = 8
                break
              case 4:
                A = 9
                break
              case 5:
                A = 0
                break
              case 6:
                A = 1
                break
              case 7:
                A = 2
                break
              case 8:
                A = 3
                break
              case 9:
                A = 4
            }
          }
          0 == k && '0' === x
            ? (p +=
                '\t\t\t<polo id="-1" picto="' +
                A +
                '" mute="' +
                B +
                '" playing="' +
                y +
                '" />\n')
            : ((B =
                '\t\t\t<user type="' +
                z +
                '" polo="-1" picto="' +
                A +
                '" when="' +
                x +
                '" />\n'),
              (q += B =
                'bonus' === z
                  ? '\t\t\t<user type="' +
                    z +
                    '" bonus="' +
                    w +
                    '" when="' +
                    x +
                    '" />\n'
                  : B))
        })
      j +=
        n + ((p += '\t\t</stage>\n') + (q += '\t\t</action>\n')) + '\t</loop>\n'
      i = !i
    }),
    trim((j += '</mix>'))
  )
}
function parseXmlAndCheckAssets() {
  var g = mixToWatch.xml || mixToWatch.mix,
    h = $.parseXML(g),
    j = $(h),
    k = j.find('mix'),
    m = false,
    q =
      (0 < j.find('compo').length &&
        ((m = true),
        (g = convertFlashXml(mixToWatch.xml)),
        (mixToWatch.xml = g),
        (h = $.parseXML(g)),
        (k = (j = $(h)).find('mix'))),
      []),
    v = [],
    w = []
  function x(B) {
    var C
    'bonus' === B.attr('type')
      ? ((C = Number(B.attr('bonus'))),
        existInArray(v, (C = m ? C - 1 : C)) || v.push(C))
      : ((C = Number(B.attr('picto'))), existInArray(q, C) || q.push(C))
  }
  k.children().each(function (B) {
    0 === B &&
      $(this)
        .find('stage')
        .each(function (C) {
          $(this)
            .children()
            .each(function (D) {
              x($(this))
            })
        })
    $(this)
      .find('action')
      .each(function (C) {
        $(this)
          .children()
          .each(function (D) {
            x($(this))
          })
      })
  })
  for (
    var q = q.sort(function (B, C) {
        return B - C
      }),
      v = v.sort(function (B, C) {
        return B - C
      }),
      y = app.animearray[q[0]],
      z = 0,
      A = app.animearray.length;
    z < A;
    z++
  ) {
    existInArray(q, z) || (app.animearray[z] = y)
  }
  for (z = 0, A = v.length; z < A; z++) {
    w.push(app.bonusarray[v[z]])
  }
}
var adBreak,
  adConfig,
  convertForceStop = false,
  convertWorker = null
function stopConvert() {
  notnull(convertWorker) ? convertWorker.terminate() : (convertForceStop = true)
}
function startConvert(j, q) {
  for (
    var G,
      H = new AudioContext(),
      I =
        ((convertForceStop = false),
        (convertWorker = null),
        $($.parseXML(j.xml)).find('mix')),
      K = q.find('#convert-loader-box'),
      L = K.find('.progress-bar'),
      M = q.find('#bt-save-file'),
      q = q.find('.spinner-box'),
      N = 'mp3',
      R = [],
      U = [],
      V =
        'incredibox-v' +
        app.version +
        '-' +
        slugify(j.title) +
        '-' +
        320 +
        'kbps' +
        (j.online ? '-' + j.link : '') +
        '.' +
        N,
      W = 0,
      W = 0;
    W < nbSound;
    W++
  ) {
    R.push([tabBuffer.sound[W].sndA, tabBuffer.sound[W].sndB])
  }
  for (W = 0; W < nbSoundBonus; W++) {
    U.push([tabBuffer.bonus[W].snd, tabBuffer.bonus[W].aspire])
  }
  var X,
    Y,
    Z = [],
    a0 = 0,
    a1 = false,
    a2 = false
  if (
    ($(I).children().length,
    $(I)
      .children()
      .each(function (ad) {
        var af = 'true' == $(this).attr('boucleA'),
          ag = $(this).find('stage'),
          ah = $(this).find('action'),
          ai = [],
          aj = af ? 0 : 1,
          ak = !app.bonusloopA || af
        a1 && ak && ((a2 = !(a1 = false)), Z.push(U[X][0]))
        a2 &&
          ++a0 > app.bonusarray[X].loop &&
          ((a2 = false), (Y = X = void (a0 = 0)))
        a2 ||
          (ag.children().each(function (al) {
            var an, ao, ap, aq
            'polo' == this.tagName &&
              ((an = Number($(this).attr('picto'))),
              (aq = 'true' == $(this).attr('playing')),
              (ao = 'true' == $(this).attr('mute')),
              (ap = []),
              aq) &&
              ((aq = R[an][aj]),
              ao &&
                ap.push({
                  when: 0,
                  type: 'mute',
                }),
              ah.find("user[picto='" + an + "']").each(function (ar) {
                var as = $(this).attr('type'),
                  at = Number($(this).attr('when'))
                'append' != as &&
                  ap.push({
                    when: at,
                    type: as,
                  })
              }),
              0 < ap.length &&
                (aq = (function (ar, as, at) {
                  for (
                    var au = ar.numberOfChannels,
                      av = ar.duration,
                      aw = H.createBuffer(au, H.sampleRate * av, H.sampleRate),
                      ax = 0;
                    ax < au;
                    ax++
                  ) {
                    for (
                      var ay = aw.getChannelData(ax),
                        az = ar.getChannelData(ax),
                        aA = az.length,
                        aB = 0,
                        aC = as,
                        aD = aC,
                        aE = [],
                        aF = 0;
                      aF < at.length;
                      aF++
                    ) {
                      var aG = at[aF].when,
                        aG = Math.round((aG * aA) / av)
                      aE.push([aG, at[aF].type])
                    }
                    for (var aH = 0 < aE.length, aI = 0; aI < aA; aI++) {
                      aH &&
                        aI >= aE[aB][0] &&
                        ((aC = 'mute' == aE[aB][1] || 'remove' == aE[aB][1]),
                        aE.length <= ++aB &&
                          ((aH = false), 95 < Math.round((100 * aI) / aA)) &&
                          (aC = aD),
                        (aD = aC))
                      aC ? (ay[aI] = 0) : (ay[aI] += az[aI])
                    }
                  }
                  return aw
                })(aq, ao, ap)),
              ai.push(aq))
          }),
          ah.find("user[type='bonus']").each(function (al) {
            a1 = true
            X = Number($(this).attr('bonus'))
            Y = Number($(this).attr('when'))
          }),
          a1 &&
            (ah.find("user[type='remove']").each(function (al) {
              var am = Number($(this).attr('picto')),
                an = Number($(this).attr('when'))
              Y < an &&
                (function (ao, ap) {
                  for (var aq = 0; aq < ap.length; aq++) {
                    if (ao == ap[aq]) {
                      return 1
                    }
                  }
                  return
                })(am + 1, app.bonusarray[X].code.split(',')) &&
                ((a1 = false), (Y = void 0))
            }),
            (Y = 0)),
          !a1 || (app.bonusloopA && af) || ai.push(U[X][1]),
          Z.push(
            (function (al) {
              for (var am = al.length, an = 0, ao = 0, ap = 0; ap < am; ap++) {
                al[ap].numberOfChannels > an && (an = al[ap].numberOfChannels)
                al[ap].duration > ao && (ao = al[ap].duration)
              }
              for (
                var aq = H.createBuffer(
                    an,
                    H.sampleRate * (ao - 0),
                    H.sampleRate
                  ),
                  ar = 0;
                ar < am;
                ar++
              ) {
                for (var as = 0; as < al[ar].numberOfChannels; as++) {
                  for (
                    var at = aq.getChannelData(as),
                      au = al[ar].getChannelData(as),
                      av = 0;
                    av < au.length;
                    av++
                  ) {
                    at[av] += au[av]
                  }
                }
              }
              return aq
            })(ai)
          ))
      }),
    !convertForceStop)
  ) {
    for (
      var a3 = (j = (function (ad) {
          for (var ae = ad.length, af = [], ag = 0, ah = 0; ah < ae; ah++) {
            af.push(ad[ah].numberOfChannels)
            ag += ad[ah].duration
          }
          ag = Math.ceil(ag)
          for (
            var ai = af.reduce(function (ap, aq) {
                return Math.min(ap, aq)
              }),
              aj = H.createBuffer(ai, H.sampleRate * ag, H.sampleRate),
              ak = 0;
            ak < ai;
            ak++
          ) {
            for (
              var al = aj.getChannelData(ak), am = 0, an = 0;
              an < ae;
              an++
            ) {
              var ao = ad[an].getChannelData(ak)
              al.set(ao, am)
              am += ao.length
            }
          }
          return aj
        })(Z)),
        a5 = a3.numberOfChannels,
        a6 = 0;
      a6 < a5;
      a6++
    ) {
      for (
        var a7 = a3.getChannelData(a6), a8 = 0, a9 = 0, aa = 0, ab = a7.length;
        aa < ab;
        aa++
      ) {
        a7[aa] > a8 && (a8 = a7[aa])
        a7[aa] < a9 && (a9 = a7[aa])
        a7[aa] > 0.9 && ((a7[aa] = 0.9), 0)
        a7[aa] < -0.9 && ((a7[aa] = -0.9), 0)
      }
    }
    I = j
    var ac = 0,
      I =
        ((convertWorker = new Worker('js/libs/convert-worker.js')),
        {
          sampleR: I.sampleRate,
          numberC: I.numberOfChannels,
          leftData: I.getChannelData(0),
          rightData: I.getChannelData(1),
          lng: I.length,
          kbps: 320,
          typeToExport: N,
        })
    convertWorker.postMessage([I])
    convertWorker.onmessage = function (ad) {
      var ae,
        ad = ad.data
      'msg' == ad.type
        ? (ac++,
          (ae = Math.floor((ac * 100) / 40)),
          L.css({
            width: 0 + (ae = 100 < (ae = ae < 5 ? 5 : ae) ? 100 : ae) + '%',
          }))
        : (convertWorker.terminate(),
          (ae = ad.val),
          (G =
            'mp3' == N
              ? new Blob(ae, { type: 'audio/mp3' })
              : new Blob([new DataView(ae)], { type: 'audio/wav' })),
          window.cordova && cordova.plugins && cordova.plugins.saveDialog
            ? (boxPopup['$icon'].trigger(pointerEventType.down),
              cordova.plugins.saveDialog
                .saveFile(G, V)
                .then((af) => {})
                .catch((af) => {
                  'The dialog has been cancelled' != af &&
                    popupGeneralError({ error: 'file plugin failed' })
                }))
            : ((G = window.URL.createObjectURL(G)),
              K.addClass('hide'),
              M.attr('href', G).attr('download', V).addClass('enabled'),
              createFocus('popup-convert-mix-ready')),
          (convertWorker = null),
          H.close(),
          (H = null))
    }
    q.addClass('hide')
    K.addClass('show')
  }
}
var adConfigReady = false,
  withAdBreak = false
function initAd() {}
function callAd(g, h, i) {
  i && i()
}
var gaShouldTrack = false,
  gaAlreadySet = false
function initAnalytics() {}
function saveGA(g, h, i) {}
